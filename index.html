<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>í”ë“¤ê°ˆëŒ€</title>
<style>
  /* ì „ì²´ ìŠ¤íƒ€ì¼ */
  body {
    font-family: 'Noto Sans KR', sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f7f7f7;
    color: #333;
    line-height: 1.6;
  }
  
  /* ë¹„ë°€ë²ˆí˜¸ í™”ë©´ */
  #password-screen {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background-color: #f5f5f5;
  }
  
  #password-form {
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    text-align: center;
    width: 90%;
    max-width: 350px;
  }
  
  #password-form h2 {
    margin-top: 0;
    color: #333;
  }
  
  #password {
    width: 100%;
    padding: 12px;
    margin: 15px 0;
    border: 1px solid #ddd;
    border-radius: 5px;
    box-sizing: border-box;
  }
  
  #password-form button {
    width: 100%;
    padding: 12px;
    background-color: #5f7561;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    transition: background-color 0.3s;
  }
  
  #password-form button:hover {
    background-color: #4a5b4b;
  }
  
  #error-msg {
    color: #e74c3c;
    margin-top: 10px;
  }
  
  /* ë©”ì¸ ì»¨í…ì¸  */
  #main-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }
  
  header {
    text-align: center;
    padding: 20px 0;
    margin-bottom: 30px;
    border-bottom: 1px solid #eee;
  }
  
  header p {
    color: #666;
    font-style: italic;
  }
  
  nav {
    margin-bottom: 30px;
  }
  
  nav ul {
    display: flex;
    list-style: none;
    padding: 0;
    margin: 0;
    justify-content: center;
    flex-wrap: wrap;
  }
  
  nav li {
    margin: 0 10px 10px;
  }
  
  nav a {
    text-decoration: none;
    color: #333;
    padding: 8px 15px;
    border-radius: 20px;
    background-color: #eee;
    transition: all 0.3s;
    display: inline-block;
  }
  
  nav a:hover, nav a.active {
    background-color: #5f7561;
    color: white;
  }
  
  /* íƒ­ ì»¨í…ì¸  */
  .tab-content {
    display: none;
    padding: 20px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  }
  
  .tab-content.active {
    display: block;
  }
  
  /* ìŠµê´€ íŠ¸ë˜ì»¤ ìŠ¤íƒ€ì¼ */
  .habit-container {
    margin-top: 20px;
  }
  
  .habit-section {
    margin-bottom: 30px;
  }
  
  .habit-form {
    background-color: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
  }
  
  .form-group {
    margin-bottom: 15px;
  }
  
  .form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
  }
  
  .form-group input[type="text"], 
  .form-group select, 
  .form-group textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    box-sizing: border-box;
  }
  
  .form-group textarea {
    min-height: 80px;
    resize: vertical;
  }
  
  .weekday-options {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
  }
  
  .weekday-item {
    margin-right: 10px;
  }
  
  .checkbox-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
  }
  
  .checkbox-item {
    display: flex;
    align-items: center;
    margin-right: 10px;
  }
  
  .checkbox-item input {
    margin-right: 5px;
  }
  
  button {
    padding: 10px 20px;
    background-color: #5f7561;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 15px;
    transition: background-color 0.3s;
  }
  
  button:hover {
    background-color: #4a5b4b;
  }
  
  .delete-btn {
    background-color: #e74c3c;
  }
  
  .delete-btn:hover {
    background-color: #c0392b;
  }
  
  /* ìŠµê´€ ëª©ë¡ */
  .habit-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
  }
  
  .habit-list-item {
    background-color: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
  
  .habit-list-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  
  .habit-list-title {
    font-size: 18px;
    font-weight: 600;
  }
  
  .habit-list-category {
    font-size: 14px;
    color: #666;
    background-color: #f0f0f0;
    padding: 3px 8px;
    border-radius: 15px;
  }
  
  .habit-streak {
    margin: 15px 0;
    color: #5f7561;
    font-weight: 500;
  }
  
  .habit-streak-number {
    font-size: 24px;
    font-weight: 700;
  }
  
  .habit-list-controls {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  
  .habit-list-controls button {
    padding: 8px 12px;
    font-size: 14px;
  }
  
  /* ë‹¬ë ¥ ìŠ¤íƒ€ì¼ */
  .habit-calendar-container {
    background-color: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
  
  .habit-calendar-header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }
  
  #habitCalendarHeader {
    font-size: 18px;
    font-weight: 600;
    text-align: center;
    flex-grow: 1;
  }
  
  .habit-calendar-header {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    text-align: center;
    font-weight: 500;
    margin-bottom: 10px;
  }
  
  .habit-calendar-day-name {
    padding: 5px;
  }
  
  .habit-calendar-body {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
  }
  
  .habit-calendar-day {
    border: 1px solid #eee;
    min-height: 80px;
    padding: 5px;
    position: relative;
    transition: background-color 0.2s;
  }
  
  .habit-calendar-day.today {
    background-color: #f0f7f0;
    border-color: #5f7561;
  }
  
  .habit-calendar-day.other-month {
    background-color: #f5f5f5;
    color: #aaa;
  }
  
  .habit-day-number {
    font-size: 14px;
    text-align: right;
    margin-bottom: 5px;
  }
  
  .habit-items {
    font-size: 12px;
  }
  
  .habit-item {
    display: flex;
    align-items: center;
    margin-bottom: 3px;
  }
  
  .habit-circle {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 5px;
    border: 1px solid transparent;
  }
  
  .habit-circle.completed {
    background-color: inherit;
  }
  
  .habit-circle.missed {
    background-color: #eee;
  }
  
  /* íŠ¹ì •ì¼ ì„ íƒ ëª¨ë“œ ìŠ¤íƒ€ì¼ */
  .habit-calendar-day.specific-date-selected {
    background-color: #d4edda;
    border-color: #5f7561;
  }
  
  /* ë¯¸ë””ì–´ ì¿¼ë¦¬ - ëª¨ë°”ì¼ ëŒ€ì‘ */
  @media (max-width: 768px) {
    .habit-list {
      grid-template-columns: 1fr;
    }
    
    .habit-list-controls {
      flex-direction: column;
    }
    
    .habit-list-controls button {
      width: 100%;
      margin-bottom: 5px;
    }
    
    .habit-calendar-body {
      gap: 2px;
    }
    
    .habit-calendar-day {
      min-height: 60px;
      padding: 2px;
    }
  }
</style>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
<div id="password-screen">
  <form id="password-form" onsubmit="return checkPassword(event)">
    <h2>ğŸ” ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</h2>
    <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" required>
    <button type="submit">ì…ì¥</button>
    <p id="error-msg"></p>
  </form>
</div>
<div id="main-content" style="display: none;">
  <header>
    <img src="logo.png" alt="í”ë“¤ê°ˆëŒ€ ë¡œê³ " style="height:60px;">
    <p>í—›ë˜ì´ ë³´ë‚¸ ì˜¤ëŠ˜ì€, ì£½ì€ì´ê°€ ê·¸í† ë¡ ë°”ë¼ë˜ ë‚´ì¼ì´ì—ˆë‹¤</p>
    <audio id="bgm" src="bgm.mp3" autoplay loop hidden></audio>
  </header>
  
  <nav>
    <ul>
      <li><a href="#" class="tab-link active" data-tab="home">í™ˆ</a></li>
      <li><a href="#" class="tab-link" data-tab="habits">ìŠµê´€ ê´€ë¦¬</a></li>
      <li><a href="#" class="tab-link" data-tab="journal">ì¼ê¸°</a></li>
      <li><a href="#" class="tab-link" data-tab="goals">ëª©í‘œ</a></li>
      <li><a href="#" class="tab-link" data-tab="settings">ì„¤ì •</a></li>
    </ul>
  </nav>
  
  <div id="tabs">
    <div id="home" class="tab-content active">
      <h2>í™˜ì˜í•©ë‹ˆë‹¤</h2>
      <p>ì´ê³³ì—ì„œ ìŠµê´€ì„ ê´€ë¦¬í•˜ê³ , ì¼ìƒì„ ê¸°ë¡í•˜ë©° ìì‹ ì˜ ì„±ì¥ì„ í™•ì¸í•˜ì„¸ìš”.</p>
    </div>
    
    <div id="habits" class="tab-content">
      <h2>ìŠµê´€ ê´€ë¦¬</h2>
      
      <div class="habit-container">
        <!-- ìŠµê´€ ì¶”ê°€ í¼ -->
        <div class="habit-section">
          <h3>ìƒˆ ìŠµê´€ ì¶”ê°€</h3>
          <div class="habit-form">
            <div class="form-group">
              <label for="habitTitle">ìŠµê´€ ì´ë¦„</label>
              <input type="text" id="habitTitle" placeholder="ì˜ˆ: 30ë¶„ ë…ì„œí•˜ê¸°">
            </div>
            
            <div class="form-group">
              <label for="habitCategory">ì¹´í…Œê³ ë¦¬</label>
              <select id="habitCategory">
                <option value="health">ê±´ê°•</option>
                <option value="productivity">ìƒì‚°ì„±</option>
                <option value="mental">ì •ì‹  ê±´ê°•</option>
                <option value="learning">í•™ìŠµ</option>
                <option value="custom">ì§ì ‘ ì…ë ¥</option>
              </select>
              <input type="text" id="habitCustomCategory" placeholder="ì¹´í…Œê³ ë¦¬ ì…ë ¥" style="display: none; margin-top: 10px;">
            </div>
            
            <div class="form-group">
              <label for="habitFrequency">ì£¼ê¸°</label>
              <select id="habitFrequency">
                <option value="daily">ë§¤ì¼</option>
                <option value="weekly">ì£¼ê°„</option>
                <option value="specific">íŠ¹ì •ì¼</option>
              </select>
              
              <!-- ì£¼ê°„ ì˜µì…˜ -->
              <div id="weekdayOptionContainer" style="display: none; margin-top: 10px;">
                <div class="weekday-options">
                  <div class="weekday-item">
                    <input type="radio" id="weekdaysOption" name="weekdayOption" value="weekdays" checked>
                    <label for="weekdaysOption">ì£¼ 5ì¼ (ì›”-ê¸ˆ)</label>
                  </div>
                  <div class="weekday-item">
                    <input type="radio" id="customWeekdaysOption" name="weekdayOption" value="custom">
                    <label for="customWeekdaysOption">ìš”ì¼ ì§ì ‘ ì„ íƒ</label>
                  </div>
                </div>
                
                <!-- ì§ì ‘ ì„ íƒ ìš”ì¼ -->
                <div id="customWeekdaysContainer" class="checkbox-container" style="display: none;">
                  <div class="checkbox-item">
                    <input type="checkbox" id="sunday" class="habitWeekDay" value="0">
                    <label for="sunday">ì¼</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="monday" class="habitWeekDay" value="1">
                    <label for="monday">ì›”</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="tuesday" class="habitWeekDay" value="2">
                    <label for="tuesday">í™”</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="wednesday" class="habitWeekDay" value="3">
                    <label for="wednesday">ìˆ˜</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="thursday" class="habitWeekDay" value="4">
                    <label for="thursday">ëª©</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="friday" class="habitWeekDay" value="5">
                    <label for="friday">ê¸ˆ</label>
                  </div>
                  <div class="checkbox-item">
                    <input type="checkbox" id="saturday" class="habitWeekDay" value="6">
                    <label for="saturday">í† </label>
                  </div>
                </div>
              </div>
              
              <!-- íŠ¹ì •ì¼ ì„ íƒ ì„¤ëª… -->
              <div id="specificDatesContainer" style="display: none; margin-top: 10px;">
                <p>ì•„ë˜ ë‹¬ë ¥ì—ì„œ ì›í•˜ëŠ” ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
              </div>
            </div>
            
            <div class="form-group">
              <label for="habitDescription">ë©”ëª¨ (ì„ íƒì‚¬í•­)</label>
              <textarea id="habitDescription" placeholder="ìŠµê´€ì— ëŒ€í•œ ì¶”ê°€ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            
            <button type="button" onclick="addHabit()">ìŠµê´€ ì¶”ê°€</button>
          </div>
        </div>
        
        <!-- ìº˜ë¦°ë” ì„¹ì…˜ -->
        <div class="habit-section">
          <div class="habit-calendar-container">
            <div class="habit-calendar-header-row">
              <button onclick="prevHabitMonth()">â—€ ì´ì „ ë‹¬</button>
              <div id="habitCalendarHeader">2025ë…„ 4ì›”</div>
              <button onclick="nextHabitMonth()">ë‹¤ìŒ ë‹¬ â–¶</button>
            </div>
            <div id="habitCalendar"></div>
          </div>
        </div>
        
        <!-- ìŠµê´€ ëª©ë¡ -->
        <div class="habit-section">
          <h3>ë‚´ ìŠµê´€ ëª©ë¡</h3>
          <div id="habitsList" class="habit-list">
            <!-- ìŠµê´€ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
          </div>
        </div>
      </div>
    </div>
    
    <div id="journal" class="tab-content">
      <h2>ì¼ê¸°</h2>
      <p>ì´ ê¸°ëŠ¥ì€ ì•„ì§ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.</p>
    </div>
    
    <div id="goals" class="tab-content">
      <h2>ëª©í‘œ</h2>
      <p>ì´ ê¸°ëŠ¥ì€ ì•„ì§ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.</p>
    </div>
    
    <div id="settings" class="tab-content">
      <h2>ì„¤ì •</h2>
      <p>ì´ ê¸°ëŠ¥ì€ ì•„ì§ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.</p>
    </div>
  </div>
</div>

<script>
// Firebase ì´ˆê¸°í™” ë° ë¡œê·¸ì¸ ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸
let firebaseInitialized = false;

function initializeFirebase() {
  if (!firebaseInitialized && typeof firebase !== 'undefined' && firebase.apps.length === 0) {
    const firebaseConfig = {
      apiKey: "AIzaSyAc1vHqkpkK76kYtZazxq2bVso2cPFA1Qw",
      authDomain: "song-homepage.firebaseapp.com",
      projectId: "song-homepage",
      storageBucket: "song-homepage.appspot.com",
      messagingSenderId: "59678249334",
      appId: "1:59678249334:web:83018cd88e5c244ac2cf1a",
      measurementId: "G-3YSWN7XH2W"
    };
    firebase.initializeApp(firebaseConfig);
    firebaseInitialized = true;
    const userId = localStorage.getItem("uid") || Date.now().toString();
    localStorage.setItem("uid", userId);
    console.log('Firebase ì´ˆê¸°í™” ì™„ë£Œ, ì‚¬ìš©ì ID:', userId);
    return true;
  }
  return firebaseInitialized;
}

function checkPassword(event) {
  event.preventDefault();
  const input = document.getElementById('password').value;
  const errorMsg = document.getElementById('error-msg');

  if (input === 'sik282') {
    localStorage.setItem('loggedIn', 'true');
    document.getElementById('password-screen').style.display = 'none';
    document.getElementById('main-content').style.display = 'block';
    if (initializeFirebase()) {
      loadInitialData();
    }
  } else {
    errorMsg.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤';
  }
}

document.addEventListener('DOMContentLoaded', function() {
  if (localStorage.getItem('loggedIn') === 'true') {
    document.getElementById('password-screen').style.display = 'none';
    document.getElementById('main-content').style.display = 'block';
    if (initializeFirebase()) {
      loadInitialData();
    }
  }
  
  // íƒ­ ì „í™˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
  document.querySelectorAll('.tab-link').forEach(tab => {
    tab.addEventListener('click', function(e) {
      e.preventDefault();
      const tabId = this.getAttribute('data-tab');
      
      // íƒ­ ë§í¬ í™œì„±í™”
      document.querySelectorAll('.tab-link').forEach(t => {
        t.classList.remove('active');
      });
      this.classList.add('active');
      
      // íƒ­ ì»¨í…ì¸  í™œì„±í™”
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(tabId).classList.add('active');
      
      // ìŠµê´€ íƒ­ì´ í™œì„±í™”ë˜ë©´ ìŠµê´€ ê¸°ëŠ¥ ì´ˆê¸°í™”
      if (tabId === 'habits') {
        initializeHabitFunctions();
        renderHabits();
        renderHabitCalendar();
      }
    });
  });
});

// ì´ˆê¸° ë°ì´í„° ë¡œë“œ
function loadInitialData() {
  console.log('ì´ˆê¸° ë°ì´í„° ë¡œë“œ');
  
  // Firebaseì—ì„œ ë°ì´í„° ë¡œë“œ
  const dbRef = firebase.database().ref(localStorage.getItem("uid"));
  
  dbRef.child('habits').get().then((snapshot) => {
    if (snapshot.exists()) {
      habits = snapshot.val();
      localStorage.setItem('habits', JSON.stringify(habits));
      renderHabits();
    } else {
      // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¡œë“œ
      const storedHabits = localStorage.getItem('habits');
      if (storedHabits) {
        habits = JSON.parse(storedHabits);
      }
    }
    renderHabits();
  });
  
  dbRef.child('habitRecords').get().then((snapshot) => {
    if (snapshot.exists()) {
      habitRecords = snapshot.val();
      localStorage.setItem('habitRecords', JSON.stringify(habitRecords));
    } else {
      // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¡œë“œ
      const storedRecords = localStorage.getItem('habitRecords');
      if (storedRecords) {
        habitRecords = JSON.parse(storedRecords);
      }
    }
    renderHabitCalendar();
  });
}

// Firebaseì— ë°ì´í„° ì €ì¥
function saveToFirebase(path, data) {
  if (!firebaseInitialized) return;
  
  const userId = localStorage.getItem("uid");
  if (!userId) return;
  
  firebase.database().ref(userId).child(path).set(data)
    .then(() => {
      console.log(`${path} ë°ì´í„°ê°€ Firebaseì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    })
    .catch((error) => {
      console.error(`Firebase ì €ì¥ ì˜¤ë¥˜: ${error.message}`);
    });
}

// ===== ìŠµê´€ íŠ¸ë˜ì»¤ ê¸°ëŠ¥ =====

// ì „ì—­ ë³€ìˆ˜
let habits = JSON.parse(localStorage.getItem('habits') || '[]');
let habitRecords = JSON.parse(localStorage.getItem('habitRecords') || '[]');
let selectedSpecificDates = [];

// í˜„ì¬ ë‹¬ë ¥ ë‚ ì§œ
const today = new Date();
let currentHabitYear = today.getFullYear();
let currentHabitMonth = today.getMonth();

// ìŠµê´€ ì£¼ê¸°ì— ë”°ë¥¸ ì˜µì…˜ í† ê¸€
function toggleWeekdayOptions() {
  const frequency = document.getElementById('habitFrequency').value;
  const weekdayOptionContainer = document.getElementById('weekdayOptionContainer');
  const specificDatesContainer = document.getElementById('specificDatesContainer');
  
  if (frequency === 'weekly') {
    if (weekdayOptionContainer) weekdayOptionContainer.style.display = 'block';
    if (specificDatesContainer) specificDatesContainer.style.display = 'none';
    
    // ìš”ì¼ ì˜µì…˜ ê¸°ë³¸ê°’ ì„¤ì •
    const weekdaysOption = document.getElementById('weekdaysOption');
    if (weekdaysOption) weekdaysOption.checked = true;
    
    toggleCustomWeekdays();
  } 
  else if (frequency === 'specific') {
    if (weekdayOptionContainer) weekdayOptionContainer.style.display = 'none';
    if (specificDatesContainer) specificDatesContainer.style.display = 'block';
    
    // íŠ¹ì •ì¼ ì„ íƒ ëª¨ë“œ í™œì„±í™”
    enableSpecificDateSelection();
  } 
  else {
    if (weekdayOptionContainer) weekdayOptionContainer.style.display = 'none';
    if (specificDatesContainer) specificDatesContainer.style.display = 'none';
  }
}

// ì¹´í…Œê³ ë¦¬ ì§ì ‘ ì…ë ¥ í† ê¸€
function toggleHabitCategoryInput() {
  const category = document.getElementById('habitCategory').value;
  const customCategoryInput = document.getElementById('habitCustomCategory');
  
  if (category === 'custom') {
    if (customCategoryInput) customCategoryInput.style.display = 'block';
  } else {
    if (customCategoryInput) customCategoryInput.style.display = 'none';
  }
}

// ì»¤ìŠ¤í…€ ìš”ì¼ ì˜µì…˜ í† ê¸€
function toggleCustomWeekdays() {
  const weekdayOption = document.querySelector('input[name="weekdayOption"]:checked')?.value;
  const customWeekdaysContainer = document.getElementById('customWeekdaysContainer');
  
  if (weekdayOption === 'custom') {
    if (customWeekdaysContainer) customWeekdaysContainer.style.display = 'block';
  } else {
    if (customWeekdaysContainer) customWeekdaysContainer.style.display = 'none';
  }
}

// íŠ¹ì •ì¼ ì„ íƒ í™œì„±í™”
function enableSpecificDateSelection() {
  console.log("íŠ¹ì •ì¼ ì„ íƒ ëª¨ë“œ í™œì„±í™”");
  
  // íŠ¹ì •ì¼ ì„ íƒì„ ìœ„í•œ ì „ì—­ ë°°ì—´ ì´ˆê¸°í™”
  selectedSpecificDates = selectedSpecificDates || [];
  
  // ì„ íƒëœ ë‚ ì§œ í‘œì‹œ
  setTimeout(() => {
    const calendarDays = document.querySelectorAll('.habit-calendar-day');
    calendarDays.forEach(day => {
      const dateStr = day.querySelector('.habit-items')?.dataset.date;
      if (dateStr && selectedSpecificDates.includes(dateStr)) {
        day.classList.add('specific-date-selected');
      }
      
      // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
      day.style.cursor = 'pointer';
      day.addEventListener('click', function(e) {
        if (document.getElementById('habitFrequency')?.value !== 'specific') return;
        
        const dateElement = this.querySelector('.habit-items');
        if (!dateElement) return;
        
        const dateStr = dateElement.dataset.date;
        if (!dateStr) return;
        
        // ë‚ ì§œ í† ê¸€
        const dateIndex = selectedSpecificDates.indexOf(dateStr);
        if (dateIndex === -1) {
          selectedSpecificDates.push(dateStr);
          this.classList.add('specific-date-selected');
        } else {
          selectedSpecificDates.splice(dateIndex, 1);
          this.classList.remove('specific-date-selected');
        }
      });
    });
  }, 100);
}

// ìŠµê´€ ì¶”ê°€
function addHabit() {
  const title = document.getElementById('habitTitle').value.trim();
  const category = document.getElementById('habitCategory').value;
  const customCategory = document.getElementById('habitCustomCategory')?.value.trim();
  const frequency = document.getElementById('habitFrequency').value;
  const description = document.getElementById('habitDescription').value.trim();
  
  if (!title) {
    alert('ìŠµê´€ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  // ì‹¤ì œ ì‚¬ìš©í•  ì¹´í…Œê³ ë¦¬
  const finalCategory = category === 'custom' ? customCategory : category;
  
  // ì£¼ê¸°ì— ë”°ë¥¸ ë‚ ì§œ ì„¤ì •
  let weekDays = [];
  let specificDates = [];
  
  if (frequency === 'weekly') {
    const weekdayOption = document.querySelector('input[name="weekdayOption"]:checked')?.value;
    
    if (weekdayOption === 'weekdays' || !weekdayOption) {
      // ì£¼ 5ì¼(ì›”-ê¸ˆ) ì„ íƒ
      weekDays = [1, 2, 3, 4, 5]; // ì›”í™”ìˆ˜ëª©ê¸ˆ (1-5)
    } else if (weekdayOption === 'custom') {
      // ì§ì ‘ ì„ íƒ
      const checkboxes = document.querySelectorAll('.habitWeekDay:checked');
      weekDays = Array.from(checkboxes).map(cb => parseInt(cb.value));
      
      if (weekDays.length === 0) {
        alert('í•˜ë‚˜ ì´ìƒì˜ ìš”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
    }
  } 
  else if (frequency === 'specific') {
    // íŠ¹ì •ì¼ ì²˜ë¦¬
    specificDates = selectedSpecificDates || [];
    
    if (specificDates.length === 0) {
      alert('í•˜ë‚˜ ì´ìƒì˜ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
      return;
    }
  }
  
  const habit = {
    id: Date.now(),
    title,
    category: finalCategory,
    frequency,
    weekDays, // ì£¼ê°„ì¸ ê²½ìš°ë§Œ ì‚¬ìš©ë¨
    specificDates, // íŠ¹ì •ì¼ì¸ ê²½ìš°ë§Œ ì‚¬ìš©ë¨
    description,
    createdAt: new Date().toISOString(),
    streak: 0, // ì´ˆê¸° ì—°ì† ê¸°ë¡ì€ 0
    color: getRandomHabitColor() // ëœë¤ ìƒ‰ìƒ ì§€ì •
  };
  
  habits.push(habit);
  
  // ì €ì¥
  localStorage.setItem('habits', JSON.stringify(habits));
  saveToFirebase('habits', habits);
  
  // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
  document.getElementById('habitTitle').value = '';
  document.getElementById('habitCategory').value = 'health';
  if (document.getElementById('habitCustomCategory')) {
    document.getElementById('habitCustomCategory').value = '';
    document.getElementById('habitCustomCategory').style.display = 'none';
  }
  document.getElementById('habitFrequency').value = 'daily';
  
  // ì£¼ê°„ ì˜µì…˜ ì´ˆê¸°í™”
  const weekdayOptionContainer = document.getElementById('weekdayOptionContainer');
  const customWeekdaysContainer = document.getElementById('customWeekdaysContainer');
  const specificDatesContainer = document.getElementById('specificDatesContainer');
  
  if (weekdayOptionContainer) weekdayOptionContainer.style.display = 'none';
  if (customWeekdaysContainer) customWeekdaysContainer.style.display = 'none';
  if (specificDatesContainer) specificDatesContainer.style.display = 'none';
  
  // ìš”ì¼ ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
  document.querySelectorAll('.habitWeekDay').forEach(cb => cb.checked = false);
  
  // ì£¼ 5ì¼ ì˜µì…˜ì´ ê¸°ë³¸ê°’ì´ ë˜ë„ë¡ ì„¤ì •
  const weekdaysOption = document.getElementById('weekdaysOption');
  if (weekdaysOption) weekdaysOption.checked = true;
  
  // íŠ¹ì •ì¼ ì„ íƒ ì´ˆê¸°í™”
  selectedSpecificDates = [];
  document.querySelectorAll('.habit-calendar-day').forEach(day => {
    day.classList.remove('specific-date-selected');
  });
  
  document.getElementById('habitDescription').value = '';
  
  // ìŠµê´€ ëª©ë¡ ë° ë‹¬ë ¥ ë Œë”ë§
  renderHabits();
  renderHabitCalendar();
  
  alert('ìƒˆë¡œìš´ ìŠµê´€ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
}

// ëœë¤ ìƒ‰ìƒ ìƒì„±
function getRandomHabitColor() {
  const colors = [
    '#5f7561', '#4CAF50', '#8BC34A', '#2196F3', '#9C27B0',
    '#FF9800', '#9E9E9E', '#607D8B', '#795548', '#FF5722'
  ];
  
  return colors[Math.floor(Math.random() * colors.length)];
}

// ìŠµê´€ ë Œë”ë§
function renderHabits() {
  const habitsList = document.getElementById('habitsList');
  
  if (!habitsList) return;
  
  if (habits.length === 0) {
    habitsList.innerHTML = '<p class="no-habits" style="text-align: center; color: #888; padding: 20px;">ì•„ì§ ì¶”ê°€ëœ ìŠµê´€ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ìŠµê´€ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>';
    return;
  }
  
  habitsList.innerHTML = '';
  
  // ìƒì„±ì¼ ê¸°ì¤€ ì •ë ¬ (ìµœì‹  ìˆœ)
  habits.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
  
  habits.forEach(habit => {
    const habitItem = document.createElement('div');
    habitItem.className = 'habit-list-item';
    
    // ìŠµê´€ ë¹ˆë„ í…ìŠ¤íŠ¸ ìƒì„±
    let frequencyText = 'ë§¤ì¼';
    if (habit.frequency === 'weekly') {
      const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
      
      // ì£¼ 5ì¼(ì›”-ê¸ˆ) ì—¬ë¶€ í™•ì¸
      if (JSON.stringify(habit.weekDays.sort()) === JSON.stringify([1, 2, 3, 4, 5])) {
        frequencyText = 'ì£¼ 5ì¼ (ì›”-ê¸ˆ)';
      } else {
        const selectedDays = habit.weekDays.map(day => days[day]).join(', ');
        frequencyText = `ë§¤ì£¼ ${selectedDays}ìš”ì¼`;
      }
    } else if (habit.frequency === 'monthly') {
      frequencyText = 'ë§¤ì›”';
    } else if (habit.frequency === 'specific') {
      // íŠ¹ì •ì¼ì€ ì„ íƒëœ ë‚ ì§œ ìˆ˜ë¥¼ í‘œì‹œ
      const datesCount = (habit.specificDates || []).length;
      frequencyText = `íŠ¹ì •ì¼ (${datesCount}ì¼)`;
    }
    
    // ì—°ì† ë‹¬ì„± ì¼ìˆ˜ ê³„ì‚°
    const streak = calculateHabitStreak(habit);
    
    habitItem.innerHTML = `
      <div class="habit-list-header">
        <div class="habit-list-title">${habit.title}</div>
        <div class="habit-list-category">${habit.category}</div>
      </div>
      
      <div>${frequencyText}</div>
      ${habit.description ? `<div style="margin-top: 8px; color: #666;">${habit.description}</div>` : ''}
      
      <div class="habit-streak">
        <span class="habit-streak-number">${streak}</span> ì¼ ì—°ì† ë‹¬ì„± ì¤‘
      </div>
      
      <div class="habit-list-controls">
        <button onclick="checkHabitToday(${habit.id})">ì˜¤ëŠ˜ ì²´í¬</button>
        <button onclick="viewHabitHistory(${habit.id})">ê¸°ë¡ ë³´ê¸°</button>
        <button class="delete-btn" onclick="deleteHabit(${habit.id})">ì‚­ì œ</button>
      </div>
    `;
    
    habitsList.appendChild(habitItem);
  });
}

// ìŠµê´€ ë‹¬ë ¥ ë Œë”ë§
function renderHabitCalendar() {
  const habitCalendar = document.getElementById('habitCalendar');
  const habitCalendarHeader = document.getElementById('habitCalendarHeader');
  
  if (!habitCalendar || !habitCalendarHeader) return;
  
  habitCalendarHeader.textContent = `${currentHabitYear}ë…„ ${currentHabitMonth + 1}ì›”`;
  
  // í˜„ì¬ ì›”ì˜ ì²«ë‚ ê³¼ ë§ˆì§€ë§‰ ë‚ 
  const firstDay = new Date(currentHabitYear, currentHabitMonth, 1);
  const lastDay = new Date(currentHabitYear, currentHabitMonth + 1, 0);
  
  // ì²«ì§¸ ë‚ ì˜ ìš”ì¼ (0: ì¼ìš”ì¼, 6: í† ìš”ì¼)
  const firstDayOfWeek = firstDay.getDay();
  
  // ë§ˆì§€ë§‰ ë‚ ì§œ
  const lastDate = lastDay.getDate();
  
  // ì˜¤ëŠ˜ ë‚ ì§œ
  const today = new Date();
  const isCurrentMonth = today.getFullYear() === currentHabitYear && today.getMonth() === currentHabitMonth;
  const todayDate = today.getDate();
  
  // ë‹¬ë ¥ ìƒì„±
  let calendarHTML = '<div class="habit-calendar-header">';
  const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
  
  // ìš”ì¼ í—¤ë”
  for (let i = 0; i < 7; i++) {
    calendarHTML += `<div class="habit-calendar-day-name">${days[i]}</div>`;
  }
  
  calendarHTML += '</div><div class="habit-calendar-body">';
  
  // ì²«ì§¸ ë‚  ì´ì „ì˜ ë¹ˆ ì…€
  for (let i = 0; i < firstDayOfWeek; i++) {
    calendarHTML += '<div class="habit-calendar-day other-month"></div>';
  }
  
  // ë‚ ì§œ ì±„ìš°ê¸°
  for (let day = 1; day <= lastDate; day++) {
    const date = new Date(currentHabitYear, currentHabitMonth, day);
    const dateStr = date.toISOString().split('T')[0];
    const isToday = isCurrentMonth && day === todayDate;
    
    // íŠ¹ì •ì¼ ì„ íƒ ëª¨ë“œì—ì„œ ì„ íƒëœ ë‚ ì§œì¸ì§€ í™•ì¸
    const isSelectedDate = selectedSpecificDates && selectedSpecificDates.includes(dateStr);
    
    calendarHTML += `
      <div class="habit-calendar-day ${isToday ? 'today' : ''} ${isSelectedDate ? 'specific-date-selected' : ''}">
        <div class="habit-day-number">${day}</div>
        <div class="habit-items" data-date="${dateStr}">
    `;
    
    // ì˜¤ëŠ˜ê³¼ ê·¸ ì´ì „ ë‚ ì§œì—ë§Œ ìŠµê´€ ì²´í¬ í•­ëª© í‘œì‹œ
    const isPastOrToday = new Date(dateStr) <= today;
    
    if (isPastOrToday) {
      // í•´ë‹¹ ë‚ ì§œì— ì²´í¬ ê°€ëŠ¥í•œ ìŠµê´€ ëª©ë¡ í‘œì‹œ
      habits.forEach(habit => {
        // í•´ë‹¹ ë‚ ì§œì— ì´ ìŠµê´€ì´ ì²´í¬ ê°€ëŠ¥í•œì§€ í™•ì¸
        if (isHabitScheduledForDate(habit, date)) {
          // ì´ ë‚ ì§œì— ìŠµê´€ì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
          const isCompleted = isHabitCompletedOnDate(habit.id, dateStr);
          
          calendarHTML += `
            <div class="habit-item">
              <span class="habit-circle ${isCompleted ? 'completed' : 'missed'}" 
                    style="background-color: ${isCompleted ? habit.color : '#eee'}; border-color: ${habit.color};"
                    title="${habit.title}"></span>
              <span>${habit.title}</span>
            </div>
          `;
        }
      });
    }
    
    calendarHTML += '</div></div>';
  }
  
  // ë§ˆì§€ë§‰ ì£¼ ì´í›„ì˜ ë¹ˆ ì…€ ì±„ìš°ê¸°
  const lastDayOfWeek = lastDay.getDay();
  const remainingCells = 6 - lastDayOfWeek;
  
  for (let i = 0; i < remainingCells; i++) {
    calendarHTML += '<div class="habit-calendar-day other-month"></div>';
  }
  
  calendarHTML += '</div>';
  habitCalendar.innerHTML = calendarHTML;
  
  // ìƒˆ ë‹¬ë ¥ì´ ë Œë”ë§ëœ í›„ì— íŠ¹ì •ì¼ ëª¨ë“œì—ì„œ ë‚ ì§œ ì„ íƒì„ ê°€ëŠ¥í•˜ê²Œ í•¨
  if (document.getElementById('habitFrequency')?.value === 'specific') {
    enableSpecificDateSelection();
  }
}

// ìŠµê´€ì´ íŠ¹ì • ë‚ ì§œì— ì˜ˆì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
function isHabitScheduledForDate(habit, date) {
  const dateStr = date.toISOString().split('T')[0];
  const dayOfWeek = date.getDay(); // 0(ì¼) ~ 6(í† )
  
  switch (habit.frequency) {
    case 'daily':
      return true;
    case 'weekly':
      return habit.weekDays.includes(dayOfWeek);
    case 'monthly':
      // ë§¤ì›” ê°™ì€ ë‚ ì§œì— ìŠµê´€ ì²´í¬
      const habitStartDate = new Date(habit.createdAt);
      return date.getDate() === habitStartDate.getDate();
    case 'specific':
      // íŠ¹ì •ì¼ ëª©ë¡ì— ìˆëŠ” ë‚ ì§œë§Œ ì²´í¬
      return habit.specificDates && habit.specificDates.includes(dateStr);
    default:
      return false;
  }
}

// ìŠµê´€ì´ íŠ¹ì • ë‚ ì§œì— ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
function isHabitCompletedOnDate(habitId, dateStr) {
  return habitRecords.some(record => 
    record.habitId === habitId && 
    record.date === dateStr && 
    record.completed
  );
}

// ì˜¤ëŠ˜ ìŠµê´€ ì²´í¬
function checkHabitToday(habitId) {
  const habit = habits.find(h => h.id === habitId);
  if (!habit) return;
  
  const today = new Date();
  const dateStr = today.toISOString().split('T')[0];
  
  // í•´ë‹¹ ìŠµê´€ì´ ì˜¤ëŠ˜ ì²´í¬ ê°€ëŠ¥í•œì§€ í™•ì¸
  if (!isHabitScheduledForDate(habit, today)) {
    alert('ì˜¤ëŠ˜ì€ ì´ ìŠµê´€ì˜ ì²´í¬ ë‚ ì§œê°€ ì•„ë‹™ë‹ˆë‹¤.');
    return;
  }
  
  // ì´ë¯¸ ì²´í¬í•œ ê²½ìš°
  const existingRecord = habitRecords.find(r => 
    r.habitId === habitId && r.date === dateStr
  );
  
  if (existingRecord) {
    // í† ê¸€: ì²´í¬ë˜ì–´ ìˆìœ¼ë©´ ì²´í¬ í•´ì œ, ì•„ë‹ˆë©´ ì²´í¬
    existingRecord.completed = !existingRecord.completed;
    
    if (existingRecord.completed) {
      alert('ì˜¤ëŠ˜ì˜ ìŠµê´€ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ğŸ‘');
    } else {
      alert('ìŠµê´€ ì²´í¬ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
  } else {
    // ìƒˆë¡œìš´ ê¸°ë¡ ì¶”ê°€
    const newRecord = {
      habitId,
      date: dateStr,
      completed: true
    };
    
    habitRecords.push(newRecord);
    alert('ì˜¤ëŠ˜ì˜ ìŠµê´€ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ğŸ‘');
  }
  
  // ì—°ì† ë‹¬ì„± ì¼ìˆ˜ ì—…ë°ì´íŠ¸
  updateHabitStreak(habit);
  
  // ì €ì¥ ë° ì—…ë°ì´íŠ¸
  localStorage.setItem('habitRecords', JSON.stringify(habitRecords));
  saveToFirebase('habitRecords', habitRecords);
  
  renderHabits();
  renderHabitCalendar();
}

// ìŠµê´€ ì—°ì† ë‹¬ì„± ì¼ìˆ˜ ê³„ì‚°
function calculateHabitStreak(habit) {
  // ì—­ìˆœìœ¼ë¡œ ë‚ ì§œ í™•ì¸ (ì˜¤ëŠ˜ë¶€í„° ê³¼ê±°ë¡œ)
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  
  let streak = 0;
  let date = new Date(today);
  
  // ìµœëŒ€ 365ì¼ê¹Œì§€ë§Œ ì²´í¬ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
  for (let i = 0; i < 365; i++) {
    const dateStr = date.toISOString().split('T')[0];
    
    // í•´ë‹¹ ë‚ ì§œì— ìŠµê´€ ì²´í¬ê°€ ì˜ˆì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
    if (isHabitScheduledForDate(habit, date)) {
      // ìŠµê´€ì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
      const completed = isHabitCompletedOnDate(habit.id, dateStr);
      
      if (completed) {
        streak++;
      } else {
        // ì™„ë£Œë˜ì§€ ì•Šì€ ë‚ ì§œê°€ ìˆìœ¼ë©´ ì¤‘ë‹¨
        break;
      }
    }
    
    // ì´ì „ ë‚ ì§œë¡œ ì´ë™
    date.setDate(date.getDate() - 1);
  }
  
  return streak;
}

// ìŠµê´€ ì—°ì† ë‹¬ì„± ì¼ìˆ˜ ì—…ë°ì´íŠ¸
function updateHabitStreak(habit) {
  const habitIndex = habits.findIndex(h => h.id === habit.id);
  if (habitIndex === -1) return;
  
  const streak = calculateHabitStreak(habit);
  habits[habitIndex].streak = streak;
  
  // ì €ì¥
  localStorage.setItem('habits', JSON.stringify(habits));
  saveToFirebase('habits', habits);
}

// ìŠµê´€ ê¸°ë¡ ë³´ê¸°
function viewHabitHistory(habitId) {
  const habit = habits.find(h => h.id === habitId);
  if (!habit) return;
  
  // í•´ë‹¹ ìŠµê´€ì˜ ëª¨ë“  ê¸°ë¡ ê°€ì ¸ì˜¤ê¸°
  const records = habitRecords.filter(r => r.habitId === habitId);
  
  // ë‚ ì§œìˆœ ì •ë ¬
  records.sort((a, b) => new Date(b.date) - new Date(a.date));
  
  let historyText = `${habit.title} ê¸°ë¡\n\n`;
  
  if (records.length === 0) {
    historyText += "ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.";
  } else {
    records.forEach(record => {
      historyText += `${formatDate(record.date)}: ${record.completed ? 'âœ“ ì™„ë£Œ' : 'âœ— ë¯¸ì™„ë£Œ'}\n`;
    });
  }
  
  alert(historyText);
}

// ìŠµê´€ ì‚­ì œ
function deleteHabit(habitId) {
  if (confirm('ì´ ìŠµê´€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    habits = habits.filter(h => h.id !== habitId);
    habitRecords = habitRecords.filter(r => r.habitId !== habitId);
    
    // ì €ì¥ ë° ì—…ë°ì´íŠ¸
    localStorage.setItem('habits', JSON.stringify(habits));
    localStorage.setItem('habitRecords', JSON.stringify(habitRecords));
    
    saveToFirebase('habits', habits);
    saveToFirebase('habitRecords', habitRecords);
    
    renderHabits();
    renderHabitCalendar();
    
    alert('ìŠµê´€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
  }
}

// ìŠµê´€ ë‹¬ë ¥ ì´ì „ë‹¬/ë‹¤ìŒë‹¬ ì´ë™
function prevHabitMonth() {
  currentHabitMonth--;
  if (currentHabitMonth < 0) {
    currentHabitMonth = 11;
    currentHabitYear--;
  }
  renderHabitCalendar();
}

function nextHabitMonth() {
  currentHabitMonth++;
  if (currentHabitMonth > 11) {
    currentHabitMonth = 0;
    currentHabitYear++;
  }
  renderHabitCalendar();
}

// ìŠµê´€ ê¸°ëŠ¥ ì´ˆê¸°í™”
function initializeHabitFunctions() {
  // ì˜µì…˜ ì„¤ì •ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
  const habitFrequency = document.getElementById('habitFrequency');
  if (habitFrequency) {
    habitFrequency.removeEventListener('change', toggleWeekdayOptions);
    habitFrequency.addEventListener('change', toggleWeekdayOptions);
  }
  
  const habitCategory = document.getElementById('habitCategory');
  if (habitCategory) {
    habitCategory.removeEventListener('change', toggleHabitCategoryInput);
    habitCategory.addEventListener('change', toggleHabitCategoryInput);
  }
  
  // ì£¼ê°„ ì˜µì…˜ ë¼ë””ì˜¤ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
  const weekdayOptions = document.querySelectorAll('input[name="weekdayOption"]');
  weekdayOptions.forEach(option => {
    option.removeEventListener('change', toggleCustomWeekdays);
    option.addEventListener('change', toggleCustomWeekdays);
  });
  
  // íŠ¹ì •ì¼ ëª¨ë“œì—ì„œ ë‹¬ë ¥ í™œì„±í™”
  if (habitFrequency?.value === 'specific') {
    enableSpecificDateSelection();
  }
}

// ë‚ ì§œ í¬ë§·íŒ… ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
function formatDate(dateString) {
  const date = new Date(dateString);
  return `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›” ${date.getDate()}ì¼`;
}

function formatDateTime(dateString) {
  const date = new Date(dateString);
  return `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›” ${date.getDate()}ì¼ ${date.getHours()}ì‹œ ${String(date.getMinutes()).padStart(2, '0')}ë¶„`;
}
</script>
</body>
</html>