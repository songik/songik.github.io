
<!DOCTYPE html>

<html lang="ko">
<head>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCnHq4KAqxfu8ZzzzgW9o2hFcP_",
    authDomain: "song-homepage.firebaseapp.com",
    projectId: "song-homepage",
    storageBucket: "song-homepage.appspot.com",
    messagingSenderId: "596762043944",
    appId: "1:596762043944:web:e01fc8d0b8e62b4ad2cfcf",
    measurementId: "G-JS9M7Z3MCY"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const userId = "defaultUser";
</script>

<!-- Firebase App (the core Firebase SDK) -->



<!-- Firebase App (the core Firebase SDK) -->


<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>í”ë“¤ê°ˆëŒ€</title>
<style>
  body {
    margin: 0;
    font-family: 'Arial', sans-serif;
    background-color: #f0f0f0;
  }
  #password-screen {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background-color: #4a665b;
    color: #fff;
  }
  #password-screen input {
    padding: 10px;
    font-size: 16px;
    border: none;
    border-radius: 5px;
    margin-top: 10px;
  }
  #main-content {
    display: none;
  }

.habit-entry {
  margin-top: 5px;
  padding: 2px 6px;
  border-radius: 4px;
  display: inline-block;
  background-color: #ffecb3;
  cursor: pointer;
}
.habit-entry.selected {
  background-color: #c8e6c9;
}
</style>
<style>
/* ë‹¬ë ¥ì—ì„œ ì„ íƒëœ ë‚ ì§œ ìŠ¤íƒ€ì¼ */
.calendar-table td.selected {
    background-color: #e8f4f1;
    border: 2px solid #5f7561;
    box-shadow: 0 0 8px rgba(95, 117, 97, 0.3);
    position: relative;
}

.calendar-table td.selected::after {
    content: "";
    position: absolute;
    bottom: 4px;
    right: 4px;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background-color: #5f7561;
    animation: pulse 1.5s infinite;
}

.calendar-day.selected {
    background-color: #e8f4f1;
    border: 2px solid #5f7561 !important;
    box-shadow: 0 0 8px rgba(95, 117, 97, 0.3);
}

/* ì˜¤ëŠ˜ ë‚ ì§œ ìŠ¤íƒ€ì¼ */
.calendar-table td.today {
    background-color: #f5f0e5;
    border: 2px solid #e3b587;
}

.calendar-day.today {
    background-color: #f5f0e5;
    border: 2px solid #e3b587;
}

/* í˜¸ë²„ íš¨ê³¼ */
.calendar-table td:hover {
    background-color: #f9f9f9;
    cursor: pointer;
    transform: scale(1.05);
    transition: all 0.2s ease;
    z-index: 5;
}

.calendar-day:hover {
    transform: scale(1.05) !important;
    z-index: 6;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

/* í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ */
@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.3; }
    100% { opacity: 1; }
}
</style>



































<!-- Firebase App (the core Firebase SDK) -->


<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>í”ë“¤ê°ˆëŒ€ HOME</title>
<style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, 'Nanum Gothic', sans-serif;
        }
        
        body {
            background-color: #d7d5cb;
            color: #2c3e50;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.15);
            border-radius: 8px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        header {
            background-color: #5f7561;
            color: white;
            padding: 30px 0;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(95, 117, 97, 0.7);
            z-index: 1;
        }
        
        header h1, header p {
            position: relative;
            z-index: 2;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        nav {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            background-color: #34403a;
            padding: 12px;
            border-radius: 8px;
            flex-wrap: wrap;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            padding: 10px 18px;
            margin: 5px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        nav a:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .active {
            background-color: #9ab39c;
            color: #34403a;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .tab-content.active {
            display: block;
        }
        
        h2 {
            color: #34403a;
            margin-bottom: 20px;
        }
        
        /* ì¼ê¸°ì¥ ìŠ¤íƒ€ì¼ */
        .diary-entry {
            background-color: #f9f9f9;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            border-left: 4px solid #9ab39c;
        }
        
        .diary-date {
            font-weight: bold;
            color: #5f7561;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        
        .diary-content {
            white-space: pre-wrap;
            line-height: 1.7;
        }
        
        .diary-meta {
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: #888;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        button {
            background-color: #5f7561;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 5px;
        }
        
        button:hover {
            background-color: #34403a;
        }
        
        button.delete-btn {
            background-color: #e74c3c;
        }
        
        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        /* í• ì¼ ìŠ¤íƒ€ì¼ */
        .todo-item {
            background-color: #f9f9f9;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #9ab39c;
        }
        
        .todo-text {
            flex: 1;
            display: flex;
            align-items: center;
        }
        
        .todo-text input[type="checkbox"] {
            margin-right: 10px;
        }
        
        /* ë‹¬ë ¥ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .calendar-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed; /* ì¹¸ í¬ê¸° ê³ ì • */
        }
        
        .calendar-table th {
            background-color: #f0f0f0;
            padding: 8px;
            border: 1px solid #ddd;
        }
        
        .calendar-table td {
            border: 1px solid #ddd;
            height: 80px; /* ê³ ì • ë†’ì´ */
            vertical-align: top;
            position: relative;
            width: 14.28%; /* ëª¨ë“  ì—´ì˜ ë„ˆë¹„ë¥¼ ë™ì¼í•˜ê²Œ */
            overflow: hidden; /* ë‚´ìš©ì´ ë„˜ì¹˜ë©´ ìˆ¨ê¹€ */
        }
        
        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
        }
        
        .calendar-title {
            font-weight: bold;
        }
        
        .day-number {
            font-weight: bold;
            margin-bottom: 5px;
            display: block;
        }
        
/* ì²´ì¤‘ ê¸°ë¡ ì¤‘ì•™ ì •ë ¬ ìŠ¤íƒ€ì¼ */
.weight-entry {
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 16px;
    font-weight: bold;
    color: #3b82f6;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(235, 245, 251, 0.7);
    padding: 4px 8px;
    border-radius: 5px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    z-index: 2;
}

/* ë‹¬ë ¥ ì…€ ìœ„ì¹˜ ê´€ë ¨ ì„¤ì • */
.calendar-table td {
    border: 1px solid #ddd;
    height: 80px;
    vertical-align: top;
    position: relative;
    width: 14.28%;
    overflow: visible; /* ì²´ì¤‘ í‘œì‹œê°€ ì˜ë¦¬ì§€ ì•Šë„ë¡ ë³€ê²½ */
}

        /* í• ì¼ ë‹¬ë ¥ ìŠ¤íƒ€ì¼ */
        .todo-entry {
            display: flex;
            align-items: center;
            font-size: 12px;
            margin-top: 4px;
            max-width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .todo-entry input[type="checkbox"] {
            margin-right: 4px;
            flex-shrink: 0;
        }
        
        .todo-text.completed {
            text-decoration: line-through;
            color: #888;
        }
        
        /* ìŠ¤ì¼€ì¤„ ê´€ë¦¬ ìŠ¤íƒ€ì¼ */
        .schedule {
            margin-bottom: 30px;
            position: relative;
            z-index: 1;
        }
        
        .schedule table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            border-radius: 5px;
        }
        
        .schedule th, .schedule td {
            border: 1px solid #e0e0e0;
            padding: 14px;
            text-align: left;
        }
        
        .schedule th {
            background-color: #9ab39c;
            color: white;
            font-weight: 500;
        }
        
        .schedule tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .schedule tr:hover {
            background-color: #d7d5cb;
        }
        
        .schedule-form {
            margin-top: 25px;
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border-left: 4px solid #9ab39c;
        }
        
        /* ìŠ¤ì¼€ì¤„ ë³´ê¸° ë°©ì‹ */
        .schedule-view-options {
            margin-top: 35px;
        }
        
        .view-options {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .view-option {
            background-color: #d7d5cb;
            border: 1px solid #d0d5d1;
            color: #34403a;
            padding: 10px 18px;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 5px;
            font-weight: 500;
        }
        
        .view-option.active {
            background-color: #5f7561;
            color: white;
            border-color: #5f7561;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }
        
        .schedule-view {
            display: none;
        }
        
        .schedule-view.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ë‹¬ë ¥ ìŠ¤íƒ€ì¼ */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background-color: #9ab39c;
            padding: 15px;
            border-radius: 8px 8px 0 0;
            color: white;
        }
        
        .calendar-header button {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .calendar-header button:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .calendar-grid {
            border: 1px solid #e0e0e0;
            border-radius: 0 0 8px 8px;
            overflow: hidden;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.05);
        }
        
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background-color: #d7d5cb;
            font-weight: bold;
        }
        
        .day-name {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .calendar-dates {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-auto-rows: minmax(120px, auto);
            background-color: white;
        }
        
        .calendar-day {
            border: 1px solid #e0e0e0;
            padding: 8px;
            min-height: 120px;
            background-color: white;
            position: relative;
            transition: all 0.2s;
        }
        
        .calendar-day:hover {
            background-color: #f9f9f9;
            transform: scale(1.02);
            z-index: 5;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .day-number {
            position: absolute;
            top: 8px;
            right: 8px;
            font-weight: bold;
            color: #34403a;
        }
        
        .calendar-day.today {
            background-color: #e8f4f1;
            border: 2px solid #9ab39c;
        }
        
        .calendar-day.other-month {
            background-color: #f9f9f9;
            color: #bbb;
        }
        
        .calendar-day.selected {
            background-color: #f5f0e5;
            border: 2px solid #e3b587;
        }
        
        .calendar-day.has-events {
            position: relative;
        }
        
        .calendar-day.has-events::after {
            content: "";
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #e3b587;
            border-radius: 50%;
            top: 8px;
            left: 8px;
            box-shadow: 0 0 5px rgba(227, 181, 135, 0.7);
        }
        
        .event-list {
            margin-top: 25px;
            font-size: 0.85rem;
            overflow: hidden;
        }
        
        .event-item {
            background-color: #5f7561;
            color: white;
            padding: 4px 8px;
            margin-bottom: 3px;
            border-radius: 3px;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
        }
        
        .event-item:hover {
            transform: translateX(3px);
            background-color: #34403a;
        }
        
        .event-details {
            margin-top: 25px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.05);
        }
        
        .event-day-item {
            background-color: white;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
            border-left: 4px solid #9ab39c;
            transition: all 0.2s;
        }
        
        .event-day-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .event-time {
            font-weight: bold;
            color: #5f7561;
            margin-bottom: 5px;
        }
        
        .no-events {
            font-style: italic;
            color: #999;
            text-align: center;
            padding: 15px;
        }
        
        /* ê°€ê³„ë¶€ ìŠ¤íƒ€ì¼ */
        .accountbook {
            margin-bottom: 30px;
        }
        
        .accountbook-form {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #9ab39c;
        }
        
        .accountbook-list {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .accountbook-list th {
            background-color: #eef;
            padding: 10px;
            text-align: left;
        }
        
        .accountbook-list td {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .accountbook-list tr:hover {
            background-color: #f5f5f5;
        }
        
        .accountbook-summary {
            margin: 20px 0;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        
        .chart-container {
            background-color: #fdfdfd;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 5px rgba(0,0,0,0.05);
            margin: 20px auto;
            max-width: 650px;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            background-color: #34403a;
            color: white;
            border-radius: 8px;
        }

        /* í—¤ë” ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
        .header-image {
            position: relative;
            z-index: 2;
            max-width: 100%;
            height: auto;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
/* ê²€ìƒ‰ ê²°ê³¼ ìŠ¤íƒ€ì¼ */
.search-results {
  margin-top: 20px;
}

.search-result-item {
  background-color: #f9f9f9;
  padding: 15px;
  margin-bottom: 10px;
  border-radius: 8px;
  border-left: 4px solid #9ab39c;
}

.search-result-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 8px;
}

.search-result-category {
  font-size: 0.85rem;
  padding: 2px 8px;
  background-color: #5f7561;
  color: white;
  border-radius: 4px;
}

.search-result-date {
  color: #777;
  font-size: 0.85rem;
}

.search-result-title {
  font-weight: bold;
  margin-bottom: 5px;
}

.search-result-content {
  margin-bottom: 10px;
}

.search-result-highlight {
  background-color: #fff3cd;
  padding: 0 2px;
  border-radius: 2px;
}

.no-results {
  text-align: center;
  color: #888;
  padding: 20px;
}

/* ëª©í‘œ ìŠ¤íƒ€ì¼ */
.goal-item {
  background-color: #f9f9f9;
  padding: 20px;
  margin-bottom: 20px;
  border-radius: 8px;
  border-left: 4px solid #9ab39c;
}

.goal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.goal-title {
  font-weight: bold;
  font-size: 1.1rem;
  color: #34403a;
}

.goal-category {
  padding: 4px 8px;
  background-color: #5f7561;
  color: white;
  border-radius: 4px;
  font-size: 0.85rem;
}

.goal-info {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  margin-bottom: 15px;
}

.goal-info-item {
  flex: 1;
  min-width: 100px;
}

.goal-info-label {
  font-size: 0.8rem;
  color: #777;
}

.goal-info-value {
  font-weight: bold;
  color: #333;
}

.goal-progress {
  margin-bottom: 15px;
}

.goal-progress-bar {
  height: 20px;
  background-color: #eee;
  border-radius: 10px;
  overflow: hidden;
  margin-top: 5px;
}

.goal-progress-fill {
  height: 100%;
  background-color: #5f7561;
  border-radius: 10px;
  width: 0%;
  transition: width 0.5s ease;
}

.goal-controls {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

/* ìŠµê´€ ìŠ¤íƒ€ì¼ */
.habit-calendar {
  margin-top: 15px;
  background-color: white;
  border-radius: 8px;
  padding: 15px;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
}

.habit-calendar-header {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  text-align: center;
  font-weight: bold;
  margin-bottom: 10px;
}

.habit-calendar-body {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 5px;
}

.habit-calendar-day {
  background-color: #f9f9f9;
  border-radius: 5px;
  padding: 10px 5px;
  min-height: 100px;
  position: relative;
}

.habit-calendar-day.other-month {
  background-color: #f0f0f0;
  color: #bbb;
}

.habit-calendar-day.today {
  background-color: #e8f4f1;
  border: 2px solid #9ab39c;
}

.habit-day-number {
  position: absolute;
  top: 5px;
  right: 5px;
  font-weight: bold;
  font-size: 0.85rem;
}

.habit-items {
  margin-top: 20px;
}

.habit-item {
  margin-bottom: 5px;
  font-size: 0.85rem;
  display: flex;
  align-items: center;
}

.habit-checkbox {
  margin-right: 5px;
  cursor: pointer;
}

.habit-checkbox.completed {
  color: #5f7561;
}

.habit-list-item {
  background-color: #f9f9f9;
  padding: 15px;
  margin-bottom: 15px;
  border-radius: 8px;
  border-left: 4px solid #9ab39c;
}

.habit-list-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.habit-list-title {
  font-weight: bold;
  color: #34403a;
}

.habit-list-category {
  padding: 3px 6px;
  background-color: #5f7561;
  color: white;
  border-radius: 4px;
  font-size: 0.8rem;
}

.habit-streak {
  margin-top: 10px;
  padding: 8px;
  background-color: #e8f4f1;
  border-radius: 5px;
  text-align: center;
}

.habit-streak-number {
  font-size: 1.1rem;
  font-weight: bold;
  color: #5f7561;
}

.habit-list-controls {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 10px;
}

/* ìŠµê´€ ì›í˜• í‘œì‹œ ìŠ¤íƒ€ì¼ */
.habit-circle {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  margin-right: 5px;
  display: inline-block;
  vertical-align: middle;
}

.habit-circle.completed {
  background-color: #5f7561;
  border: 2px solid #34403a;
}

.habit-circle.missed {
  background-color: #e74c3c;
  border: 2px solid #c0392b;
}

.habit-circle.future {
  background-color: #eee;
  border: 2px solid #ddd;
}

.habit-circle.not-scheduled {
  background-color: #f9f9f9;
  border: 2px solid #ddd;
}
    </style>

































<script>
  

  if (!firebase.apps.length) {
    
  }

  const db = ;
  
  localStorage.setItem("uid", userId);

  function saveToFirebase(key, data) {
    db.ref(`${userId}/${key}`).set(data);
  }

  function loadFromFirebase(key, callback) {
    db.ref(`${userId}/${key}`).once('value').then(snapshot => {
      callback(snapshot.val());
    });
  }

  window.addEventListener('load', function() {
    const keys = ["diaries", "memos", "goals", "schedules", "habits", "moneybook"];
    const renderMap = {
      diaries: typeof renderDiaryList === "function" ? renderDiaryList : null,
      memos: typeof renderMemoList === "function" ? renderMemoList : null,
      goals: typeof renderGoalList === "function" ? renderGoalList : null,
      schedules: typeof renderScheduleList === "function" ? renderScheduleList : null,
      habits: typeof renderHabitList === "function" ? renderHabitList : null,
      moneybook: typeof renderMoneybookList === "function" ? renderMoneybookList : null
    };

    keys.forEach(key => {
      loadFromFirebase(key, function(data) {
        if (data) {
          try {
            localStorage.setItem(key, JSON.stringify(data));
            if (renderMap[key]) renderMap[key]();
          } catch (e) {
            console.warn("Firebase ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", e);
          }
        }
      });
    });
  });

  const originalSetItem = localStorage.setItem;
  localStorage.setItem = function(key, value) {
    const validKeys = ["diaries", "memos", "goals", "schedules", "habits", "moneybook"];
    if (validKeys.includes(key)) {
      try {
        saveToFirebase(key, JSON.parse(value));
      } catch (e) {
        console.warn("Firebase ì €ì¥ ì˜¤ë¥˜:", e);
      }
    }
    originalSetItem.apply(this, arguments);
  };
</script>


<!-- Firebase SDK -->
</script>
</script>

<script>
  

  if (!firebase.apps.length) {
    
  }

  
  
  localStorage.setItem("uid", userId);

  function saveToFirebase(key, data) {
    db.ref(`${userId}/${key}`).set(data);
  }

  function loadFromFirebase(key, callback) {
    db.ref(`${userId}/${key}`).once('value').then(snapshot => {
      callback(snapshot.val());
    });
  }

  window.addEventListener('load', function() {
    const keys = ["diaries", "memos", "goals", "schedules", "habits", "moneybook"];
    const renderMap = {
      diaries: typeof renderDiaryList === "function" ? renderDiaryList : null,
      memos: typeof renderMemoList === "function" ? renderMemoList : null,
      goals: typeof renderGoalList === "function" ? renderGoalList : null,
      schedules: typeof renderScheduleList === "function" ? renderScheduleList : null,
      habits: typeof renderHabitList === "function" ? renderHabitList : null,
      moneybook: typeof renderMoneybookList === "function" ? renderMoneybookList : null
    };

    keys.forEach(key => {
      loadFromFirebase(key, function(data) {
        if (data) {
          try {
            localStorage.setItem(key, JSON.stringify(data));
            if (renderMap[key]) renderMap[key]();
          } catch (e) {
            console.warn("Firebase ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", e);
          }
        }
      });
    });
  });

  const originalSetItem = localStorage.setItem;
  localStorage.setItem = function(key, value) {
    const validKeys = ["diaries", "memos", "goals", "schedules", "habits", "moneybook"];
    if (validKeys.includes(key)) {
      try {
        saveToFirebase(key, JSON.parse(value));
      } catch (e) {
        console.warn("Firebase ì €ì¥ ì˜¤ë¥˜:", e);
      }
    }
    originalSetItem.apply(this, arguments);
  };
</script>

</head>
<body onload="loadInitialData()">
<!-- ë©”ì¸ ì»¨í…ì¸  -->
<div class="container">
<header><img src="logo.png" style="height: 60px; margin-bottom: 10px;"/>
<p id="preview-text">í—›ë˜ì´ ë³´ë‚¸ ì˜¤ëŠ˜ì€, ì£½ì€ì´ê°€ ê·¸í† ë¡ ë°”ë¼ë˜ ë‚´ì¼ì´ì—ˆë‹¤</p>
<audio autoplay="" hidden="" id="bgm" loop="" src="bgm.mp3"></audio>
</header>
<nav>
<a class="nav-link active" href="#" onclick="showTab('home')">HOME</a>
<a class="nav-link" href="#" onclick="showTab('schedule')">ìŠ¤ì¼€ì¤„</a>
<a class="nav-link" href="#" onclick="showTab('diary')">ê¸°ë¡</a>
<a class="nav-link" href="#" onclick="showTab('memo')">ë©”ëª¨</a>
<a class="nav-link" href="#" onclick="showTab('todo')">ë­í•´?</a>
<a class="nav-link" href="#" onclick="showTab('weight')">ê·¸ë§Œë¨¹ì–´</a>
<a class="nav-link" href="#" onclick="showTab('accountbook')">ê·¸ë§Œì¨</a>
<a class="nav-link" href="#" onclick="showTab('search')">ê²€ìƒ‰</a>
<a class="nav-link" href="#" onclick="showTab('goals')">ëª©í‘œ</a>
<a class="nav-link" href="#" onclick="showTab('habits')">ìŠµê´€</a>
</nav>
<!-- íƒ­ ì»¨í…ì¸  -->
<div class="tab-content active" id="home"><div style="text-align: center; margin-top: 20px;"><video autoplay="True" loop="True" muted="True" style="width: 40%; height: auto; border-radius: 12px; box-shadow: 0 0 20px rgba(0,0,0,0.2);"><source src="video.mp4" type="video/mp4"/>ë™ì˜ìƒì„ ì¬ìƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</video></div></div>
<!-- ìŠ¤ì¼€ì¤„ íƒ­ -->
<div class="tab-content" id="schedule">
<h2>ë‚´ ìŠ¤ì¼€ì¤„</h2>
<div class="schedule">
<div class="schedule-form">
<h3>ìƒˆ ì¼ì • ì¶”ê°€</h3>
<div class="form-group">
<label for="eventTitle">ì œëª©</label>
<input id="eventTitle" placeholder="ì¼ì • ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" type="text"/>
</div>
<div class="form-group">
<label for="eventDate">ë‚ ì§œ</label>
<input id="eventDate" type="date"/>
</div>
<div class="form-group">
<label for="eventTime">ì‹œê°„</label>
<input id="eventTime" type="time"/>
</div>
<div class="form-group">
<label for="eventDescription">ìƒì„¸ ë‚´ìš©</label>
<textarea id="eventDescription" placeholder="ì¼ì •ì— ëŒ€í•œ ìƒì„¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" rows="3"></textarea>
</div>
<button id="addScheduleBtn">ì¼ì • ì¶”ê°€</button>
</div>
<!-- ìŠ¤ì¼€ì¤„ ë³´ê¸° ë°©ì‹ ì„ íƒ -->
<div class="schedule-view-options">
<h3>ì¼ì • ë³´ê¸°</h3>
<div class="view-options">
<button class="view-option active" id="viewListBtn">ë¦¬ìŠ¤íŠ¸ í˜•ì‹</button>
<button class="view-option" id="viewCalendarBtn">ë‹¬ë ¥ í˜•ì‹</button>
</div>
</div>
<!-- ë¦¬ìŠ¤íŠ¸ í˜•ì‹ ë³´ê¸° -->
<div class="schedule-view active" id="listView">
<h3>ë‹¤ê°€ì˜¤ëŠ” ì¼ì •</h3>
<table id="scheduleTable">
<thead>
<tr>
<th>ë‚ ì§œ</th>
<th>ì‹œê°„</th>
<th>ì œëª©</th>
<th>ìƒì„¸ ë‚´ìš©</th>
<th>ì‘ì—…</th>
</tr>
</thead>
<tbody>
<!-- ì¼ì • í•­ëª©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
</tbody>
</table>
</div>
<!-- ë‹¬ë ¥ í˜•ì‹ ë³´ê¸° -->
<div class="schedule-view" id="calendarView">
<div class="calendar-header">
<button id="prevMonthBtn">&lt;</button>
<h3 id="currentMonthYear">2025ë…„ 4ì›”</h3>
<button id="nextMonthBtn">&gt;</button>
</div>
<div class="calendar-grid">
<div class="calendar-days">
<div class="day-name">ì¼</div>
<div class="day-name">ì›”</div>
<div class="day-name">í™”</div>
<div class="day-name">ìˆ˜</div>
<div class="day-name">ëª©</div>
<div class="day-name">ê¸ˆ</div>
<div class="day-name">í† </div>
</div>
<div class="calendar-dates" id="calendarDays">
<!-- ë‹¬ë ¥ ë‚ ì§œê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
</div>
</div>
<div class="event-details" id="eventDetails">
<h3>ì¼ì • ìƒì„¸ ì •ë³´</h3>
<div id="selectedDateEvents">
<!-- ì„ íƒëœ ë‚ ì§œì˜ ì¼ì •ì´ í‘œì‹œë©ë‹ˆë‹¤ -->
<p class="no-events">ë‚ ì§œë¥¼ ì„ íƒí•˜ë©´ ì¼ì •ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>
</div>
</div>
</div>
</div>
</div>
<!-- ê¸°ë¡(ì¼ê¸°) íƒ­ -->
<div class="tab-content" id="diary">
<h2>ì¼ê¸°ì¥</h2>
<div class="form-group">
<label for="diaryDate">ë‚ ì§œ</label>
<input id="diaryDate" type="date"/>
</div>
<div class="form-group">
<label for="diaryContent">ë‚´ìš©</label>
<textarea id="diaryContent" placeholder="ì˜¤ëŠ˜ì˜ ì¼ê¸°ë¥¼ ì‘ì„±í•˜ì„¸ìš”..." rows="6"></textarea>
</div>
<button onclick="saveDiary()">ì €ì¥</button>
<h3 style="margin-top: 30px;">ë‚´ ì¼ê¸° ëª©ë¡</h3>
<div id="diaryEntries">
<!-- ì¼ê¸° í•­ëª©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
</div>
</div>
<!-- ë©”ëª¨ íƒ­ -->
<div class="tab-content" id="memo">
<h2>ë©”ëª¨ì¥</h2>
<div class="form-group">
<label for="memoTitle">ì œëª©</label>
<input id="memoTitle" placeholder="ë©”ëª¨ ì œëª©" type="text"/>
</div>
<div class="form-group">
<label for="memoContent">ë‚´ìš©</label>
<textarea id="memoContent" placeholder="ë©”ëª¨ ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš”..." rows="4"></textarea>
</div>
<button onclick="saveMemo()">ì €ì¥</button>
<h3 style="margin-top: 30px;">ë‚´ ë©”ëª¨ ëª©ë¡</h3>
<div id="memoList">
<!-- ë©”ëª¨ í•­ëª©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
</div>
</div>
<!-- í• ì¼ íƒ­ (ì´ë¦„ ë³€ê²½: í• ì¼ -> ë­í•´?) -->
<div class="tab-content" id="todo">
<h2>ë­í•´? (í•  ì¼ ëª©ë¡)</h2>
<div class="form-group" style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
<div style="flex: 1;">
<input id="todoInput" placeholder="í•  ì¼ì„ ì…ë ¥í•˜ì„¸ìš”" style="width: 100%;" type="text"/>
</div>
<div>
<label for="todoDate">ë‚ ì§œ:</label>
<input id="todoDate" style="margin-left: 5px;" type="date"/>
</div>
<button onclick="addTodo()" style="width: auto;">ì¶”ê°€</button>
</div>
<div id="editTodoForm" style="display: none; background-color: #d7d5cb; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
<h3 style="margin-top: 0;">í•  ì¼ ìˆ˜ì •</h3>
<div class="form-group">
<input id="editTodoInput" type="text"/>
<div style="margin-top: 10px;">
<label for="editTodoDate">ë‚ ì§œ:</label>
<input id="editTodoDate" type="date"/>
</div>
<input id="editTodoId" type="hidden"/>
</div>
<div style="display: flex; justify-content: flex-end; gap: 10px;">
<button onclick="updateTodo()">ìˆ˜ì • ì™„ë£Œ</button>
<button onclick="cancelEdit()" style="background-color: #95a5a6;">ì·¨ì†Œ</button>
</div>
</div>
<div id="todoList" style="margin-top: 20px;">
<!-- í•  ì¼ í•­ëª©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
</div>
<h3 style="margin-top: 30px;">ë‹¬ë ¥ ë³´ê¸° (ê°„ë‹¨ í‘œì‹œ)</h3>
<div class="calendar-nav">
<button onclick="prevTodoMonth()">â—€ ì´ì „ë‹¬</button>
<span class="calendar-title" id="todoCalendarHeader"></span>
<button onclick="nextTodoMonth()">ë‹¤ìŒë‹¬ â–¶</button>
</div>
<table class="calendar-table" id="todoCalendarTable">
<thead>
<tr>
<th>ì¼</th><th>ì›”</th><th>í™”</th><th>ìˆ˜</th><th>ëª©</th><th>ê¸ˆ</th><th>í† </th>
</tr>
</thead>
<tbody id="todoCalendarBody"></tbody>
</table>
</div>
<!-- ì²´ì¤‘ ê¸°ë¡ íƒ­ -->
<div class="tab-content" id="weight">
<h2>âš–ï¸ ì²´ì¤‘ ê¸°ë¡</h2>
<div id="weightArea">
<div class="form-group" style="display: flex; flex-wrap: wrap; align-items: center; gap: 12px; margin-bottom: 20px;">
<label for="weightDate">ë‚ ì§œ</label>
<input id="weightDate" required="" type="date"/>
<label for="weightValue">ì²´ì¤‘ (kg)</label>
<input id="weightValue" required="" step="0.1" type="number"/>
<button onclick="saveWeight()">ê¸°ë¡í•˜ê¸°</button>
</div>
<h3>ğŸ“… ë‹¬ë ¥ ë³´ê¸°</h3>
<div class="calendar-nav">
<button onclick="prevWeightMonth()">â—€ ì´ì „ ë‹¬</button>
<div class="calendar-title" id="calendarTitle">2025ë…„ 4ì›”</div>
<button onclick="nextWeightMonth()">ë‹¤ìŒ ë‹¬ â–¶</button>
</div>
<table class="calendar-table" id="weightCalendarTable">
<thead>
<tr>
<th>ì¼</th><th>ì›”</th><th>í™”</th><th>ìˆ˜</th><th>ëª©</th><th>ê¸ˆ</th><th>í† </th>
</tr>
</thead>
<tbody id="calendarBody"></tbody>
</table>
<div class="weight-list-section" style="margin-top: 30px;">
<h3>ğŸ“‹ ì²´ì¤‘ ê¸°ë¡ ëª©ë¡</h3>
<div id="weightListContainer" style="margin-top: 15px;"></div>
</div>
</div>
</div>
<!-- ê°€ê³„ë¶€ íƒ­ (ì¶”ê°€) -->
<div class="tab-content" id="accountbook">
<h2>ğŸ“’ ë‚˜ì˜ ê°€ê³„ë¶€</h2>
<div class="accountbook">
<div class="accountbook-form">
<div class="form-group">
<label for="ab-date">ë‚ ì§œ</label>
<input class="form-input" id="ab-date" type="date"/>
</div>
<div class="form-group">
<label for="ab-amount">ê¸ˆì•¡</label>
<input class="form-input" id="ab-amount" type="number"/>
</div>
<div class="form-group">
<label for="ab-type">ì¢…ë¥˜</label>
<select class="form-input" id="ab-type">
<option value="income">ìˆ˜ì…</option>
<option value="expense">ì§€ì¶œ</option>
</select>
</div>
<div class="form-group">
<label for="ab-category">ì¹´í…Œê³ ë¦¬</label>
<select id="ab-category" name="ab-category">
<option value="ì‹ë¹„(ì¥ë³´ê¸°)">ì‹ë¹„(ì¥ë³´ê¸°)</option>
<option value="ì¿ í° êµ¬ë§¤">ì¿ í° êµ¬ë§¤</option>
<option value="ì£¼ì „ë¶€ë¦¬">ì£¼ì „ë¶€ë¦¬</option>
<option value="ì‡¼í•‘">ì‡¼í•‘</option>
<option value="ìŒì‹_ë°°ë‹¬">ìŒì‹_ë°°ë‹¬</option>
<option value="ìŒì‹_ì˜¨ë¼ì¸ êµ¬ë§¤">ìŒì‹_ì˜¨ë¼ì¸ êµ¬ë§¤</option>
<option value="ì™¸ì‹">ì™¸ì‹</option>
<option value="ì˜ë£Œë¹„">ì˜ë£Œë¹„</option>
<option value="ì¸ê°„ê´€ê³„">ì¸ê°„ê´€ê³„</option>
<option value="ìš´ë™">ìš´ë™</option>
<option value="êµí†µë¹„">êµí†µë¹„</option>
<option value="ì§‘ ê´€ë ¨ ë¬¼í’ˆ">ì§‘ ê´€ë ¨ ë¬¼í’ˆ</option>
<option value="ê°€ì¡±ë¹„">ê°€ì¡±ë¹„</option>
<option value="ë§¤ë‹¬ ê³ ì •ë¹„">ë§¤ë‹¬ ê³ ì •ë¹„</option>
<option value="ë¬¸í™” ìƒí™œ">ë¬¸í™” ìƒí™œ</option>
<option value="ìê¸°ê³„ë°œ">ìê¸°ê³„ë°œ</option>
<option value="ì—…ë¬´ìš©">ì—…ë¬´ìš©</option>
<option value="ê³µìš©">ê³µìš©</option>
<option value="ì°¨ëŸ‰ ìœ ì§€ë¹„">ì°¨ëŸ‰ ìœ ì§€ë¹„</option>
<option value="êµ¬ë…">êµ¬ë…</option>
<option value="ê¸°íƒ€">ê¸°íƒ€</option>
</select>
</div>
<div class="form-group">
<label for="ab-method">ê²°ì œ ë°©ë²•</label>
<select id="ab-method" name="ab-method">
<option value="í˜„ëŒ€ì¹´ë“œ">í˜„ëŒ€ì¹´ë“œ</option>
<option value="ì‚¼ì„±ì¹´ë“œ">ì‚¼ì„±ì¹´ë“œ</option>
<option value="ë¡¯ë°ì¹´ë“œ">ë¡¯ë°ì¹´ë“œ</option>
<option value="ì‹ í•œì¹´ë“œ">ì‹ í•œì¹´ë“œ</option>
<option value="ê³„ì¢Œ">ê³„ì¢Œ</option>
<option value="í˜„ê¸ˆ">í˜„ê¸ˆ</option>
<option value="ê¸°íƒ€">ê¸°íƒ€</option>
</select>
</div>
<div class="form-group">
<label for="ab-memo">ë©”ëª¨</label>
<textarea id="ab-memo" rows="3"></textarea>
</div>
<button id="ab-submit">ê¸°ë¡í•˜ê¸°</button>
</div>
<h3>ğŸ“… ë‹¬ë ¥ ë³´ê¸°</h3>
<div id="ab-calendar" style="min-height:600px; height:600px; margin-bottom:20px; background-color: #f9f9f9; border-radius: 8px; padding: 10px;"></div>
<h3>ğŸ“ƒ ë‚´ì—­ ë¦¬ìŠ¤íŠ¸</h3>
<table class="accountbook-list" id="ab-list">
<thead>
<tr>
<th>ë‚ ì§œ</th><th>ê¸ˆì•¡</th><th>ì¢…ë¥˜</th><th>ì¹´í…Œê³ ë¦¬</th><th>ê²°ì œ</th><th>ë©”ëª¨</th><th>ì‘ì—…</th>
</tr>
</thead>
<tbody>
<!-- ê°€ê³„ë¶€ í•­ëª©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
</tbody>
</table>
<div class="accountbook-summary" id="ab-summary">
<strong>ì´ë²ˆ ë‹¬ ìˆ˜ì…:</strong> 0ì› | <strong>ì§€ì¶œ:</strong> 0ì›
                </div>
<h3>ğŸ“Š í†µê³„ ë³´ê¸°</h3>
<div class="chart-container">
<canvas height="200" id="ab-month-summary" style="max-width:600px; margin:20px auto; display:block;"></canvas>
</div>
<div class="chart-container">
<canvas height="200" id="ab-category-summary" style="max-width:600px; margin:20px auto; display:block;"></canvas>
</div>
<div class="chart-container">
<canvas height="200" id="ab-method-summary" style="max-width:600px; margin:20px auto; display:block;"></canvas>
</div>
</div>
</div>
<!-- ê²€ìƒ‰ íƒ­ -->
<div class="tab-content" id="search">
<h2>ğŸ” í†µí•© ê²€ìƒ‰</h2>
<div class="form-group">
<div style="display: flex; gap: 10px; margin-bottom: 20px;">
<input id="searchInput" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="flex: 1;" type="text"/>
<select class="form-control" id="searchType" style="width: 120px;">
<option value="all">ì „ì²´</option>
<option value="diary">ì¼ê¸°</option>
<option value="memo">ë©”ëª¨</option>
<option value="todo">í• ì¼</option>
<option value="schedule">ì¼ì •</option>
<option value="accountbook">ê°€ê³„ë¶€</option>
<option value="goals">ëª©í‘œ</option>
<option value="habits">ìŠµê´€</option>
</select>
<button onclick="performSearch()">ê²€ìƒ‰</button>
</div>
</div>
<div class="search-results" id="searchResults">
<p class="no-results">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
</div>
</div>
<!-- ëª©í‘œ ì„¤ì • íƒ­ -->
<div class="tab-content" id="goals">
<h2>ğŸ¯ ëª©í‘œ ì„¤ì • ë° ì¶”ì </h2>
<!-- ëª©í‘œ ì¶”ê°€ í¼ -->
<div class="form-group" style="background-color: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #9ab39c;">
<h3 style="margin-top: 0;">ìƒˆ ëª©í‘œ ì¶”ê°€</h3>
<div style="display: flex; flex-wrap: wrap; gap: 15px;">
<div style="flex: 1; min-width: 200px;">
<label for="goalTitle">ëª©í‘œ ì œëª©</label>
<input id="goalTitle" placeholder="ëª©í‘œë¥¼ ì…ë ¥í•˜ì„¸ìš”" type="text"/>
</div>
<div style="flex: 1; min-width: 200px;">
<label for="goalCategory">ì¹´í…Œê³ ë¦¬</label>
<select id="goalCategory" onchange="toggleCategoryInput()">
<option value="weight">ì²´ì¤‘</option>
<option value="finance">ì¬ì •</option>
<option value="study">ê³µë¶€</option>
<option value="fitness">ìš´ë™</option>
<option value="custom">ì§ì ‘ ì…ë ¥</option>
</select>
<!-- ì§ì ‘ ì…ë ¥ í•„ë“œ ì¶”ê°€ -->
<input id="goalCustomCategory" placeholder="ì¹´í…Œê³ ë¦¬ ì§ì ‘ ì…ë ¥" style="display: none; margin-top: 8px; width: 100%;" type="text"/>
</div>
</div>
<div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 15px;">
<div style="flex: 1; min-width: 200px;">
<label for="goalStartValue">ì‹œì‘ ê°’</label>
<input id="goalStartValue" placeholder="í˜„ì¬ ê°’" step="0.01" type="number"/>
</div>
<div style="flex: 1; min-width: 200px;">
<label for="goalTargetValue">ëª©í‘œ ê°’</label>
<input id="goalTargetValue" placeholder="ëª©í‘œ ê°’" step="0.01" type="number"/>
</div>
<div style="flex: 1; min-width: 200px;">
<label for="goalUnit">ë‹¨ìœ„</label>
<input id="goalUnit" placeholder="kg, ë§Œì›, ì‹œê°„ ë“±" type="text"/>
</div>
</div>
<div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 15px;">
<div style="flex: 1; min-width: 200px;">
<label for="goalStartDate">ì‹œì‘ì¼</label>
<input id="goalStartDate" type="date"/>
</div>
<div style="flex: 1; min-width: 200px;">
<label for="goalEndDate">ëª©í‘œì¼</label>
<input id="goalEndDate" type="date"/>
</div>
</div>
<div style="margin-top: 15px;">
<label for="goalDescription">ìƒì„¸ ì„¤ëª…</label>
<textarea id="goalDescription" placeholder="ëª©í‘œì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" rows="3"></textarea>
</div>
<div style="margin-top: 15px; text-align: right;">
<button onclick="addGoal()">ëª©í‘œ ì¶”ê°€</button>
</div>
</div>
<!-- ëª©í‘œ ì§„í–‰ ìƒí™© -->
<h3>ğŸ“Š ë‚´ ëª©í‘œ í˜„í™©</h3>
<div class="goals-list" id="goalsList">
<!-- ëª©í‘œ í•­ëª©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
<p class="no-goals" style="text-align: center; color: #888; padding: 20px;">ì•„ì§ ì„¤ì •ëœ ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ëª©í‘œë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
</div>
<!-- ëª©í‘œ ì—…ë°ì´íŠ¸ í¼ -->
<div id="goalUpdateForm" style="display: none; background-color: #d7d5cb; padding: 15px; border-radius: 8px; margin: 20px 0;">
<h3 style="margin-top: 0;">ëª©í‘œ ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸</h3>
<div style="display: flex; gap: 15px; margin-top: 15px;">
<div style="flex: 1;">
<label for="goalUpdateValue">í˜„ì¬ ê°’</label>
<input id="goalUpdateValue" step="0.01" type="number"/>
</div>
<div style="flex: 1;">
<label for="goalUpdateDate">ë‚ ì§œ</label>
<input id="goalUpdateDate" type="date"/>
</div>
<input id="goalUpdateId" type="hidden"/>
</div>
<div style="margin-top: 15px; text-align: right;">
<button onclick="updateGoalProgress()">ì—…ë°ì´íŠ¸</button>
<button onclick="closeGoalUpdateForm()" style="background-color: #95a5a6;">ì·¨ì†Œ</button>
</div>
</div>
<!-- ì„¸ë¶€ í•­ëª© ì¶”ê°€ í¼ (ë™ì ìœ¼ë¡œ ì¶”ê°€ë  ì˜ˆì •) -->
<div id="subTaskForm" style="display: none; background-color: #d7d5cb; padding: 15px; border-radius: 8px; margin: 20px 0;">
<h3 style="margin-top: 0;">ì„¸ë¶€ í•­ëª© ì¶”ê°€</h3>
<div style="margin-bottom: 15px;">
<label for="subTaskTitle">í•­ëª© ì´ë¦„</label>
<input id="subTaskTitle" style="width: 100%; margin-top: 5px; padding: 8px; border-radius: 5px; border: 1px solid #ccc;" type="text"/>
</div>
<input id="subTaskGoalId" type="hidden"/>
<div style="text-align: right;">
<button onclick="addSubTask()">ì¶”ê°€</button>
<button onclick="closeSubTaskForm()" style="background-color: #95a5a6;">ì·¨ì†Œ</button>
</div>
</div>
</div>
<!-- ìŠµê´€ ì¶”ì  íƒ­ -->
<div class="tab-content" id="habits">
<h2>ğŸ”„ ìŠµê´€ ì¶”ì </h2>
<!-- ìŠµê´€ ì¶”ê°€ í¼ -->
<div class="form-group" style="background-color: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #9ab39c;">
<h3 style="margin-top: 0;">ìƒˆ ìŠµê´€ ì¶”ê°€</h3>
<div style="display: flex; flex-wrap: wrap; gap: 15px;">
<div style="flex: 1; min-width: 200px;">
<label for="habitTitle">ìŠµê´€ ì´ë¦„</label>
<input id="habitTitle" placeholder="ìŠµê´€ì„ ì…ë ¥í•˜ì„¸ìš”" type="text"/>
</div>
<div style="flex: 1; min-width: 200px;">
<label for="habitCategory">ì¹´í…Œê³ ë¦¬</label>
<select id="habitCategory" onchange="toggleHabitCategoryInput()">
<option value="health">ê±´ê°•</option>
<option value="study">ê³µë¶€</option>
<option value="selfcare">ìê¸°ê´€ë¦¬</option>
<option value="work">ì—…ë¬´</option>
<option value="custom">ì§ì ‘ ì…ë ¥</option>
</select>
<!-- ì§ì ‘ ì…ë ¥ í•„ë“œ ì¶”ê°€ -->
<input id="habitCustomCategory" placeholder="ì¹´í…Œê³ ë¦¬ ì§ì ‘ ì…ë ¥" style="display: none; margin-top: 8px; width: 100%;" type="text"/>
</div>
</div>
<div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 15px;">
<div style="flex: 1; min-width: 200px;">
<label for="habitFrequency">ì£¼ê¸°</label>
<select id="habitFrequency" onchange="toggleWeekdayOptions()">
<option value="daily">ë§¤ì¼</option>
<option value="weekly">ë§¤ì£¼</option>
<option value="monthly">ë§¤ì›”</option>
</select>
</div>
<!-- ì£¼ê°„ ì˜µì…˜ ì„ íƒ (ì£¼ 5ì¼ ë˜ëŠ” ì§ì ‘ ì„ íƒ) -->
<div id="weekdayOptionContainer" style="flex: 2; min-width: 300px; display: none;">
<label>ì£¼ê°„ ì˜µì…˜</label>
<div style="display: flex; gap: 15px; margin-top: 5px;">
<label style="display: flex; align-items: center;">
<input checked="" id="weekdaysOption" name="weekdayOption" onchange="toggleCustomWeekdays()" type="radio" value="weekdays"/> 
            ì£¼ 5ì¼ (ì›”-ê¸ˆ)
          </label>
<label style="display: flex; align-items: center;">
<input id="customDaysOption" name="weekdayOption" onchange="toggleCustomWeekdays()" type="radio" value="custom"/> 
            ì§ì ‘ ì„ íƒ
          </label>
</div>
</div>
</div>
<!-- ìš”ì¼ ì§ì ‘ ì„ íƒ ì»¨í…Œì´ë„ˆ -->
<div id="customWeekdaysContainer" style="margin-top: 15px; display: none;">
<label>ìš”ì¼ ì„ íƒ</label>
<div style="display: flex; gap: 8px; margin-top: 5px;">
<label style="display: flex; align-items: center;"><input class="habitWeekDay" type="checkbox" value="0"/> ì¼</label>
<label style="display: flex; align-items: center;"><input class="habitWeekDay" type="checkbox" value="1"/> ì›”</label>
<label style="display: flex; align-items: center;"><input class="habitWeekDay" type="checkbox" value="2"/> í™”</label>
<label style="display: flex; align-items: center;"><input class="habitWeekDay" type="checkbox" value="3"/> ìˆ˜</label>
<label style="display: flex; align-items: center;"><input class="habitWeekDay" type="checkbox" value="4"/> ëª©</label>
<label style="display: flex; align-items: center;"><input class="habitWeekDay" type="checkbox" value="5"/> ê¸ˆ</label>
<label style="display: flex; align-items: center;"><input class="habitWeekDay" type="checkbox" value="6"/> í† </label>
</div>
</div>
<div style="margin-top: 15px;">
<label for="habitDescription">ìƒì„¸ ì„¤ëª…</label>
<textarea id="habitDescription" placeholder="ìŠµê´€ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" rows="2"></textarea>
</div>
<div style="margin-top: 15px; text-align: right;">
<button onclick="addHabit()">ìŠµê´€ ì¶”ê°€</button>
</div>
</div>
<!-- ìŠµê´€ ë‹¬ë ¥ -->
<h3>ğŸ“… ì´ë²ˆ ë‹¬ ìŠµê´€ ë‹¬ë ¥</h3>
<div class="calendar-nav">
<button onclick="prevHabitMonth()">â—€ ì´ì „ë‹¬</button>
<span class="calendar-title" id="habitCalendarHeader"></span>
<button onclick="nextHabitMonth()">ë‹¤ìŒë‹¬ â–¶</button>
</div>
<div class="habit-calendar" id="habitCalendar">
<!-- ìŠµê´€ ë‹¬ë ¥ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
</div>
<!-- ìŠµê´€ ëª©ë¡ -->
<h3 style="margin-top: 30px;">ğŸ“‹ ë‚´ ìŠµê´€ ëª©ë¡</h3>
<div class="habits-list" id="habitsList">
<!-- ìŠµê´€ í•­ëª©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
<p class="no-habits" style="text-align: center; color: #888; padding: 20px;">ì•„ì§ ì¶”ê°€ëœ ìŠµê´€ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ìŠµê´€ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
</div>
</div>
<!-- í™ˆí™”ë©´ ì„¤ì • íƒ­ -->
</div>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.min.js">
function toggleHabit(element) {
    element.classList.toggle("selected");
    if (element.classList.contains("selected")) {
        element.textContent = "âœ… ì¤Œë°”";
    } else {
        element.textContent = "ğŸŸ  ì¤Œë°”";
    }
}
</script>
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
        // ì „ì—­ ë³€ìˆ˜
        let diaries = [];
        let memos = [];
        let todos = [];
        let schedules = [];
        let accountData = []; // ê°€ê³„ë¶€ ë°ì´í„° ì¶”ê°€
        let currentCalendarYear = new Date().getFullYear();
        let currentCalendarMonth = new Date().getMonth();
        let currentTodoYear = new Date().getFullYear();
        let currentTodoMonth = new Date().getMonth();
        let currentScheduleYear = new Date().getFullYear();
        let currentScheduleMonth = new Date().getMonth();
        let selectedDate = null;
        
        // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
        function loadInitialData() {
            document.getElementById("ab-submit")?.addEventListener("click", addAccountItem);

document.getElementById("addScheduleBtn")?.addEventListener("click", addSchedule);

            document.getElementById("ab-submit")?.addEventListener("click", addAccountItem);
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¡œë“œ
            loadDataFromLocalStorage();
            
            loadDiaries();
            loadMemos();
            renderTodos();
            renderTodoCalendar();
            renderWeightCalendar();
            renderWeightList();
            loadSchedules();
            renderScheduleCalendar();
            loadAccountData(); // ê°€ê³„ë¶€ ë°ì´í„° ë¡œë“œ
            applyCustomHome();
            
            // ê¸°ë³¸ ë‚ ì§œ ì„¤ì •
            const today = new Date().toISOString().split('T')[0];
            if (document.getElementById('diaryDate')) document.getElementById('diaryDate').value = today;
            if (document.getElementById('weightDate')) document.getElementById('weightDate').value = today;
            if (document.getElementById('eventDate')) document.getElementById('eventDate').value = today;
            if (document.getElementById('ab-date')) document.getElementById('ab-date').value = today;

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            document.getElementById('save-button').addEventListener('click', saveCustomHome);
            document.getElementById('addScheduleBtn').addEventListener('click', addSchedule);
            document.getElementById('viewListBtn').addEventListener('click', showListView);
            document.getElementById('viewCalendarBtn').addEventListener('click', showCalendarView);
            document.getElementById('prevMonthBtn').addEventListener('click', prevScheduleMonth);
            document.getElementById('nextMonthBtn').addEventListener('click', nextScheduleMonth);
            
            // ê°€ê³„ë¶€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            if (document.getElementById('ab-submit')) {
                document.getElementById('ab-submit').addEventListener('click', addAccountItem);
            }
            
            // í•„ìš”í•œ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ
            loadRequiredLibraries();
        }
        
        // í•„ìš”í•œ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ í•¨ìˆ˜
        function loadRequiredLibraries() {
            // FullCalendar ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ
            if (typeof FullCalendar === 'undefined') {
                // CSS ë¨¼ì € ë¡œë“œ
                const style = document.createElement('link');
                style.rel = 'stylesheet';
                style.href = 'https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.min.css';
                document.head.appendChild(style);
                
                // ê·¸ ë‹¤ìŒ JS ë¡œë“œ
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.min.js';
                script.onload = function() {
                    // ê°€ê³„ë¶€ íƒ­ì´ í˜„ì¬ í™œì„±í™”ë˜ì–´ ìˆëŠ” ê²½ìš°ì—ë§Œ ë‹¬ë ¥ ì´ˆê¸°í™”
                    if (document.getElementById('accountbook').classList.contains('active')) {
                        // FullCalendar ì´ˆê¸°í™” ì „ì— ì•½ê°„ì˜ ì§€ì—° ì¶”ê°€
                        setTimeout(function() {
                            // ë‹¬ë ¥ ì»¨í…Œì´ë„ˆë¥¼ ì´ˆê¸°í™”
                            const calendarEl = document.getElementById('ab-calendar');
                            if (calendarEl) {
                                calendarEl.innerHTML = '';
                                initializeAccountCalendar();
                            }
                        }, 200);
                    }
                };
                document.head.appendChild(script);
            } else if (document.getElementById('accountbook').classList.contains('active')) {
                // FullCalendarê°€ ì´ë¯¸ ë¡œë“œë˜ì–´ ìˆì§€ë§Œ ë‹¬ë ¥ì´ í‘œì‹œë˜ì§€ ì•ŠëŠ” ê²½ìš°
                setTimeout(function() {
                    const calendarEl = document.getElementById('ab-calendar');
                    if (calendarEl && !calendarEl.querySelector('.fc')) {
                        calendarEl.innerHTML = '';
                        initializeAccountCalendar();
                    }
                }, 200);
            }
            
            // Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ
            if (typeof Chart === 'undefined') {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
                script.onload = function() {
                    // ê°€ê³„ë¶€ íƒ­ì´ í˜„ì¬ í™œì„±í™”ë˜ì–´ ìˆëŠ” ê²½ìš°ì—ë§Œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                    if (document.getElementById('accountbook').classList.contains('active')) {
                        createCharts();
                    }
                };
                document.head.appendChild(script);
            }
        }
        
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¡œë“œ
        function loadDataFromLocalStorage() {
            try {
                diaries = JSON.parse(localStorage.getItem('diaries')) || [];
                memos = JSON.parse(localStorage.getItem('memos')) || [];
                todos = JSON.parse(localStorage.getItem('todos')) || [];
                schedules = JSON.parse(localStorage.getItem('schedules')) || [];
                accountData = JSON.parse(localStorage.getItem('accountData')) || []; // ê°€ê³„ë¶€ ë°ì´í„° ì¶”ê°€
            } catch (e) {
                console.error('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
                diaries = [];
                memos = [];
                todos = [];
                schedules = [];
                accountData = [];
            }
        }
        
        // íƒ­ ì „í™˜ ê¸°ëŠ¥
        function showTab(tabId) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            document.getElementById(tabId).classList.add('active');
            document.querySelector(`.nav-link[onclick="showTab('${tabId}')"]`).classList.add('active');
            
            // í•„ìš”í•œ ê²½ìš° íƒ­ ì´ˆê¸°í™”
            if (tabId === 'diary') loadDiaries();
            if (tabId === 'memo') loadMemos();
            if (tabId === 'todo') {
                renderTodos();
                renderTodoCalendar();
            }
            if (tabId === 'weight') {
                renderWeightCalendar();
                renderWeightList();
            }
            
if (tabId === 'schedule') {
    loadSchedules();
    renderScheduleCalendar();

    // ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ ìˆ˜ë™ ì¬ë“±ë¡
    const calBtn = document.getElementById('viewCalendarBtn');
    const listBtn = document.getElementById('viewListBtn');
    if (calBtn) {
        calBtn.removeEventListener('click', showCalendarView);
        calBtn.addEventListener('click', showCalendarView);
    }
    if (listBtn) {
        listBtn.removeEventListener('click', showListView);
        listBtn.addEventListener('click', showListView);
    }

            }
            if (tabId === 'accountbook') {
                loadAccountData();
                
                // ë‹¬ë ¥ì´ í‘œì‹œë˜ì§€ ì•ŠëŠ” ë¬¸ì œ í•´ê²°
                setTimeout(function() {
                    try {
                        const abCalendar = document.getElementById('ab-calendar');
                        if (abCalendar) {
                            // ë‹¬ë ¥ì´ ì œëŒ€ë¡œ ë Œë”ë§ë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸
                            const fcContent = abCalendar.querySelector('.fc');
                            if (!fcContent || fcContent.offsetHeight < 10) {
                                console.log("ë‹¬ë ¥ ë‹¤ì‹œ ì´ˆê¸°í™” ì¤‘...");
                                initializeAccountCalendar();
                            }
                        }
                    } catch (e) {
                        console.error("ë‹¬ë ¥ í™•ì¸ ì˜¤ë¥˜:", e);
                        initializeAccountCalendar();
                    }
                }, 300);
            }
        }
        
        /********** ì¼ê¸°ì¥ ê¸°ëŠ¥ **********/
        function saveDiary() {
            const date = document.getElementById('diaryDate').value;
            const content = document.getElementById('diaryContent').value;
            
            if (!date || !content) {
                alert('ë‚ ì§œì™€ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ê°™ì€ ë‚ ì§œì˜ ì¼ê¸°ê°€ ìˆëŠ”ì§€ í™•ì¸
            const existingIndex = diaries.findIndex(diary => diary.date === date);
            
            if (existingIndex !== -1) {
                if (confirm('ê°™ì€ ë‚ ì§œì˜ ì¼ê¸°ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤. ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    diaries[existingIndex].content = content;
                    diaries[existingIndex].updatedAt = new Date().toISOString();
                } else {
                    return;
                }
            } else {
                const diary = {
                    id: Date.now(),
                    date,
                    content,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                diaries.push(diary);
            }
            
            try {
                localStorage.setItem('diaries', JSON.stringify(diaries));
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('diaryContent').value = '';
                
                loadDiaries();
                alert('ì¼ê¸°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (e) {
                console.error('ì¼ê¸° ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
                alert('ì¼ê¸° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        function loadDiaries() {
            const diaryEntries = document.getElementById('diaryEntries');
            if (!diaryEntries) return;
            
            diaryEntries.innerHTML = '';
            
            // ë‚ ì§œ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬ (ìµœì‹  ì¼ê¸°ê°€ ìœ„ì— í‘œì‹œ)
            diaries.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (diaries.length === 0) {
                diaryEntries.innerHTML = '<p style="text-align: center; color: #888; padding: 20px;">ì €ì¥ëœ ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            diaries.forEach(diary => {
                const entry = document.createElement('div');
                entry.className = 'diary-entry';
                entry.innerHTML = `
                    <div class="diary-date">${formatDate(diary.date)}</div>
                    <div class="diary-content">${diary.content}</div>
                    <div class="diary-meta">
                        ë§ˆì§€ë§‰ ìˆ˜ì •: ${formatDateTime(diary.updatedAt)}
                        <div>
                            <button onclick="editDiary(${diary.id})">ìˆ˜ì •</button>
                            <button class="delete-btn" onclick="deleteDiary(${diary.id})">ì‚­ì œ</button>
                        </div>
                    </div>
                `;
                
                diaryEntries.appendChild(entry);
            });
        }
        
        function editDiary(id) {
            const diary = diaries.find(d => d.id === id);
            if (!diary) return;
            
            document.getElementById('diaryDate').value = diary.date;
            document.getElementById('diaryContent').value = diary.content;
            
            window.scrollTo(0, 0);
            
            // ì›ë˜ ì¼ê¸° ì‚­ì œ (ì €ì¥ ì‹œ ìƒˆë¡œ ì¶”ê°€ë¨)
            deleteDiaryWithoutConfirm(id);
        }
        
        function deleteDiary(id) {
            if (confirm('ì´ ì¼ê¸°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                deleteDiaryWithoutConfirm(id);
                alert('ì¼ê¸°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        function deleteDiaryWithoutConfirm(id) {
            diaries = diaries.filter(diary => diary.id !== id);
            localStorage.setItem('diaries', JSON.stringify(diaries));
            loadDiaries();
        }
        
        /********** ë©”ëª¨ ê¸°ëŠ¥ **********/
        function saveMemo() {
            const title = document.getElementById('memoTitle').value;
            const content = document.getElementById('memoContent').value;
            
            if (!title || !content) {
                alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const memo = {
                id: Date.now(),
                title,
                content,
                createdAt: new Date().toISOString()
            };
            
            memos.push(memo);
            
            try {
                localStorage.setItem('memos', JSON.stringify(memos));
                
                document.getElementById('memoTitle').value = '';
                document.getElementById('memoContent').value = '';
                
                loadMemos();
                alert('ë©”ëª¨ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (e) {
                console.error('ë©”ëª¨ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
                alert('ë©”ëª¨ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        function loadMemos() {
            const memoList = document.getElementById('memoList');
            if (!memoList) return;
            
            memoList.innerHTML = '';
            
            memos.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (memos.length === 0) {
                memoList.innerHTML = '<p style="text-align: center; color: #888; padding: 20px;">ì €ì¥ëœ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            memos.forEach(memo => {
                const memoDiv = document.createElement('div');
                memoDiv.className = 'diary-entry';
                memoDiv.innerHTML = `
                    <div class="diary-date">${memo.title}</div>
                    <div class="memo-content">${memo.content}</div>
                    <div class="diary-meta">
                        ì‘ì„±ì¼: ${formatDateTime(memo.createdAt)}
                        <div>
                            <button onclick="editMemo(${memo.id})">ìˆ˜ì •</button>
                            <button class="delete-btn" onclick="deleteMemo(${memo.id})">ì‚­ì œ</button>
                        </div>
                    </div>
                `;
                
                memoList.appendChild(memoDiv);
            });
        }
        
        function editMemo(id) {
            const memo = memos.find(m => m.id === id);
            if (!memo) return;
            
            document.getElementById('memoTitle').value = memo.title;
            document.getElementById('memoContent').value = memo.content;
            
            window.scrollTo(0, 0);
            
            // ì›ë˜ ë©”ëª¨ ì‚­ì œ (ì €ì¥ ì‹œ ìƒˆë¡œ ì¶”ê°€ë¨)
            deleteMemoWithoutConfirm(id);
        }
        
        function deleteMemo(id) {
            if (confirm('ì´ ë©”ëª¨ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                deleteMemoWithoutConfirm(id);
                alert('ë©”ëª¨ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        function deleteMemoWithoutConfirm(id) {
            memos = memos.filter(memo => memo.id !== id);
            localStorage.setItem('memos', JSON.stringify(memos));
            loadMemos();
        }
        
        /********** í• ì¼ ê¸°ëŠ¥ **********/
function addTodo() {
    const todoInput = document.getElementById('todoInput');
    const todoDateInput = document.getElementById('todoDate');
    const text = todoInput.value.trim();
    
    if (!text) {
        alert('í•  ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    // ì‚¬ìš©ìê°€ ì„ íƒí•œ ë‚ ì§œ ë˜ëŠ” ì˜¤ëŠ˜ ë‚ ì§œ ì‚¬ìš©
    const todoDate = todoDateInput && todoDateInput.value ? todoDateInput.value : new Date().toISOString().split('T')[0];
    
    const todo = {
        id: Date.now(),
        text: text,
        completed: false,
        date: todoDate, // ì„ íƒí•œ ë‚ ì§œ ì €ì¥
        createdAt: new Date().toISOString()
    };
    
    todos.push(todo);
    
    try {
        localStorage.setItem('todos', JSON.stringify(todos));
        
        todoInput.value = '';
        // ë‚ ì§œ í•„ë“œëŠ” ì´ˆê¸°í™”í•˜ì§€ ì•Šê³  ìœ ì§€
        
        renderTodos();
        renderTodoCalendar();
        
        alert('í•  ì¼ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
    } catch (e) {
        console.error('í• ì¼ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
        alert('í• ì¼ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
}
        
        function renderTodos() {
            const todoList = document.getElementById('todoList');
            if (!todoList) return;
            
            todoList.innerHTML = '';
            
            if (todos.length === 0) {
                todoList.innerHTML = '<p style="text-align: center; color: #888; padding: 20px;">í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ í•  ì¼ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>';
                return;
            }
            
            todos.sort((a, b) => {
                // ì™„ë£Œë˜ì§€ ì•Šì€ í•­ëª© ë¨¼ì €
                if (a.completed !== b.completed) {
                    return a.completed ? 1 : -1;
                }
                // ê·¸ ë‹¤ìŒìœ¼ë¡œëŠ” ìµœì‹ ìˆœ
                return new Date(b.createdAt) - new Date(a.createdAt);
            });
            
            todos.forEach(todo => {
                const todoItem = document.createElement('div');
                todoItem.className = 'todo-item';
                todoItem.innerHTML = `
                    <div class="todo-text ${todo.completed ? 'completed' : ''}">
                        <input type="checkbox" ${todo.completed ? 'checked' : ''} onchange="toggleTodo(${todo.id})">
                        <span>${todo.text}</span>
                    </div>
                    <div>
                        <button onclick="editTodo(${todo.id})">ìˆ˜ì •</button>
                        <button class="delete-btn" onclick="deleteTodo(${todo.id})">ì‚­ì œ</button>
                    </div>
                `;
                
                todoList.appendChild(todoItem);
            });
        }
        
       function renderTodoCalendar() {
    const todoCalendarBody = document.getElementById('todoCalendarBody');
    const todoCalendarHeader = document.getElementById('todoCalendarHeader');
    
    if (!todoCalendarBody || !todoCalendarHeader) return;
    
    todoCalendarHeader.textContent = `${currentTodoYear}ë…„ ${currentTodoMonth + 1}ì›”`;
    
    const firstDay = new Date(currentTodoYear, currentTodoMonth, 1).getDay();
    const daysInMonth = new Date(currentTodoYear, currentTodoMonth + 1, 0).getDate();
    
    todoCalendarBody.innerHTML = '';
    
    let row = document.createElement('tr');
    
    // ì²« ì£¼ì˜ ë¹ˆ ì…€ ì±„ìš°ê¸°
    for (let i = 0; i < firstDay; i++) {
        const td = document.createElement('td');
        row.appendChild(td);
    }
    
    // ë‚ ì§œ ì±„ìš°ê¸°
    for (let day = 1; day <= daysInMonth; day++) {
        const td = document.createElement('td');
        
        // í•´ë‹¹ ë‚ ì§œ ë¬¸ìì—´
        const dateStr = `${currentTodoYear}-${String(currentTodoMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        
        // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€ - í•´ë‹¹ ë‚ ì§œë¥¼ í• ì¼ ì…ë ¥ë€ì— ì„¤ì •
        td.addEventListener('click', function() {
            if (document.getElementById('todoDate')) {
                document.getElementById('todoDate').value = dateStr;
                document.getElementById('todoInput').focus();
            }
            
            // ëª¨ë“  ì„ íƒëœ ì…€ ì´ˆê¸°í™”
            document.querySelectorAll('#todoCalendarBody td.selected').forEach(cell => {
                cell.classList.remove('selected');
            });
            
            // í˜„ì¬ ì…€ ì„ íƒ í‘œì‹œ
            this.classList.add('selected');
        });
        
        // ì˜¤ëŠ˜ ë‚ ì§œ ê°•ì¡°
        const today = new Date().toISOString().split('T')[0];
        if (dateStr === today) {
            td.classList.add('today');
        }
        
        // ë‚ ì§œ ìˆ«ì í‘œì‹œ
        const dayNumber = document.createElement('div');
        dayNumber.className = 'day-number';
        dayNumber.textContent = day;
        td.appendChild(dayNumber);
        
        // í•´ë‹¹ ë‚ ì§œì˜ í• ì¼ ì²´í¬
        const todosForDate = todos.filter(todo => todo.date === dateStr);
        
        // í• ì¼ì´ ìˆìœ¼ë©´ ì²´í¬ë°•ìŠ¤ë¡œ í‘œì‹œ
        if (todosForDate.length > 0) {
            const todoContainer = document.createElement('div');
            
            todosForDate.forEach(todo => {
                const todoDiv = document.createElement('div');
                todoDiv.className = 'todo-entry';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = todo.completed;

                checkbox.onclick = function(e) {
                    e.stopPropagation();
                    toggleTodoInCalendar(todo.id);
                };

                const textSpan = document.createElement('span');
                textSpan.textContent = todo.text;
                textSpan.style.overflow = 'hidden';
                textSpan.style.textOverflow = 'ellipsis';
                textSpan.style.whiteSpace = 'nowrap';

                if (todo.completed) {
                    textSpan.style.textDecoration = 'line-through';
                    textSpan.style.color = '#888';
                }

                todoDiv.appendChild(checkbox);
                todoDiv.appendChild(textSpan);
                todoContainer.appendChild(todoDiv);
            });
            
            td.appendChild(todoContainer);
        }
        
        row.appendChild(td);
        
        // í† ìš”ì¼ì´ë‚˜ ì›”ì˜ ë§ˆì§€ë§‰ ë‚ ì´ë©´ ìƒˆ í–‰ ì‹œì‘
        if ((firstDay + day) % 7 === 0 || day === daysInMonth) {
            todoCalendarBody.appendChild(row);
            if (day !== daysInMonth) {
                row = document.createElement('tr');
            }
        }
    }
}
        
        function toggleTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                localStorage.setItem('todos', JSON.stringify(todos));
                renderTodos();
                renderTodoCalendar();
            }
        }
        
        function toggleTodoInCalendar(id) {
            const todo = todos.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                localStorage.setItem('todos', JSON.stringify(todos));
                renderTodos();
                renderTodoCalendar();
            }
        }
        
function editTodo(id) {
    const todo = todos.find(t => t.id === id);
    if (!todo) return;
    
    const editForm = document.getElementById('editTodoForm');
    const editInput = document.getElementById('editTodoInput');
    const editId = document.getElementById('editTodoId');
    
    // ë‚ ì§œ í•„ë“œ í™•ì¸ ë° ì„¤ì •
    const editDateInput = document.getElementById('editTodoDate');
    
    editForm.style.display = 'block';
    editInput.value = todo.text;
    editId.value = todo.id;
    
    // ë‚ ì§œ í•„ë“œê°€ ìˆìœ¼ë©´ ê°’ ì„¤ì •
    if (editDateInput) {
        editDateInput.value = todo.date;
    }
    
    editForm.scrollIntoView({ behavior: 'smooth' });
}
        
function updateTodo() {
    const editInput = document.getElementById('editTodoInput');
    const editId = document.getElementById('editTodoId');
    
    // ë‚ ì§œ ì…ë ¥ë€ ì°¾ê¸°
    const editDateInput = document.getElementById('editTodoDate');
    
    const text = editInput.value.trim();
    const id = parseInt(editId.value);
    
    if (!text) {
        alert('í•  ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    const todoIndex = todos.findIndex(t => t.id === id);
    if (todoIndex !== -1) {
        todos[todoIndex].text = text;
        
        // ë‚ ì§œ í•„ë“œê°€ ìˆìœ¼ë©´ ê°’ ì—…ë°ì´íŠ¸
        if (editDateInput && editDateInput.value) {
            todos[todoIndex].date = editDateInput.value;
        }
        
        try {
            localStorage.setItem('todos', JSON.stringify(todos));
            
            document.getElementById('editTodoForm').style.display = 'none';
            
            renderTodos();
            renderTodoCalendar();
            
            alert('í•  ì¼ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        } catch (e) {
            console.error('í• ì¼ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
            alert('í• ì¼ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }
}
        
        function cancelEdit() {
            document.getElementById('editTodoForm').style.display = 'none';
        }
        
        function deleteTodo(id) {
            if (confirm('ì´ í•  ì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                todos = todos.filter(todo => todo.id !== id);
                localStorage.setItem('todos', JSON.stringify(todos));
                renderTodos();
                renderTodoCalendar();
                alert('í•  ì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        function prevTodoMonth() {
            currentTodoMonth--;
            if (currentTodoMonth < 0) {
                currentTodoMonth = 11;
                currentTodoYear--;
            }
            renderTodoCalendar();
        }
        
        function nextTodoMonth() {
            currentTodoMonth++;
            if (currentTodoMonth > 11) {
                currentTodoMonth = 0;
                currentTodoYear++;
            }
            renderTodoCalendar();
        }
        
        /********** ì²´ì¤‘ ê¸°ë¡ ê¸°ëŠ¥ **********/
        function saveWeight() {
            const date = document.getElementById('weightDate').value;
            const value = document.getElementById('weightValue').value;
            
            if (!date || !value) {
                alert('ë‚ ì§œì™€ ì²´ì¤‘ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            let weightData = {};
            try {
                weightData = JSON.parse(localStorage.getItem('weightRecords') || '{}');
            } catch (e) {
                console.error('ì²´ì¤‘ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
                weightData = {};
            }
            
            if (weightData[date] && !confirm(`${formatDate(date)}ì— ì´ë¯¸ ì²´ì¤‘ì´ ê¸°ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }
            
            weightData[date] = parseFloat(value);
            
            try {
                localStorage.setItem('weightRecords', JSON.stringify(weightData));
                
                document.getElementById('weightValue').value = '';
                
                renderWeightCalendar();
                renderWeightList();
                
                alert('ì²´ì¤‘ì´ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (e) {
                console.error('ì²´ì¤‘ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
                alert('ì²´ì¤‘ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        function renderWeightCalendar() {
            let weightData = {};
            try {
                weightData = JSON.parse(localStorage.getItem('weightRecords') || '{}');
            } catch (e) {
                console.error('ì²´ì¤‘ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
                weightData = {};
            }
            
            const body = document.getElementById('calendarBody');
            const title = document.getElementById('calendarTitle');
            
            if (!body || !title) return;
            
            title.textContent = `${currentCalendarYear}ë…„ ${currentCalendarMonth + 1}ì›”`;
            
            body.innerHTML = '';
        
            const firstDay = new Date(currentCalendarYear, currentCalendarMonth, 1).getDay();
            const daysInMonth = new Date(currentCalendarYear, currentCalendarMonth + 1, 0).getDate();
        
            let row = document.createElement('tr');
            
            // ì²« ì£¼ì˜ ë¹ˆ ì…€ ì±„ìš°ê¸°
            for (let i = 0; i < firstDay; i++) {
                const td = document.createElement('td');
                row.appendChild(td);
            }
        
            // ë‚ ì§œ ì±„ìš°ê¸°
            for (let day = 1; day <= daysInMonth; day++) {
                const td = document.createElement('td');
                const dateKey = `${currentCalendarYear}-${String(currentCalendarMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                // ë‚ ì§œ í‘œì‹œ
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day;
                td.appendChild(dayNumber);
                
                // ì²´ì¤‘ ê¸°ë¡ì´ ìˆìœ¼ë©´ í‘œì‹œ (ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ ì—†ìŒ)
                if (weightData[dateKey]) {
                    const weightDiv = document.createElement('div');
                    weightDiv.className = 'weight-entry';
                    weightDiv.textContent = weightData[dateKey] + "kg";
                    td.appendChild(weightDiv);
                }
                
                row.appendChild(td);
                
                // í† ìš”ì¼ì´ë‚˜ ì›”ì˜ ë§ˆì§€ë§‰ ë‚ ì´ë©´ ìƒˆ í–‰ ì‹œì‘
                if ((firstDay + day) % 7 === 0 || day === daysInMonth) {
                    body.appendChild(row);
                    if (day !== daysInMonth) {
                        row = document.createElement('tr');
                    }
                }
            }
        }
        
        function renderWeightList() {
            const container = document.getElementById('weightListContainer');
            if (!container) return;
            
            let weightData = {};
            try {
                weightData = JSON.parse(localStorage.getItem('weightRecords') || '{}');
            } catch (e) {
                console.error('ì²´ì¤‘ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
                weightData = {};
            }
            
            const entries = Object.entries(weightData).map(([date, weight]) => ({ date, weight }));
            
            if (entries.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #888;">ê¸°ë¡ëœ ì²´ì¤‘ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            entries.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const table = document.createElement('table');
            table.style.width = '100%';
            table.style.borderCollapse = 'collapse';
            table.style.marginBottom = '20px';
            table.style.background = 'white';
            
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr style="background-color: #f0f0f0;">
                    <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">ë‚ ì§œ</th>
                    <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">ì²´ì¤‘</th>
                    <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">ê´€ë¦¬</th>
                </tr>
            `;
            table.appendChild(thead);
            
            const tbody = document.createElement('tbody');
            entries.forEach(entry => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="padding: 10px; border: 1px solid #ddd;">${formatDate(entry.date)}</td>
                    <td style="padding: 10px; text-align: center; border: 1px solid #ddd; font-weight: bold;">${entry.weight} kg</td>
                    <td style="padding: 10px; text-align: center; border: 1px solid #ddd;">
                        <button onclick="editWeight('${entry.date}', ${entry.weight})">ìˆ˜ì •</button>
                        <button class="delete-btn" onclick="deleteWeight('${entry.date}')">ì‚­ì œ</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            table.appendChild(tbody);
            
            container.innerHTML = '';
            container.appendChild(table);
        }
        
        function editWeight(dateKey, currentValue) {
            const newWeight = prompt(`${formatDate(dateKey)}ì˜ ì²´ì¤‘ì„ ìˆ˜ì •í•©ë‹ˆë‹¤. ìƒˆ ì²´ì¤‘ì„ ì…ë ¥í•˜ì„¸ìš”:`, currentValue);
            
            if (newWeight !== null && !isNaN(newWeight) && newWeight.trim() !== '') {
                let weightData = {};
                try {
                    weightData = JSON.parse(localStorage.getItem('weightRecords') || '{}');
                } catch (e) {
                    console.error('ì²´ì¤‘ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
                    weightData = {};
                }
                
                weightData[dateKey] = parseFloat(newWeight);
                
                try {
                    localStorage.setItem('weightRecords', JSON.stringify(weightData));
                    
                    renderWeightCalendar();
                    renderWeightList();
                    
                    alert('ì²´ì¤‘ ê¸°ë¡ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } catch (e) {
                    console.error('ì²´ì¤‘ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
                    alert('ì²´ì¤‘ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }
        
        function deleteWeight(dateKey) {
            if (confirm(`${formatDate(dateKey)}ì˜ ì²´ì¤‘ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                let weightData = {};
                try {
                    weightData = JSON.parse(localStorage.getItem('weightRecords') || '{}');
                } catch (e) {
                    console.error('ì²´ì¤‘ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
                    weightData = {};
                }
                
                delete weightData[dateKey];
                
                try {
                    localStorage.setItem('weightRecords', JSON.stringify(weightData));
                    
                    renderWeightCalendar();
                    renderWeightList();
                    
                    alert('ì²´ì¤‘ ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } catch (e) {
                    console.error('ì²´ì¤‘ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
                    alert('ì²´ì¤‘ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }
        
        function prevWeightMonth() {
            currentCalendarMonth--;
            if (currentCalendarMonth < 0) {
                currentCalendarMonth = 11;
                currentCalendarYear--;
            }
            renderWeightCalendar();
        }
        
        function nextWeightMonth() {
            currentCalendarMonth++;
            if (currentCalendarMonth > 11) {
                currentCalendarMonth = 0;
                currentCalendarYear++;
            }
            renderWeightCalendar();
        }

        /********** ìŠ¤ì¼€ì¤„ ê´€ë¦¬ ê¸°ëŠ¥ **********/
        function addSchedule() {
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const description = document.getElementById('eventDescription').value;
            
            if (!title || !date) {
                alert('ì œëª©ê³¼ ë‚ ì§œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');
                return;
            }
            
            const schedule = {
                id: Date.now(),
                title,
                date,
                time,
                description
            };
            
            schedules.push(schedule);
            localStorage.setItem('schedules', JSON.stringify(schedules));
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventDescription').value = '';
            
            // ë‹¤ì–‘í•œ ë³´ê¸° ëª¨ë“œ ì—…ë°ì´íŠ¸
            loadSchedules();
            renderScheduleCalendar();
            
            alert('ì¼ì •ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        function loadSchedules() {
            const tbody = document.querySelector('#scheduleTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬
            schedules.sort((a, b) => new Date(a.date + ' ' + (a.time || '00:00')) - new Date(b.date + ' ' + (b.time || '00:00')));
            
            if (schedules.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;">ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            schedules.forEach(schedule => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${formatDate(schedule.date)}</td>
                    <td>${schedule.time || '-'}</td>
                    <td>${schedule.title}</td>
                    <td>${schedule.description || '-'}</td>
                    <td>
                        <button onclick="editSchedule(${schedule.id})">ìˆ˜ì •</button>
                        <button class="delete-btn" onclick="deleteSchedule(${schedule.id})">ì‚­ì œ</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        function editSchedule(id) {
            const schedule = schedules.find(s => s.id === id);
            if (!schedule) return;
            
            document.getElementById('eventTitle').value = schedule.title;
            document.getElementById('eventDate').value = schedule.date;
            document.getElementById('eventTime').value = schedule.time || '';
            document.getElementById('eventDescription').value = schedule.description || '';
            
            // í•´ë‹¹ ì¼ì • ì‚­ì œ (ì €ì¥ ì‹œ ìƒˆë¡œ ì¶”ê°€ë¨)
            deleteScheduleWithoutConfirm(id);
            
            // ìŠ¤í¬ë¡¤ì„ ë§¨ ìœ„ë¡œ ì´ë™
            window.scrollTo(0, 0);
            
            // íƒ­ ì „í™˜
            showTab('schedule');
        }

        function deleteSchedule(id) {
            if (confirm('ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                deleteScheduleWithoutConfirm(id);
                alert('ì¼ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        function deleteScheduleWithoutConfirm(id) {
            schedules = schedules.filter(schedule => schedule.id !== id);
            localStorage.setItem('schedules', JSON.stringify(schedules));
            loadSchedules();
            renderScheduleCalendar();
            
            // ì„ íƒëœ ë‚ ì§œê°€ ìˆë‹¤ë©´ í•´ë‹¹ ë‚ ì§œì˜ ì´ë²¤íŠ¸ ëª©ë¡ ì—…ë°ì´íŠ¸
            if (selectedDate) {
                const selectedDateObj = new Date(currentScheduleYear, currentScheduleMonth, selectedDate);
                showEventsForDate(selectedDateObj);
            }
        }

        
function showCalendarView() {
    document.getElementById('viewListBtn')?.classList.remove('active');
    document.getElementById('viewCalendarBtn')?.classList.add('active');
    document.getElementById('listView')?.classList.remove('active');
    document.getElementById('calendarView')?.classList.add('active');

    renderScheduleCalendar();
}


        function showListView() {
            document.getElementById('viewListBtn').classList.add('active');
            document.getElementById('viewCalendarBtn').classList.remove('active');
            document.getElementById('listView').classList.add('active');
            document.getElementById('calendarView').classList.remove('active');
        }

function renderScheduleCalendar() {
    const calendarDays = document.getElementById('calendarDays');
    const currentMonthYear = document.getElementById('currentMonthYear');
    
    if (!calendarDays || !currentMonthYear) return;
    
    // ì›”/ë…„ í—¤ë” ì„¤ì •
    currentMonthYear.textContent = `${currentScheduleYear}ë…„ ${currentScheduleMonth + 1}ì›”`;
    
    // í˜„ì¬ ì›”ì˜ ì²«ë‚ 
    const firstDay = new Date(currentScheduleYear, currentScheduleMonth, 1);
    
    // í˜„ì¬ ì›”ì˜ ë§ˆì§€ë§‰ ë‚ 
    const lastDay = new Date(currentScheduleYear, currentScheduleMonth + 1, 0);
    
    // ì²«ë‚ ì˜ ìš”ì¼ (0: ì¼ìš”ì¼, 6: í† ìš”ì¼)
    const firstDayWeekday = firstDay.getDay();
    
    // ë‹¬ë ¥ ì…€ ì´ˆê¸°í™”
    calendarDays.innerHTML = '';
    
    // ì´ì „ ë‹¬ ë‚ ì§œ ì±„ìš°ê¸°
    for (let i = 0; i < firstDayWeekday; i++) {
        const dayDiv = document.createElement('div');
        dayDiv.className = 'calendar-day other-month';
        dayDiv.innerHTML = `<div class="day-number"></div>`;
        calendarDays.appendChild(dayDiv);
    }
    
    // ì˜¤ëŠ˜ ë‚ ì§œ ì •ë³´
    const today = new Date();
    const todayDate = today.getDate();
    const todayMonth = today.getMonth();
    const todayYear = today.getFullYear();
    
    // í˜„ì¬ ë‹¬ ë‚ ì§œ ì±„ìš°ê¸°
    for (let i = 1; i <= lastDay.getDate(); i++) {
        const dayDiv = document.createElement('div');
        dayDiv.className = 'calendar-day';
        
        // ì˜¤ëŠ˜ ë‚ ì§œ í‘œì‹œ
        if (i === todayDate && currentScheduleMonth === todayMonth && currentScheduleYear === todayYear) {
            dayDiv.classList.add('today');
        }
        
        // ì„ íƒëœ ë‚ ì§œ í‘œì‹œ
        if (i === selectedDate && currentScheduleMonth === currentScheduleMonth && currentScheduleYear === currentScheduleYear) {
            dayDiv.classList.add('selected');
        }
        
        // ë‚ ì§œì— í•´ë‹¹í•˜ëŠ” ì´ë²¤íŠ¸ í™•ì¸
        const dateString = `${currentScheduleYear}-${String(currentScheduleMonth + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
        const dateEvents = schedules.filter(schedule => schedule.date === dateString);
        
        // ì´ë²¤íŠ¸ê°€ ìˆìœ¼ë©´ í‘œì‹œ
        if (dateEvents.length > 0) {
            dayDiv.classList.add('has-events');
            
            // ì´ë²¤íŠ¸ í•­ëª© ì¶”ê°€ (ëª¨ë“  ì´ë²¤íŠ¸ í‘œì‹œ)
            const eventListDiv = document.createElement('div');
            eventListDiv.className = 'event-list';
            
            // ëª¨ë“  ì´ë²¤íŠ¸ í‘œì‹œ (ì œí•œ ì—†ìŒ)
            for (let j = 0; j < dateEvents.length; j++) {
                const eventDiv = document.createElement('div');
                eventDiv.className = 'event-item';
                eventDiv.textContent = dateEvents[j].title;
                eventListDiv.appendChild(eventDiv);
            }
            
            dayDiv.appendChild(eventListDiv);
        }
        
        // ë‚ ì§œ ë²ˆí˜¸ ì¶”ê°€
        const dayNumber = document.createElement('div');
        dayNumber.className = 'day-number';
        dayNumber.textContent = i;
        dayDiv.appendChild(dayNumber);
        
        // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
        dayDiv.addEventListener('click', function() {
            // ì´ì „ì— ì„ íƒëœ ë‚ ì§œ í´ë˜ìŠ¤ ì œê±°
            const selectedDays = document.querySelectorAll('.calendar-day.selected');
            selectedDays.forEach(day => day.classList.remove('selected'));
            
            // í˜„ì¬ ì„ íƒëœ ë‚ ì§œ í‘œì‹œ
            this.classList.add('selected');
            selectedDate = i;
            
            // ì„ íƒëœ ë‚ ì§œì˜ ì´ë²¤íŠ¸ í‘œì‹œ
            const selectedDateObj = new Date(currentScheduleYear, currentScheduleMonth, i);
            showEventsForDate(selectedDateObj);
        });
        
        calendarDays.appendChild(dayDiv);
    }
    
    // ë‹¤ìŒ ë‹¬ ë‚ ì§œ ì±„ìš°ê¸° (6ì£¼ ì±„ìš°ê¸°)
    const usedCells = firstDayWeekday + lastDay.getDate();
    const remainingCells = 42 - usedCells; // 7ì¼ * 6ì£¼ = 42
    
    for (let i = 1; i <= remainingCells; i++) {
        const dayDiv = document.createElement('div');
        dayDiv.className = 'calendar-day other-month';
        dayDiv.innerHTML = `<div class="day-number"></div>`;
        calendarDays.appendChild(dayDiv);
    }
}

        function showEventsForDate(date) {
            const selectedDateEvents = document.getElementById('selectedDateEvents');
            if (!selectedDateEvents) return;
            
            const dateString = date.toISOString().split('T')[0];
            
            // í•´ë‹¹ ë‚ ì§œì˜ ì´ë²¤íŠ¸ í•„í„°ë§
            const dateEvents = schedules.filter(schedule => schedule.date === dateString);
            
            // ì´ë²¤íŠ¸ ëª©ë¡ ì´ˆê¸°í™”
            selectedDateEvents.innerHTML = '';
            
            // ë‚ ì§œ í—¤ë” ì¶”ê°€
            const dateHeader = document.createElement('h4');
            dateHeader.textContent = formatDate(dateString);
            selectedDateEvents.appendChild(dateHeader);
            
            if (dateEvents.length === 0) {
                const noEvents = document.createElement('p');
                noEvents.className = 'no-events';
                noEvents.textContent = 'ì´ ë‚ ì§œì—ëŠ” ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.';
                selectedDateEvents.appendChild(noEvents);
            } else {
                // ì‹œê°„ìˆœìœ¼ë¡œ ì •ë ¬
                dateEvents.sort((a, b) => {
                    if (!a.time) return 1;
                    if (!b.time) return -1;
                    return a.time.localeCompare(b.time);
                });
                
                // ì´ë²¤íŠ¸ ëª©ë¡ ìƒì„±
                dateEvents.forEach(event => {
                    const eventDiv = document.createElement('div');
                    eventDiv.className = 'event-day-item';
                    
                    eventDiv.innerHTML = `
                        <div class="event-time">${event.time || 'ì¢…ì¼'}</div>
                        <div class="event-title">${event.title}</div>
                        ${event.description ? `<div class="event-desc">${event.description}</div>` : ''}
                        <div style="text-align: right; margin-top: 10px;">
                            <button onclick="editSchedule(${event.id})">ìˆ˜ì •</button>
                            <button class="delete-btn" onclick="deleteSchedule(${event.id})">ì‚­ì œ</button>
                        </div>
                    `;
                    
                    selectedDateEvents.appendChild(eventDiv);
                });
            }
        }

        function prevScheduleMonth() {
            currentScheduleMonth--;
            if (currentScheduleMonth < 0) {
                currentScheduleMonth = 11;
                currentScheduleYear--;
            }
            renderScheduleCalendar();
            
            // ì„ íƒëœ ë‚ ì§œ ì´ˆê¸°í™”
            selectedDate = null;
            document.getElementById('selectedDateEvents').innerHTML = '<p class="no-events">ë‚ ì§œë¥¼ ì„ íƒí•˜ë©´ ì¼ì •ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>';
        }

        function nextScheduleMonth() {
            currentScheduleMonth++;
            if (currentScheduleMonth > 11) {
                currentScheduleMonth = 0;
                currentScheduleYear++;
            }
            renderScheduleCalendar();
            
            // ì„ íƒëœ ë‚ ì§œ ì´ˆê¸°í™”
            selectedDate = null;
            document.getElementById('selectedDateEvents').innerHTML = '<p class="no-events">ë‚ ì§œë¥¼ ì„ íƒí•˜ë©´ ì¼ì •ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>';
        }

        /********** ê°€ê³„ë¶€ ê¸°ëŠ¥ **********/
        function loadAccountData() {
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê°€ê³„ë¶€ ë°ì´í„° ë¡œë“œ
            let abData = JSON.parse(localStorage.getItem('accountData') || '[]');
            accountData = abData;
            
            // ê°€ê³„ë¶€ ëª©ë¡ í‘œì‹œ
            renderAccountList();
            
            // ê°€ê³„ë¶€ ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
            updateAccountSummary();
            
            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (Chart.js ì‚¬ìš©)
            updateAccountCharts();
            
            // ê°€ê³„ë¶€ ë‹¬ë ¥ ì´ˆê¸°í™” (FullCalendar ì‚¬ìš©)
            // FullCalendarê°€ ë¡œë“œë˜ë©´ í˜¸ì¶œë¨
            if (typeof FullCalendar !== 'undefined') {
                initializeAccountCalendar();
            }
        }
        
        function addAccountItem() {
            const date = document.getElementById('ab-date').value;
            const amount = parseFloat(document.getElementById('ab-amount').value);
            const type = document.getElementById('ab-type').value;
            const category = document.getElementById('ab-category').value;
            const method = document.getElementById('ab-method').value;
            const memo = document.getElementById('ab-memo').value;
            
            if (!date || isNaN(amount) || amount <= 0) {
                alert('ë‚ ì§œì™€ ê¸ˆì•¡ì€ í•„ìˆ˜ì…ë‹ˆë‹¤. ê¸ˆì•¡ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.');
                return;
            }
            
            const item = {
                id: Date.now(),
                date,
                amount,
                type,
                category,
                method,
                memo
            };
            
            // ìƒˆ í•­ëª© ì¶”ê°€
            accountData.push(item);
            localStorage.setItem('accountData', JSON.stringify(accountData));
            
            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('ab-amount').value = '';
            document.getElementById('ab-memo').value = '';
            
            // ê°€ê³„ë¶€ ëª©ë¡ ë° ìš”ì•½ ì—…ë°ì´íŠ¸
            renderAccountList();
            updateAccountSummary();
            updateAccountCharts();
            
            // ë‹¬ë ¥ ì´ë²¤íŠ¸ ì—…ë°ì´íŠ¸ (FullCalendar ì‚¬ìš©)
            const calendarEl = document.getElementById('ab-calendar');
            if (calendarEl && typeof FullCalendar !== 'undefined') {
                const calendar = FullCalendar.getCalendarById('account-calendar');
                if (calendar) {
                    // ê¸°ì¡´ ë‹¬ë ¥ì´ ìˆìœ¼ë©´ ì´ë²¤íŠ¸ ì¶”ê°€
                    calendar.addEvent({
                        id: item.id.toString(),
                        title: `${item.type === 'income' ? 'ìˆ˜ì…' : 'ì§€ì¶œ'}: ${item.amount.toLocaleString()}ì› (${item.category})`,
                        start: item.date,
                        color: item.type === 'income' ? '#4CAF50' : '#f44336',
                        extendedProps: {
                            amount: item.amount,
                            category: item.category,
                            method: item.method,
                            memo: item.memo
                        }
                    });
                } else {
                    // ë‹¬ë ¥ì´ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
                    initializeAccountCalendar();
                }
            }
            
            alert('ê°€ê³„ë¶€ í•­ëª©ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        function renderAccountList() {
            const tbody = document.querySelector('#ab-list tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // ë‚ ì§œ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬ (ìµœì‹  í•­ëª©ì´ ìœ„ë¡œ)
            accountData.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (accountData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">ë“±ë¡ëœ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }
            
            accountData.forEach(item => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${formatDate(item.date)}</td>
                    <td>${item.amount.toLocaleString()}ì›</td>
                    <td>${item.type === 'income' ? 'ìˆ˜ì…' : 'ì§€ì¶œ'}</td>
                    <td>${item.category}</td>
                    <td>${item.method}</td>
                    <td>${item.memo || '-'}</td>
                    <td>
                        <button class="delete-btn" onclick="deleteAccountItem(${item.id})">ì‚­ì œ</button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }
        
        function deleteAccountItem(id) {
            if (confirm('ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                accountData = accountData.filter(item => item.id !== id);
                localStorage.setItem('accountData', JSON.stringify(accountData));
                
                // ê°€ê³„ë¶€ ëª©ë¡ ë° ìš”ì•½ ì—…ë°ì´íŠ¸
                renderAccountList();
                updateAccountSummary();
                updateAccountCharts();
                
                alert('í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        function updateAccountSummary() {
            const summaryEl = document.getElementById('ab-summary');
            if (!summaryEl) return;
            
            // í˜„ì¬ ì›”ì˜ ìˆ˜ì…/ì§€ì¶œ í•©ê³„ ê³„ì‚°
            const now = new Date();
            const currentMonth = now.getMonth() + 1;
            const currentYear = now.getFullYear();
            
            let income = 0, expense = 0;
            
            accountData.forEach(item => {
                const itemDate = new Date(item.date);
                const itemMonth = itemDate.getMonth() + 1;
                const itemYear = itemDate.getFullYear();
                
                if (itemMonth === currentMonth && itemYear === currentYear) {
                    if (item.type === 'income') {
                        income += item.amount;
                    } else {
                        expense += item.amount;
                    }
                }
            });
            
            // ìš”ì•½ ì •ë³´ í‘œì‹œ
            summaryEl.innerHTML = `
                <strong>ì´ë²ˆ ë‹¬ ìˆ˜ì…:</strong> ${income.toLocaleString()}ì› | 
                <strong>ì§€ì¶œ:</strong> ${expense.toLocaleString()}ì› |
                <strong>ì”ì•¡:</strong> ${(income - expense).toLocaleString()}ì›
            `;
        }
        
        function updateAccountCharts() {
            // Chart.jsì™€ FullCalendar ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
            let requiredLibraries = [];
            
            if (typeof Chart === 'undefined') {
                requiredLibraries.push({
                    name: 'Chart.js',
                    src: 'https://cdn.jsdelivr.net/npm/chart.js'
                });
            }
            
            if (typeof FullCalendar === 'undefined') {
                requiredLibraries.push({
                    name: 'FullCalendar',
                    src: 'https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.min.js'
                });
                
                // FullCalendar CSSë„ ì¶”ê°€
                const style = document.createElement('link');
                style.rel = 'stylesheet';
                style.href = 'https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.min.css';
                document.head.appendChild(style);
            }
            
            if (requiredLibraries.length > 0) {
                loadLibraries(requiredLibraries, 0, function() {
                    createCharts();
                    initializeAccountCalendar();
                });
                return;
            }
            
            createCharts();
            initializeAccountCalendar();
        }
        
        // ë¼ì´ë¸ŒëŸ¬ë¦¬ ìˆœì°¨ì  ë¡œë“œ í•¨ìˆ˜
        function loadLibraries(libraries, index, callback) {
            if (index >= libraries.length) {
                callback();
                return;
            }
            
            const library = libraries[index];
            const script = document.createElement('script');
            script.src = library.src;
            script.onload = function() {
                loadLibraries(libraries, index + 1, callback);
            };
            document.head.appendChild(script);
        }
        
        // ê°€ê³„ë¶€ ë‹¬ë ¥ ì´ˆê¸°í™” í•¨ìˆ˜
        function initializeAccountCalendar() {
            const calendarEl = document.getElementById('ab-calendar');
            if (!calendarEl) return;
            
            // ë‹¬ë ¥ì— í‘œì‹œí•  ì´ë²¤íŠ¸ ë°ì´í„° ìƒì„±
            const events = accountData.map(item => ({
                id: item.id.toString(),
                title: `${item.type === 'income' ? 'ìˆ˜ì…' : 'ì§€ì¶œ'}: ${item.amount.toLocaleString()}ì› (${item.category})`,
                start: item.date,
                color: item.type === 'income' ? '#4CAF50' : '#f44336',
                extendedProps: {
                    amount: item.amount,
                    category: item.category,
                    method: item.method,
                    memo: item.memo
                }
            }));
            
            // ê¸°ì¡´ì— ì´ˆê¸°í™”ëœ ë‹¬ë ¥ì´ ìˆëŠ”ì§€ í™•ì¸
            if (calendarEl.innerHTML) {
                try {
                    // ê¸°ì¡´ ë‹¬ë ¥ì´ ìˆìœ¼ë©´ ì´ˆê¸°í™”
                    calendarEl.innerHTML = '';
                } catch (e) {
                    console.error("ë‹¬ë ¥ ì´ˆê¸°í™” ì˜¤ë¥˜:", e);
                }
            }
            
            try {
                // FullCalendar ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
                const calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek'
                    },
                    events: events,
                    locale: 'ko',
                    height: '600px',
                    eventClick: function(info) {
                        // ì´ë²¤íŠ¸ í´ë¦­ ì‹œ ìƒì„¸ ì •ë³´ í‘œì‹œ
                        const eventData = info.event;
                        const props = eventData.extendedProps;
                        
                        alert(`[${eventData.title}]
ë‚ ì§œ: ${eventData.startStr}
ê¸ˆì•¡: ${props.amount.toLocaleString()}ì›
ì¹´í…Œê³ ë¦¬: ${props.category}
ê²°ì œë°©ë²•: ${props.method}
ë©”ëª¨: ${props.memo || 'ì—†ìŒ'}`);
                    },
                    datesSet: function(dateInfo) {
                        // ì›” ë³€ê²½ ì‹œ í•´ë‹¹ ì›”ì˜ ìˆ˜ì…/ì§€ì¶œ í•©ê³„ í‘œì‹œ
                        const start = dateInfo.start;
                        const end = dateInfo.end;
                        
                        let monthIncome = 0, monthExpense = 0;
                        
                        accountData.forEach(item => {
                            const itemDate = new Date(item.date);
                            if (itemDate >= start && itemDate < end) {
                                if (item.type === 'income') {
                                    monthIncome += item.amount;
                                } else {
                                    monthExpense += item.amount;
                                }
                            }
                        });
                        
                        // ë‹¬ë ¥ ìœ„ì— ìš”ì•½ ì •ë³´ í‘œì‹œ
                        const infoEl = document.createElement('div');
                        infoEl.className = 'fc-header-toolbar mt-2 mb-3';
                        infoEl.innerHTML = `
                            <div style="text-align:center; width:100%; font-weight:bold; padding:10px;">
                                ${dateInfo.view.title} - 
                                ìˆ˜ì…: <span style="color:#4CAF50">${monthIncome.toLocaleString()}ì›</span> | 
                                ì§€ì¶œ: <span style="color:#f44336">${monthExpense.toLocaleString()}ì›</span> | 
                                ì”ì•¡: <span style="color:${monthIncome - monthExpense >= 0 ? '#4CAF50' : '#f44336'}">${(monthIncome - monthExpense).toLocaleString()}ì›</span>
                            </div>
                        `;
                        
                        // ê¸°ì¡´ ìš”ì•½ ì •ë³´ê°€ ìˆìœ¼ë©´ ì œê±°
                        const existingInfo = calendarEl.querySelector('.fc-header-toolbar:not(:first-child)');
                        if (existingInfo) {
                            existingInfo.remove();
                        }
                        
                        // ìƒˆ ìš”ì•½ ì •ë³´ ì¶”ê°€
                        const header = calendarEl.querySelector('.fc-header-toolbar');
                        if (header) {
                            header.parentNode.insertBefore(infoEl, header.nextSibling);
                        }
                    }
                });
                
                // ë‹¬ë ¥ ë Œë”ë§
                calendar.render();
            } catch (e) {
                console.error("FullCalendar ì´ˆê¸°í™” ì˜¤ë¥˜:", e);
                calendarEl.innerHTML = '<div style="padding: 20px; text-align: center; color: #f44336;">ë‹¬ë ¥ì„ ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ë‹¤ë¥¸ íƒ­ì„ í´ë¦­í•œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div>';
            }
        }
        
        function createCharts() {
            // ì°¨íŠ¸ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
            const monthChart = document.getElementById('ab-month-summary');
            const categoryChart = document.getElementById('ab-category-summary');
            const methodChart = document.getElementById('ab-method-summary');
            
            if (!monthChart || !categoryChart || !methodChart) return;
            
            // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
            Chart.getChart(monthChart)?.destroy();
            Chart.getChart(categoryChart)?.destroy();
            Chart.getChart(methodChart)?.destroy();
            
            // ë°ì´í„° ì§‘ê³„
            const monthData = { income: 0, expense: 0 };
            const categoryData = {};
            const methodData = {};
            
            accountData.forEach(item => {
                // ì›”ë³„ ìˆ˜ì…/ì§€ì¶œ ì§‘ê³„
                monthData[item.type] += item.amount;
                
                // ì§€ì¶œ í•­ëª©ë§Œ ì¹´í…Œê³ ë¦¬ë³„ ì§‘ê³„
                if (item.type === 'expense') {
                    if (!categoryData[item.category]) {
                        categoryData[item.category] = 0;
                    }
                    categoryData[item.category] += item.amount;
                    
                    // ê²°ì œ ìˆ˜ë‹¨ë³„ ì§‘ê³„
                    if (!methodData[item.method]) {
                        methodData[item.method] = 0;
                    }
                    methodData[item.method] += item.amount;
                }
            });
            
            // ì›”ë³„ ìˆ˜ì…/ì§€ì¶œ ì°¨íŠ¸
            new Chart(monthChart, {
                type: 'bar',
                data: {
                    labels: ['ìˆ˜ì…', 'ì§€ì¶œ'],
                    datasets: [{
                        label: 'ê¸ˆì•¡',
                        data: [monthData.income, monthData.expense],
                        backgroundColor: ['#4CAF50', '#f44336']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ìˆ˜ì…/ì§€ì¶œ ë¹„êµ'
                        }
                    }
                }
            });
            
            // ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ ì°¨íŠ¸
            new Chart(categoryChart, {
                type: 'pie',
                data: {
                    labels: Object.keys(categoryData),
                    datasets: [{
                        data: Object.values(categoryData),
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                            '#FF9F40', '#8AC249', '#EA80FC', '#607D8B', '#E53935'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ'
                        }
                    }
                }
            });
            
            // ê²°ì œ ìˆ˜ë‹¨ë³„ ì§€ì¶œ ì°¨íŠ¸
            new Chart(methodChart, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(methodData),
                    datasets: [{
                        data: Object.values(methodData),
                        backgroundColor: [
                            '#BCAAA4', '#90CAF9', '#FFE082', '#80DEEA', '#B0BEC5',
                            '#A5D6A7', '#F48FB1', '#CE93D8', '#FFF59D', '#FFAB91'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ê²°ì œ ìˆ˜ë‹¨ë³„ ì§€ì¶œ'
                        }
                    }
                }
            });
        }

        /********** í™ˆí™”ë©´ ì„¤ì • ê¸°ëŠ¥ **********/
        function saveCustomHome() {
            const text = document.getElementById('text-input').value;
            const font = document.getElementById('font-select').value;
            const size = document.getElementById('font-size').value;
            const color = document.getElementById('font-color').value;
            const align = document.getElementById('text-align').value;
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem("home_text", text);
            localStorage.setItem("home_font", font);
            localStorage.setItem("home_size", size);
            localStorage.setItem("home_color", color);
            localStorage.setItem("home_align", align);
            
            // ì´ë¯¸ì§€ íŒŒì¼ ì²˜ë¦¬
            const imageFile = document.getElementById('image-upload').files[0];
            if (imageFile) {
                const reader = new FileReader();
                reader.onload = e => {
                    localStorage.setItem("home_img", e.target.result);
                    localStorage.removeItem("home_video");
                    applyCustomHome();
                };
                reader.readAsDataURL(imageFile);
            }
            
            // ë¹„ë””ì˜¤ íŒŒì¼ ì²˜ë¦¬
            const videoFile = document.getElementById('video-upload').files[0];
            if (videoFile) {
                const reader = new FileReader();
                reader.onload = e => {
                    localStorage.setItem("home_video", e.target.result);
                    localStorage.removeItem("home_img");
                    applyCustomHome();
                };
                reader.readAsDataURL(videoFile);
            }
            
            // ì˜¤ë””ì˜¤ íŒŒì¼ ì²˜ë¦¬
            const audioFile = document.getElementById('audio-upload').files[0];
            if (audioFile) {
                const reader = new FileReader();
                reader.onload = e => {
                    localStorage.setItem("home_audio", e.target.result);
                    applyCustomHome();
                };
                reader.readAsDataURL(audioFile);
            }
            
            // ì„¤ì •ì„ ì¦‰ì‹œ ì ìš©
            applyCustomHome();
            
            alert("í™ˆí™”ë©´ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
        }

        function applyCustomHome() {
            const text = localStorage.getItem("home_text");
            const font = localStorage.getItem("home_font");
            const size = localStorage.getItem("home_size");
            const color = localStorage.getItem("home_color");
            const align = localStorage.getItem("home_align");
            const img = localStorage.getItem("home_img");
            const video = localStorage.getItem("home_video");
            const audioSrc = localStorage.getItem("home_audio");

            const el = document.getElementById("preview-text");
            if (el && text) {
                el.textContent = text;
                el.style.fontFamily = font || 'inherit';
                el.style.fontSize = size || 'inherit';
                el.style.color = color || 'inherit';
                el.style.textAlign = align || 'inherit';
            }

            // media-preview ìš”ì†Œë¥¼ ì°¾ê³  ì—†ìœ¼ë©´ ìƒì„±
            let media = document.getElementById("media-preview");
            if (!media) {
                // í—¤ë” ë‹¤ìŒì— media-preview ìš”ì†Œ ìƒì„±
                const header = document.querySelector('header');
                if (header && header.nextElementSibling) {
                    media = document.createElement('div');
                    media.id = 'media-preview';
                    media.style.textAlign = 'center';
                    media.style.margin = '20px 0';
                    header.parentNode.insertBefore(media, header.nextElementSibling);
                }
            }

            // ì´ë¯¸ì§€ë‚˜ ë¹„ë””ì˜¤ê°€ ì—†ìœ¼ë©´ media-previewë¥¼ í‘œì‹œí•˜ì§€ ì•ŠìŒ
            if (media) {
                if (video) {
                    media.innerHTML = '';
                    media.style.display = 'block';
                } else if (img) {
                    media.innerHTML = '<img src="' + img + '" alt="ì´ë¯¸ì§€" style="max-width:100%;">';
                    media.style.display = 'block';
                } else {
                    // ì´ë¯¸ì§€ë‚˜ ë¹„ë””ì˜¤ê°€ ì—†ìœ¼ë©´ ë¯¸ë””ì–´ ì˜ì—­ ìˆ¨ê¹€
                    media.innerHTML = '';
                    media.style.display = 'none';
                }
            }

            const bgm = document.getElementById("bgm");
            if (bgm && audioSrc) {
                bgm.src = audioSrc;
                bgm.play().catch(e => console.log("ì˜¤ë””ì˜¤ ìë™ ì¬ìƒ ì‹¤íŒ¨:", e));
            }
        }
        
        /********** ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ **********/
        function formatDate(dateString) {
            const date = new Date(dateString);
            return `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›” ${date.getDate()}ì¼`;
        }
        
        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›” ${date.getDate()}ì¼ ${date.getHours()}ì‹œ ${String(date.getMinutes()).padStart(2, '0')}ë¶„`;
        }

// í…ìŠ¤íŠ¸ ì—ë””í„° CSS ìŠ¤íƒ€ì¼
const textEditorCSS = `
/* í…ìŠ¤íŠ¸ ì—ë””í„° ìŠ¤íƒ€ì¼ */
.text-editor-container {
    border: 1px solid #ddd;
    border-radius: 5px;
    overflow: hidden;
    margin-bottom: 15px;
}

.text-editor-toolbar {
    background-color: #f5f5f5;
    padding: 8px;
    border-bottom: 1px solid #ddd;
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
}

.text-editor-toolbar button {
    background-color: #fff;
    border: 1px solid #ddd;
    border-radius: 3px;
    padding: 5px 8px;
    margin: 0;
    cursor: pointer;
    color: #333;
    font-size: 14px;
}

.text-editor-toolbar button:hover {
    background-color: #f0f0f0;
}

.text-editor-toolbar button.active {
    background-color: #e8e8e8;
    color: #000;
}

.text-editor-toolbar select {
    height: 30px;
    border: 1px solid #ddd;
    border-radius: 3px;
    background-color: #fff;
    padding: 0 5px;
    min-width: 100px;
}

.text-editor-toolbar .color-picker {
    height: 30px;
    width: 30px;
    padding: 0;
    border: 1px solid #ddd;
    border-radius: 3px;
    cursor: pointer;
}

.text-editor-content {
    min-height: 150px;
    padding: 10px;
    background-color: #fff;
    overflow-y: auto;
    line-height: 1.6;
}

.text-editor-content:focus {
    outline: none;
    box-shadow: 0 0 3px rgba(0, 0, 0, 0.2) inset;
}

/* íˆ´ë°” ê·¸ë£¹ ìŠ¤íƒ€ì¼ */
.toolbar-group {
    display: flex;
    align-items: center;
    gap: 5px;
    padding-right: 8px;
    margin-right: 8px;
    border-right: 1px solid #ddd;
}

.toolbar-group:last-child {
    border-right: none;
}

/* í°íŠ¸ ë¯¸ë¦¬ë³´ê¸° ìŠ¤íƒ€ì¼ */
.font-preview {
    font-size: 14px;
}

/* ê° í°íŠ¸ íŒ¨ë°€ë¦¬ì— ëŒ€í•œ ìŠ¤íƒ€ì¼ */
.arial { font-family: Arial, sans-serif; }
.nanum-gothic { font-family: "Nanum Gothic", "ë§‘ì€ ê³ ë”•", sans-serif; }
.malgun-gothic { font-family: "Malgun Gothic", "ë§‘ì€ ê³ ë”•", sans-serif; }
.gulim { font-family: "Gulim", sans-serif; }
.batang { font-family: "Batang", serif; }
.times { font-family: "Times New Roman", serif; }
.georgia { font-family: "Georgia", serif; }
.courier { font-family: "Courier New", monospace; }

/* ì›¹ í°íŠ¸ ë¡œë“œ */

`;

// ì¼ê¸°ì¥ê³¼ ë©”ëª¨ì¥ì— í…ìŠ¤íŠ¸ ì—ë””í„°ë¥¼ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
function addTextEditorFunctionality() {
    // í…ìŠ¤íŠ¸ ì—ë””í„° CSS ìŠ¤íƒ€ì¼ ì¶”ê°€
    const styleElement = document.createElement('style');
    styleElement.textContent = textEditorCSS;
    document.head.appendChild(styleElement);
    
    // ì¼ê¸°ì¥ í…ìŠ¤íŠ¸ ì—ë””í„° ì¶”ê°€
    setupTextEditor('diaryContent', 'diary-editor', 6);
    
    // ë©”ëª¨ì¥ í…ìŠ¤íŠ¸ ì—ë””í„° ì¶”ê°€
    setupTextEditor('memoContent', 'memo-editor', 4);
    
    // í…ìŠ¤íŠ¸ ì—ë””í„° ì €ì¥ ì‹œ HTML ë‚´ìš©ì„ hidden inputì— ì €ì¥í•˜ë„ë¡ í›… ì¶”ê°€
    const originalSaveDiary = window.saveDiary;
    window.saveDiary = function() {
        const diaryEditor = document.getElementById('diary-editor');
        if (diaryEditor) {
            const diaryContent = document.getElementById('diaryContent');
            diaryContent.value = diaryEditor.innerHTML;
        }
        originalSaveDiary();
    };
    
    const originalSaveMemo = window.saveMemo;
    window.saveMemo = function() {
        const memoEditor = document.getElementById('memo-editor');
        if (memoEditor) {
            const memoContent = document.getElementById('memoContent');
            memoContent.value = memoEditor.innerHTML;
        }
        originalSaveMemo();
    };
    
    // ì¼ê¸°ì™€ ë©”ëª¨ ë¡œë“œ ì‹œ HTML ë‚´ìš©ì„ ì—ë””í„°ì— í‘œì‹œí•˜ë„ë¡ í›… ì¶”ê°€
    const originalEditDiary = window.editDiary;
    window.editDiary = function(id) {
        originalEditDiary(id);
        const diary = diaries.find(d => d.id === id);
        if (diary && document.getElementById('diary-editor')) {
            document.getElementById('diary-editor').innerHTML = diary.content;
        }
    };
    
    const originalEditMemo = window.editMemo;
    window.editMemo = function(id) {
        originalEditMemo(id);
        const memo = memos.find(m => m.id === id);
        if (memo && document.getElementById('memo-editor')) {
            document.getElementById('memo-editor').innerHTML = memo.content;
        }
    };
}

// í…ìŠ¤íŠ¸ ì—ë””í„° ì„¤ì • í•¨ìˆ˜
function setupTextEditor(textareaId, editorId, rows) {
    const textarea = document.getElementById(textareaId);
    if (!textarea) return;
    
    // textareaë¥¼ ìˆ¨ê¸°ê³  ì—ë””í„° ì»¨í…Œì´ë„ˆ ìƒì„±
    textarea.style.display = 'none';
    
    const editorContainer = document.createElement('div');
    editorContainer.className = 'text-editor-container';
    textarea.parentNode.insertBefore(editorContainer, textarea);
    
    // íˆ´ë°” ìƒì„±
    const toolbar = document.createElement('div');
    toolbar.className = 'text-editor-toolbar';
    
    // í°íŠ¸ ìŠ¤íƒ€ì¼ ê·¸ë£¹
    const styleGroup = document.createElement('div');
    styleGroup.className = 'toolbar-group';
    
    // ë³¼ë“œ ë²„íŠ¼
    const boldBtn = document.createElement('button');
    boldBtn.innerHTML = '<b>B</b>';
    boldBtn.title = 'êµµê²Œ';
    boldBtn.onclick = function(e) { 
        e.preventDefault(); 
        document.getElementById(editorId).focus();
        document.execCommand('bold', false, null); 
    };
    
    // ì´íƒ¤ë¦­ ë²„íŠ¼
    const italicBtn = document.createElement('button');
    italicBtn.innerHTML = '<i>I</i>';
    italicBtn.title = 'ê¸°ìš¸ì„';
    italicBtn.onclick = function(e) { 
        e.preventDefault(); 
        document.getElementById(editorId).focus();
        document.execCommand('italic', false, null); 
    };
    
    // ë°‘ì¤„ ë²„íŠ¼
    const underlineBtn = document.createElement('button');
    underlineBtn.innerHTML = '<u>U</u>';
    underlineBtn.title = 'ë°‘ì¤„';
    underlineBtn.onclick = function(e) { 
        e.preventDefault(); 
        document.getElementById(editorId).focus();
        document.execCommand('underline', false, null); 
    };
    
    // ì·¨ì†Œì„  ë²„íŠ¼
    const strikeBtn = document.createElement('button');
    strikeBtn.innerHTML = '<s>S</s>';
    strikeBtn.title = 'ì·¨ì†Œì„ ';
    strikeBtn.onclick = function(e) { 
        e.preventDefault(); 
        document.getElementById(editorId).focus();
        document.execCommand('strikethrough', false, null); 
    };
    
    styleGroup.appendChild(boldBtn);
    styleGroup.appendChild(italicBtn);
    styleGroup.appendChild(underlineBtn);
    styleGroup.appendChild(strikeBtn);
    
    // ì •ë ¬ ê·¸ë£¹
    const alignGroup = document.createElement('div');
    alignGroup.className = 'toolbar-group';
    
    // ì™¼ìª½ ì •ë ¬ ë²„íŠ¼
    const alignLeftBtn = document.createElement('button');
    alignLeftBtn.innerHTML = 'â—€ ì™¼ìª½';
    alignLeftBtn.title = 'ì™¼ìª½ ì •ë ¬';
    alignLeftBtn.onclick = function(e) { 
        e.preventDefault(); 
        document.getElementById(editorId).focus();
        document.execCommand('justifyLeft', false, null); 
    };
    
    // ê°€ìš´ë° ì •ë ¬ ë²„íŠ¼
    const alignCenterBtn = document.createElement('button');
    alignCenterBtn.innerHTML = 'â–  ê°€ìš´ë°';
    alignCenterBtn.title = 'ê°€ìš´ë° ì •ë ¬';
    alignCenterBtn.onclick = function(e) { 
        e.preventDefault(); 
        document.getElementById(editorId).focus();
        document.execCommand('justifyCenter', false, null); 
    };
    
    // ì˜¤ë¥¸ìª½ ì •ë ¬ ë²„íŠ¼
    const alignRightBtn = document.createElement('button');
    alignRightBtn.innerHTML = 'â–¶ ì˜¤ë¥¸ìª½';
    alignRightBtn.title = 'ì˜¤ë¥¸ìª½ ì •ë ¬';
    alignRightBtn.onclick = function(e) { 
        e.preventDefault(); 
        document.getElementById(editorId).focus();
        document.execCommand('justifyRight', false, null); 
    };
    
    alignGroup.appendChild(alignLeftBtn);
    alignGroup.appendChild(alignCenterBtn);
    alignGroup.appendChild(alignRightBtn);
    
    // í°íŠ¸ ê·¸ë£¹
    const fontGroup = document.createElement('div');
    fontGroup.className = 'toolbar-group';
    
    // í°íŠ¸ ì¢…ë¥˜ ì„ íƒê¸° (ê°œì„ ëœ ë²„ì „)
    const fontSelector = document.createElement('select');
    fontSelector.title = 'ê¸€ê¼´';
    fontSelector.id = editorId + '-font-selector';
    fontSelector.style.minWidth = '120px'; // ì¶©ë¶„í•œ ë„ˆë¹„ í™•ë³´
    
    // í°íŠ¸ ì„ íƒ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ìˆ˜ì •
    fontSelector.onchange = function() {
        applyFontToEditor(editorId, this.value);
    };
    
    // í°íŠ¸ ì˜µì…˜ - CSS í´ë˜ìŠ¤ì™€ í•¨ê»˜ ì •ì˜
    const fontOptions = [
        { value: 'Arial, sans-serif', text: 'Arial', className: 'arial' },
        { value: '"Nanum Gothic", "ë§‘ì€ ê³ ë”•", sans-serif', text: 'ë‚˜ëˆ” ê³ ë”•', className: 'nanum-gothic' },
        { value: '"Malgun Gothic", "ë§‘ì€ ê³ ë”•", sans-serif', text: 'ë§‘ì€ ê³ ë”•', className: 'malgun-gothic' },
        { value: '"Gulim", sans-serif', text: 'êµ´ë¦¼', className: 'gulim' },
        { value: '"Batang", serif', text: 'ë°”íƒ•', className: 'batang' },
        { value: '"Times New Roman", serif', text: 'Times New Roman', className: 'times' },
        { value: '"Georgia", serif', text: 'Georgia', className: 'georgia' },
        { value: '"Courier New", monospace', text: 'Courier New', className: 'courier' }
    ];
    
    // ì˜µì…˜ ì¶”ê°€ - í°íŠ¸ ë¯¸ë¦¬ë³´ê¸°ì™€ í•¨ê»˜
    fontOptions.forEach(option => {
        const opt = document.createElement('option');
        opt.value = option.value;
        opt.textContent = option.text;
        opt.className = 'font-preview ' + option.className;
        // ê¸°ë³¸ê°’ ì„¤ì • (Arialë¡œ ì„¤ì •)
        if (option.text === 'Arial') opt.selected = true;
        fontSelector.appendChild(opt);
    });
    
    // í°íŠ¸ í¬ê¸° ì„ íƒê¸°
    const sizeSelector = document.createElement('select');
    sizeSelector.title = 'ê¸€ì í¬ê¸°';
    sizeSelector.id = editorId + '-size-selector';
    
    // í¬ê¸° ì„ íƒ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ìˆ˜ì •
    sizeSelector.onchange = function() {
        document.getElementById(editorId).focus();
        document.execCommand('fontSize', false, this.value);
        
        // ì¶”ê°€ì ì¸ ìŠ¤íƒ€ì¼ ì ìš© (ì¼ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ ë” ì˜ ì‘ë™)
        const sizeStyles = {
            '1': '10px',
            '2': '13px',
            '3': '16px',
            '4': '18px',
            '5': '24px',
            '6': '32px',
            '7': '48px'
        };
        
        const selection = window.getSelection();
        if (selection.rangeCount > 0) {
            const fontElements = document.querySelectorAll(`font[size="${this.value}"]`);
            fontElements.forEach(el => {
                el.style.fontSize = sizeStyles[this.value];
            });
        }
    };
    
    const sizeOptions = [
        { value: '1', text: 'ì•„ì£¼ ì‘ê²Œ' },
        { value: '2', text: 'ì‘ê²Œ' },
        { value: '3', text: 'ë³´í†µ' },
        { value: '4', text: 'í¬ê²Œ' },
        { value: '5', text: 'ë” í¬ê²Œ' },
        { value: '6', text: 'ì•„ì£¼ í¬ê²Œ' },
        { value: '7', text: 'ìµœëŒ€ í¬ê²Œ' }
    ];
    
    sizeOptions.forEach(option => {
        const opt = document.createElement('option');
        opt.value = option.value;
        opt.textContent = option.text;
        if (option.value === '3') opt.selected = true;
        sizeSelector.appendChild(opt);
    });
    
    fontGroup.appendChild(fontSelector);
    fontGroup.appendChild(sizeSelector);
    
    // ìƒ‰ìƒ ê·¸ë£¹
    const colorGroup = document.createElement('div');
    colorGroup.className = 'toolbar-group';
    
    // ê¸€ì ìƒ‰ìƒ ì„ íƒê¸°
    const colorPicker = document.createElement('input');
    colorPicker.type = 'color';
    colorPicker.className = 'color-picker';
    colorPicker.title = 'ê¸€ì ìƒ‰ìƒ';
    colorPicker.value = '#000000';
    colorPicker.onchange = function() { 
        document.getElementById(editorId).focus();
        document.execCommand('foreColor', false, this.value); 
    };
    
    // ë°°ê²½ ìƒ‰ìƒ ì„ íƒê¸°
    const bgColorPicker = document.createElement('input');
    bgColorPicker.type = 'color';
    bgColorPicker.className = 'color-picker';
    bgColorPicker.title = 'ë°°ê²½ ìƒ‰ìƒ';
    bgColorPicker.value = '#ffffff';
    bgColorPicker.onchange = function() { 
        document.getElementById(editorId).focus();
        document.execCommand('hiliteColor', false, this.value); 
    };
    
    colorGroup.appendChild(colorPicker);
    colorGroup.appendChild(bgColorPicker);
    
    // ëª¨ë“  ê·¸ë£¹ì„ íˆ´ë°”ì— ì¶”ê°€
    toolbar.appendChild(styleGroup);
    toolbar.appendChild(alignGroup);
    toolbar.appendChild(fontGroup);
    toolbar.appendChild(colorGroup);
    
    // í¸ì§‘ ì˜ì—­ ìƒì„±
    const editorContent = document.createElement('div');
    editorContent.className = 'text-editor-content';
    editorContent.id = editorId;
    editorContent.contentEditable = 'true';
    editorContent.style.minHeight = (rows * 24) + 'px'; // ê¸°ì¡´ textareaì˜ ì¤„ ìˆ˜ì™€ ë¹„ìŠ·í•œ ë†’ì´
    editorContent.innerHTML = textarea.value;
    
    // ê¸°ë³¸ ê¸€ê¼´ ì„¤ì • (Arial)
    editorContent.style.fontFamily = 'Arial, sans-serif';
    
    // ì—ë””í„° ì»¨í…Œì´ë„ˆì— íˆ´ë°”ì™€ í¸ì§‘ ì˜ì—­ ì¶”ê°€
    editorContainer.appendChild(toolbar);
    editorContainer.appendChild(editorContent);
    
    // í¸ì§‘ ë‚´ìš© ë³€ê²½ ì‹œ textarea ê°’ ì—…ë°ì´íŠ¸
    editorContent.oninput = function() {
        textarea.value = this.innerHTML;
    };
}

// ê¸€ê¼´ ì ìš© helper í•¨ìˆ˜
function applyFontToEditor(editorId, fontValue) {
    // ì—ë””í„°ì— í¬ì»¤ìŠ¤ ì£¼ê¸°
    const editor = document.getElementById(editorId);
    editor.focus();
    
    // ì„ íƒëœ í…ìŠ¤íŠ¸ê°€ ìˆëŠ”ì§€ í™•ì¸
    const selection = window.getSelection();
    const hasSelection = selection.toString().length > 0;
    
    try {
        if (hasSelection) {
            // ì„ íƒëœ í…ìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ fontName ëª…ë ¹ ì‹¤í–‰
            document.execCommand('fontName', false, fontValue);
        } else {
            // 1. í˜„ì¬ ì»¤ì„œ ìœ„ì¹˜ì˜ í…ìŠ¤íŠ¸ ë…¸ë“œ ì°¾ê¸°
            const range = selection.getRangeAt(0);
            const startNode = range.startContainer;
            
            // 2. ë¶€ëª¨ ìš”ì†Œì— ì§ì ‘ ìŠ¤íƒ€ì¼ ì ìš© (í…ìŠ¤íŠ¸ ë…¸ë“œì˜ ê²½ìš°)
            if (startNode.nodeType === Node.TEXT_NODE) {
                // í˜„ì¬ ë¶€ëª¨ ìš”ì†Œ ì°¾ê¸°
                let parentElement = startNode.parentNode;
                
                // spanìœ¼ë¡œ ê°ì‹¸ê³  ìŠ¤íƒ€ì¼ ì ìš©
                const span = document.createElement('span');
                span.style.fontFamily = fontValue;
                
                // í˜„ì¬ í…ìŠ¤íŠ¸ ë…¸ë“œë¥¼ ìƒˆ spanìœ¼ë¡œ ê°ì‹¸ê¸°
                const newRange = document.createRange();
                newRange.selectNode(startNode);
                newRange.surroundContents(span);
            } else {
                // ì—ë””í„° ì „ì²´ì— ì ìš©
                editor.style.fontFamily = fontValue;
                
                // ë˜ëŠ” ìƒˆë¡œìš´ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•  ìœ„ì¹˜ë¥¼ ë§ˆí¬í•˜ê³  ìŠ¤íŒ¬ìœ¼ë¡œ ê°ì‹¸ê¸°
                const span = document.createElement('span');
                span.style.fontFamily = fontValue;
                span.innerHTML = 'â€‹'; // ì˜ ë„ˆë¹„ ê³µë°± ë¬¸ì
                
                range.insertNode(span);
                range.setStart(span, 0);
                range.setEnd(span, 1);
                selection.removeAllRanges();
                selection.addRange(range);
            }
        }
        
        // font íƒœê·¸ì— ì§ì ‘ ìŠ¤íƒ€ì¼ ì¶”ê°€í•˜ì—¬ ê°•í™”
        setTimeout(() => {
            const fontElements = editor.querySelectorAll(`font[face="${fontValue}"]`);
            fontElements.forEach(el => {
                el.style.fontFamily = fontValue;
            });
        }, 10);
    } catch (e) {
        console.error('í°íŠ¸ ì ìš© ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
        // ì˜ˆë¹„ ë°©ë²•: ì„ íƒ ì˜ì—­ì´ ì—†ê±°ë‚˜ ë¬¸ì œê°€ ìˆìœ¼ë©´ ì „ì²´ ì ìš©
        editor.style.fontFamily = fontValue;
    }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ í…ìŠ¤íŠ¸ ì—ë””í„° ê¸°ëŠ¥ ì¶”ê°€
document.addEventListener('DOMContentLoaded', function() {
    addTextEditorFunctionality();
});
    </script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    // ë‹¬ë ¥ ì„ íƒ ìŠ¤íƒ€ì¼ ì¶”ê°€
    const styleEl = document.createElement('style');
    styleEl.textContent = `
        /* ë‹¬ë ¥ì—ì„œ ì„ íƒëœ ë‚ ì§œ ìŠ¤íƒ€ì¼ */
        .calendar-table td.selected {
            background-color: #e8f4f1;
            border: 2px solid #5f7561;
            box-shadow: 0 0 8px rgba(95, 117, 97, 0.3);
        }
        
        /* í˜¸ë²„ íš¨ê³¼ */
        .calendar-table td:hover {
            background-color: #f9f9f9;
            cursor: pointer;
            transform: scale(1.05);
            transition: all 0.2s ease;
            z-index: 5;
        }
    `;
    document.head.appendChild(styleEl);
    
    loadInitialData();
});
</script>

<script>
  function checkPassword() {
    const input = document.getElementById('password-input').value;
    const correct = '1234';  // ì›í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¡œ ë³€ê²½ ê°€ëŠ¥
    if (input === correct) {
      document.getElementById('password-screen').style.display = 'none';
      document.getElementById('main-content').style.display = 'block';
      console.log("ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ ì„±ê³µ");
    } else {
      document.getElementById('error-msg').innerText = "ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.";
    }
  }
</script>

</body></html>
</div>
<script>
  function checkPassword(event) {
  event.preventDefault();
    const input = document.getElementById('password').value;
    const errorMsg = document.getElementById('error-msg');
    if (input === 'sik282') {
      document.getElementById('password-screen').style.display = 'none';
      document.getElementById('main-content').style.display = 'block';
    } else {
      errorMsg.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤';
    }
  }
</script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    loadInitialData();
});
</script>
<script>
/********** í• ì¼ ê¸°ëŠ¥ **********/
function addTodo() {
    const todoInput = document.getElementById('todoInput');
    const todoDateInput = document.getElementById('todoDate');
    const text = todoInput.value.trim();
    
    if (!text) {
        alert('í•  ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    // ì‚¬ìš©ìê°€ ì„ íƒí•œ ë‚ ì§œ ë˜ëŠ” ì˜¤ëŠ˜ ë‚ ì§œ ì‚¬ìš©
    const todoDate = todoDateInput.value || new Date().toISOString().split('T')[0];
    
    const todo = {
        id: Date.now(),
        text: text,
        completed: false,
        date: todoDate, // ì„ íƒí•œ ë‚ ì§œ ì €ì¥
        createdAt: new Date().toISOString()
    };
    
    todos.push(todo);
    
    try {
        localStorage.setItem('todos', JSON.stringify(todos));
        
        todoInput.value = '';
        // ë‚ ì§œ í•„ë“œëŠ” ì´ˆê¸°í™”í•˜ì§€ ì•Šê³  ìœ ì§€
        
        renderTodos();
        renderTodoCalendar();
    } catch (e) {
        console.error('í• ì¼ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
        alert('í• ì¼ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
}

function renderTodos() {
    const todoList = document.getElementById('todoList');
    if (!todoList) return;
    
    todoList.innerHTML = '';
    
    if (todos.length === 0) {
        todoList.innerHTML = '<p style="text-align: center; color: #888; padding: 20px;">í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ í•  ì¼ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>';
        return;
    }
    
    todos.sort((a, b) => {
        // ë‚ ì§œìˆœ ì •ë ¬ (ê°€ê¹Œìš´ ë‚ ì§œ ë¨¼ì €)
        if (a.date !== b.date) {
            return new Date(a.date) - new Date(b.date);
        }
        // ì™„ë£Œë˜ì§€ ì•Šì€ í•­ëª© ë¨¼ì €
        if (a.completed !== b.completed) {
            return a.completed ? 1 : -1;
        }
        // ìµœì‹  ìƒì„±ìˆœ
        return new Date(b.createdAt) - new Date(a.createdAt);
    });
    
    todos.forEach(todo => {
        const todoItem = document.createElement('div');
        todoItem.className = 'todo-item';
        todoItem.innerHTML = `
            <div class="todo-text ${todo.completed ? 'completed' : ''}">
                <input type="checkbox" ${todo.completed ? 'checked' : ''} onchange="toggleTodo(${todo.id})">
                <span>${todo.text} <small style="color: #888;">(${formatDate(todo.date)})</small></span>
            </div>
            <div>
                <button onclick="editTodo(${todo.id})">ìˆ˜ì •</button>
                <button class="delete-btn" onclick="deleteTodo(${todo.id})">ì‚­ì œ</button>
            </div>
        `;
        
        todoList.appendChild(todoItem);
    });
}

function renderTodoCalendar() {
    const todoCalendarBody = document.getElementById('todoCalendarBody');
    const todoCalendarHeader = document.getElementById('todoCalendarHeader');
    
    if (!todoCalendarBody || !todoCalendarHeader) return;
    
    todoCalendarHeader.textContent = `${currentTodoYear}ë…„ ${currentTodoMonth + 1}ì›”`;
    
    const firstDay = new Date(currentTodoYear, currentTodoMonth, 1).getDay();
    const daysInMonth = new Date(currentTodoYear, currentTodoMonth + 1, 0).getDate();
    
    todoCalendarBody.innerHTML = '';
    
    let row = document.createElement('tr');
    
    // ì²« ì£¼ì˜ ë¹ˆ ì…€ ì±„ìš°ê¸°
    for (let i = 0; i < firstDay; i++) {
        const td = document.createElement('td');
        row.appendChild(td);
    }
    
    // ë‚ ì§œ ì±„ìš°ê¸°
    for (let day = 1; day <= daysInMonth; day++) {
        const td = document.createElement('td');
        
        // í•´ë‹¹ ë‚ ì§œ ë¬¸ìì—´
        const dateStr = `${currentTodoYear}-${String(currentTodoMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        
        // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€ - í•´ë‹¹ ë‚ ì§œë¥¼ í• ì¼ ì…ë ¥ë€ì— ì„¤ì •
        td.addEventListener('click', function() {
            document.getElementById('todoDate').value = dateStr;
            document.getElementById('todoInput').focus();
            
            // ëª¨ë“  ì„ íƒëœ ì…€ ì´ˆê¸°í™”
            document.querySelectorAll('#todoCalendarBody td.selected').forEach(cell => {
                cell.classList.remove('selected');
            });
            
            // í˜„ì¬ ì…€ ì„ íƒ í‘œì‹œ
            this.classList.add('selected');
        });
        
        // ì˜¤ëŠ˜ ë‚ ì§œ ê°•ì¡°
        const today = new Date().toISOString().split('T')[0];
        if (dateStr === today) {
            td.classList.add('today');
        }
        
        // ë‚ ì§œ ìˆ«ì í‘œì‹œ
        const dayNumber = document.createElement('div');
        dayNumber.className = 'day-number';
        dayNumber.textContent = day;
        td.appendChild(dayNumber);
        
        // í•´ë‹¹ ë‚ ì§œì˜ í• ì¼ ì²´í¬
        const todosForDate = todos.filter(todo => todo.date === dateStr);
        
        // í• ì¼ì´ ìˆìœ¼ë©´ ì²´í¬ë°•ìŠ¤ë¡œ í‘œì‹œ
        if (todosForDate.length > 0) {
            const todoContainer = document.createElement('div');
            
            todosForDate.forEach(todo => {
                const todoDiv = document.createElement('div');
                todoDiv.className = 'todo-entry';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = todo.completed;

                checkbox.onclick = function(e) {
                    e.stopPropagation();
                    toggleTodoInCalendar(todo.id);
                };

                const textSpan = document.createElement('span');
                textSpan.textContent = todo.text;
                textSpan.style.overflow = 'hidden';
                textSpan.style.textOverflow = 'ellipsis';
                textSpan.style.whiteSpace = 'nowrap';

                if (todo.completed) {
                    textSpan.style.textDecoration = 'line-through';
                    textSpan.style.color = '#888';
                }

                todoDiv.appendChild(checkbox);
                todoDiv.appendChild(textSpan);
                todoContainer.appendChild(todoDiv);
            });
            
            td.appendChild(todoContainer);
        }
        
        row.appendChild(td);
        
        // í† ìš”ì¼ì´ë‚˜ ì›”ì˜ ë§ˆì§€ë§‰ ë‚ ì´ë©´ ìƒˆ í–‰ ì‹œì‘
        if ((firstDay + day) % 7 === 0 || day === daysInMonth) {
            todoCalendarBody.appendChild(row);
            if (day !== daysInMonth) {
                row = document.createElement('tr');
            }
        }
    }
}

function editTodo(id) {
    const todo = todos.find(t => t.id === id);
    if (!todo) return;
    
    const editForm = document.getElementById('editTodoForm');
    const editInput = document.getElementById('editTodoInput');
    const editDateInput = document.getElementById('editTodoDate'); // ë‚ ì§œ ì…ë ¥ë€ ì¶”ê°€
    const editId = document.getElementById('editTodoId');
    
    editForm.style.display = 'block';
    editInput.value = todo.text;
    editDateInput.value = todo.date; // ë‚ ì§œ ì„¤ì •
    editId.value = todo.id;
    
    editForm.scrollIntoView({ behavior: 'smooth' });
}

function updateTodo() {
    const editInput = document.getElementById('editTodoInput');
    const editDateInput = document.getElementById('editTodoDate'); // ë‚ ì§œ ì…ë ¥ë€ ì¶”ê°€
    const editId = document.getElementById('editTodoId');
    
    const text = editInput.value.trim();
    const date = editDateInput.value; // ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
    const id = parseInt(editId.value);
    
    if (!text) {
        alert('í•  ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    const todoIndex = todos.findIndex(t => t.id === id);
    if (todoIndex !== -1) {
        todos[todoIndex].text = text;
        todos[todoIndex].date = date; // ë‚ ì§œ ì—…ë°ì´íŠ¸
        
        try {
            localStorage.setItem('todos', JSON.stringify(todos));
            
            document.getElementById('editTodoForm').style.display = 'none';
            
            renderTodos();
            renderTodoCalendar();
            
            alert('í•  ì¼ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
        } catch (e) {
            console.error('í• ì¼ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
            alert('í• ì¼ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }
}

/********** ì²´ì¤‘ ê¸°ë¡ ê¸°ëŠ¥ **********/
function renderWeightCalendar() {
    let weightData = {};
    try {
        weightData = JSON.parse(localStorage.getItem('weightRecords') || '{}');
    } catch (e) {
        console.error('ì²´ì¤‘ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
        weightData = {};
    }
    
    const body = document.getElementById('calendarBody');
    const title = document.getElementById('calendarTitle');
    
    if (!body || !title) return;
    
    title.textContent = `${currentCalendarYear}ë…„ ${currentCalendarMonth + 1}ì›”`;
    
    body.innerHTML = '';

    const firstDay = new Date(currentCalendarYear, currentCalendarMonth, 1).getDay();
    const daysInMonth = new Date(currentCalendarYear, currentCalendarMonth + 1, 0).getDate();

    let row = document.createElement('tr');
    
    // ì²« ì£¼ì˜ ë¹ˆ ì…€ ì±„ìš°ê¸°
    for (let i = 0; i < firstDay; i++) {
        const td = document.createElement('td');
        row.appendChild(td);
    }

    // ë‚ ì§œ ì±„ìš°ê¸°
    for (let day = 1; day <= daysInMonth; day++) {
        const td = document.createElement('td');
        const dateKey = `${currentCalendarYear}-${String(currentCalendarMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        
        // ë‚ ì§œ í‘œì‹œ
        const dayNumber = document.createElement('div');
        dayNumber.className = 'day-number';
        dayNumber.textContent = day;
        td.appendChild(dayNumber);
        
        // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€ - í•´ë‹¹ ë‚ ì§œë¥¼ ì²´ì¤‘ ì…ë ¥ë€ì— ì„¤ì •
        td.addEventListener('click', function() {
            document.getElementById('weightDate').value = dateKey;
            document.getElementById('weightValue').focus();
            
            // ëª¨ë“  ì„ íƒëœ ì…€ ì´ˆê¸°í™”
            document.querySelectorAll('#calendarBody td.selected').forEach(cell => {
                cell.classList.remove('selected');
            });
            
            // í˜„ì¬ ì…€ ì„ íƒ í‘œì‹œ
            this.classList.add('selected');
        });
        
        // ì²´ì¤‘ ê¸°ë¡ì´ ìˆìœ¼ë©´ í‘œì‹œ
        if (weightData[dateKey]) {
            const weightDiv = document.createElement('div');
            weightDiv.className = 'weight-entry';
            weightDiv.textContent = weightData[dateKey] + "kg";
            td.appendChild(weightDiv);
        }
        
        row.appendChild(td);
        
        // í† ìš”ì¼ì´ë‚˜ ì›”ì˜ ë§ˆì§€ë§‰ ë‚ ì´ë©´ ìƒˆ í–‰ ì‹œì‘
        if ((firstDay + day) % 7 === 0 || day === daysInMonth) {
            body.appendChild(row);
            if (day !== daysInMonth) {
                row = document.createElement('tr');
            }
        }
    }
}

/********** ìŠ¤ì¼€ì¤„ ê´€ë¦¬ ê¸°ëŠ¥ **********/
function renderScheduleCalendar() {
    const calendarDays = document.getElementById('calendarDays');
    const currentMonthYear = document.getElementById('currentMonthYear');
    
    if (!calendarDays || !currentMonthYear) return;
    
    // ì›”/ë…„ í—¤ë” ì„¤ì •
    currentMonthYear.textContent = `${currentScheduleYear}ë…„ ${currentScheduleMonth + 1}ì›”`;
    
    // í˜„ì¬ ì›”ì˜ ì²«ë‚ 
    const firstDay = new Date(currentScheduleYear, currentScheduleMonth, 1);
    
    // í˜„ì¬ ì›”ì˜ ë§ˆì§€ë§‰ ë‚ 
    const lastDay = new Date(currentScheduleYear, currentScheduleMonth + 1, 0);
    
    // ì²«ë‚ ì˜ ìš”ì¼ (0: ì¼ìš”ì¼, 6: í† ìš”ì¼)
    const firstDayWeekday = firstDay.getDay();
    
    // ë‹¬ë ¥ ì…€ ì´ˆê¸°í™”
    calendarDays.innerHTML = '';
    
    // ì´ì „ ë‹¬ ë‚ ì§œ ì±„ìš°ê¸°
    for (let i = 0; i < firstDayWeekday; i++) {
        const dayDiv = document.createElement('div');
        dayDiv.className = 'calendar-day other-month';
        dayDiv.innerHTML = `<div class="day-number"></div>`;
        calendarDays.appendChild(dayDiv);
    }
    
    // ì˜¤ëŠ˜ ë‚ ì§œ ì •ë³´
    const today = new Date();
    const todayDate = today.getDate();
    const todayMonth = today.getMonth();
    const todayYear = today.getFullYear();
    
    // í˜„ì¬ ë‹¬ ë‚ ì§œ ì±„ìš°ê¸°
    for (let i = 1; i <= lastDay.getDate(); i++) {
        const dayDiv = document.createElement('div');
        dayDiv.className = 'calendar-day';
        
        // ì˜¤ëŠ˜ ë‚ ì§œ í‘œì‹œ
        if (i === todayDate && currentScheduleMonth === todayMonth && currentScheduleYear === todayYear) {
            dayDiv.classList.add('today');
        }
        
        // ì„ íƒëœ ë‚ ì§œ í‘œì‹œ
        if (i === selectedDate && currentScheduleMonth === currentScheduleMonth && currentScheduleYear === currentScheduleYear) {
            dayDiv.classList.add('selected');
        }
        
        // ë‚ ì§œì— í•´ë‹¹í•˜ëŠ” ì´ë²¤íŠ¸ í™•ì¸
        const dateString = `${currentScheduleYear}-${String(currentScheduleMonth + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
        const dateEvents = schedules.filter(schedule => schedule.date === dateString);
        
        // ì´ë²¤íŠ¸ê°€ ìˆìœ¼ë©´ í‘œì‹œ
        if (dateEvents.length > 0) {
            dayDiv.classList.add('has-events');
            
            // ì´ë²¤íŠ¸ í•­ëª© ì¶”ê°€ (ëª¨ë“  ì´ë²¤íŠ¸ í‘œì‹œ)
            const eventListDiv = document.createElement('div');
            eventListDiv.className = 'event-list';
            
            // ëª¨ë“  ì´ë²¤íŠ¸ í‘œì‹œ (ì œí•œ ì—†ìŒ)
            for (let j = 0; j < dateEvents.length; j++) {
                const eventDiv = document.createElement('div');
                eventDiv.className = 'event-item';
                eventDiv.textContent = dateEvents[j].title;
                eventListDiv.appendChild(eventDiv);
            }
            
            dayDiv.appendChild(eventListDiv);
        }
        
        // ë‚ ì§œ ë²ˆí˜¸ ì¶”ê°€
        const dayNumber = document.createElement('div');
        dayNumber.className = 'day-number';
        dayNumber.textContent = i;
        dayDiv.appendChild(dayNumber);
        
        // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
        dayDiv.addEventListener('click', function() {
            // ì´ì „ì— ì„ íƒëœ ë‚ ì§œ í´ë˜ìŠ¤ ì œê±°
            const selectedDays = document.querySelectorAll('.calendar-day.selected');
            selectedDays.forEach(day => day.classList.remove('selected'));
            
            // í˜„ì¬ ì„ íƒëœ ë‚ ì§œ í‘œì‹œ
            this.classList.add('selected');
            selectedDate = i;
            
            // ì„ íƒëœ ë‚ ì§œì˜ ì´ë²¤íŠ¸ í‘œì‹œ
            const selectedDateObj = new Date(currentScheduleYear, currentScheduleMonth, i);
            showEventsForDate(selectedDateObj);
            
            // ë‚ ì§œ ì…ë ¥ë€ì— ì„ íƒí•œ ë‚ ì§œ ì„¤ì •
            const dateString = `${currentScheduleYear}-${String(currentScheduleMonth + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
            document.getElementById('eventDate').value = dateString;
        });
        
        calendarDays.appendChild(dayDiv);
    }
    
    // ë‹¤ìŒ ë‹¬ ë‚ ì§œ ì±„ìš°ê¸° (6ì£¼ ì±„ìš°ê¸°)
    const usedCells = firstDayWeekday + lastDay.getDate();
    const remainingCells = 42 - usedCells; // 7ì¼ * 6ì£¼ = 42
    
    for (let i = 1; i <= remainingCells; i++) {
        const dayDiv = document.createElement('div');
        dayDiv.className = 'calendar-day other-month';
        dayDiv.innerHTML = `<div class="day-number"></div>`;
        calendarDays.appendChild(dayDiv);
    }
}

// ì´ˆê¸° ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ ì—…ë°ì´íŠ¸
function loadInitialData() {
    document.getElementById("ab-submit")?.addEventListener("click", addAccountItem);
    document.getElementById("addScheduleBtn")?.addEventListener("click", addSchedule);
    
    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¡œë“œ
    loadDataFromLocalStorage();
    
    loadDiaries();
    loadMemos();
    renderTodos();
    renderTodoCalendar();
    renderWeightCalendar();
    renderWeightList();
    loadSchedules();
    renderScheduleCalendar();
    loadAccountData(); // ê°€ê³„ë¶€ ë°ì´í„° ë¡œë“œ
    applyCustomHome();
    
    // ê¸°ë³¸ ë‚ ì§œ ì„¤ì • - ëª¨ë“  ë‚ ì§œ ì…ë ¥ í•„ë“œì— ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
    const today = new Date().toISOString().split('T')[0];
    if (document.getElementById('diaryDate')) document.getElementById('diaryDate').value = today;
    if (document.getElementById('weightDate')) document.getElementById('weightDate').value = today;
    if (document.getElementById('eventDate')) document.getElementById('eventDate').value = today;
    if (document.getElementById('ab-date')) document.getElementById('ab-date').value = today;
    if (document.getElementById('todoDate')) document.getElementById('todoDate').value = today;
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    document.getElementById('addScheduleBtn')?.addEventListener('click', addSchedule);
    document.getElementById('viewListBtn')?.addEventListener('click', showListView);
    document.getElementById('viewCalendarBtn')?.addEventListener('click', showCalendarView);
    document.getElementById('prevMonthBtn')?.addEventListener('click', prevScheduleMonth);
    document.getElementById('nextMonthBtn')?.addEventListener('click', nextScheduleMonth);
    
    // ê°€ê³„ë¶€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    if (document.getElementById('ab-submit')) {
        document.getElementById('ab-submit').addEventListener('click', addAccountItem);
    }
    
    // í•„ìš”í•œ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ
    loadRequiredLibraries();
}
// ê°€ê³„ë¶€ ë‹¬ë ¥ ì´ˆê¸°í™” í•¨ìˆ˜ (FullCalendar) ì—…ë°ì´íŠ¸
function initializeAccountCalendar() {
    const calendarEl = document.getElementById('ab-calendar');
    if (!calendarEl) return;
    
    // ë‹¬ë ¥ì— í‘œì‹œí•  ì´ë²¤íŠ¸ ë°ì´í„° ìƒì„±
    const events = accountData.map(item => ({
        id: item.id.toString(),
        title: `${item.type === 'income' ? 'ìˆ˜ì…' : 'ì§€ì¶œ'}: ${item.amount.toLocaleString()}ì› (${item.category})`,
        start: item.date,
        color: item.type === 'income' ? '#4CAF50' : '#f44336',
        extendedProps: {
            amount: item.amount,
            category: item.category,
            method: item.method,
            memo: item.memo
        }
    }));
    
    // ê¸°ì¡´ì— ì´ˆê¸°í™”ëœ ë‹¬ë ¥ì´ ìˆëŠ”ì§€ í™•ì¸
    if (calendarEl.innerHTML) {
        try {
            // ê¸°ì¡´ ë‹¬ë ¥ì´ ìˆìœ¼ë©´ ì´ˆê¸°í™”
            calendarEl.innerHTML = '';
        } catch (e) {
            console.error("ë‹¬ë ¥ ì´ˆê¸°í™” ì˜¤ë¥˜:", e);
        }
    }
    
    try {
        // FullCalendar ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek'
            },
            events: events,
            locale: 'ko',
            height: '600px',
            dateClick: function(info) {
                // ë‚ ì§œ í´ë¦­ ì‹œ ì…ë ¥ë€ì— í•´ë‹¹ ë‚ ì§œ ì„¤ì •
                document.getElementById('ab-date').value = info.dateStr;
                document.getElementById('ab-amount').focus();
            },
            eventClick: function(info) {
                // ì´ë²¤íŠ¸ í´ë¦­ ì‹œ ìƒì„¸ ì •ë³´ í‘œì‹œ
                const eventData = info.event;
                const props = eventData.extendedProps;
                
                alert(`[${eventData.title}]
ë‚ ì§œ: ${eventData.startStr}
ê¸ˆì•¡: ${props.amount.toLocaleString()}ì›
ì¹´í…Œê³ ë¦¬: ${props.category}
ê²°ì œë°©ë²•: ${props.method}
ë©”ëª¨: ${props.memo || 'ì—†ìŒ'}`);
            },
            datesSet: function(dateInfo) {
                // ì›” ë³€ê²½ ì‹œ í•´ë‹¹ ì›”ì˜ ìˆ˜ì…/ì§€ì¶œ í•©ê³„ í‘œì‹œ
                const start = dateInfo.start;
                const end = dateInfo.end;
                
                let monthIncome = 0, monthExpense = 0;
                
                accountData.forEach(item => {
                    const itemDate = new Date(item.date);
                    if (itemDate >= start && itemDate < end) {
                        if (item.type === 'income') {
                            monthIncome += item.amount;
                        } else {
                            monthExpense += item.amount;
                        }
                    }
                });
                
                // ë‹¬ë ¥ ìœ„ì— ìš”ì•½ ì •ë³´ í‘œì‹œ
                const infoEl = document.createElement('div');
                infoEl.className = 'fc-header-toolbar mt-2 mb-3';
                infoEl.innerHTML = `
                    <div style="text-align:center; width:100%; font-weight:bold; padding:10px;">
                        ${dateInfo.view.title} - 
                        ìˆ˜ì…: <span style="color:#4CAF50">${monthIncome.toLocaleString()}ì›</span> | 
                        ì§€ì¶œ: <span style="color:#f44336">${monthExpense.toLocaleString()}ì›</span> | 
                        ì”ì•¡: <span style="color:${monthIncome - monthExpense >= 0 ? '#4CAF50' : '#f44336'}">${(monthIncome - monthExpense).toLocaleString()}ì›</span>
                    </div>
                `;
                
                // ê¸°ì¡´ ìš”ì•½ ì •ë³´ê°€ ìˆìœ¼ë©´ ì œê±°
                const existingInfo = calendarEl.querySelector('.fc-header-toolbar:not(:first-child)');
                if (existingInfo) {
                    existingInfo.remove();
                }
                
                // ìƒˆ ìš”ì•½ ì •ë³´ ì¶”ê°€
                const header = calendarEl.querySelector('.fc-header-toolbar');
                if (header) {
                    header.parentNode.insertBefore(infoEl, header.nextSibling);
                }
            }
        });
        
        // ë‹¬ë ¥ ë Œë”ë§
        calendar.render();
    } catch (e) {
        console.error("FullCalendar ì´ˆê¸°í™” ì˜¤ë¥˜:", e);
        calendarEl.innerHTML = '<div style="padding: 20px; text-align: center; color: #f44336;">ë‹¬ë ¥ì„ ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ë‹¤ë¥¸ íƒ­ì„ í´ë¦­í•œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div>';
    }
}

// CSS ìŠ¤íƒ€ì¼ ì¶”ê°€ (ë‹¬ë ¥ ë‚ ì§œ ì„ íƒ ê´€ë ¨)
function addCalendarSelectionStyles() {
    const styleEl = document.createElement('style');
    styleEl.textContent = `
        /* ë‹¬ë ¥ì—ì„œ ì„ íƒëœ ë‚ ì§œ ìŠ¤íƒ€ì¼ */
        .calendar-table td.selected {
            background-color: #e8f4f1;
            border: 2px solid #5f7561;
            box-shadow: 0 0 8px rgba(95, 117, 97, 0.3);
        }
        
        .calendar-day.selected {
            background-color: #e8f4f1;
            border: 2px solid #5f7561 !important;
            box-shadow: 0 0 8px rgba(95, 117, 97, 0.3);
        }
        
        /* ì˜¤ëŠ˜ ë‚ ì§œ ìŠ¤íƒ€ì¼ */
        .calendar-table td.today {
            background-color: #f5f0e5;
            border: 2px solid #e3b587;
        }
    `;
    document.head.appendChild(styleEl);
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ ìŠ¤íƒ€ì¼ ì¶”ê°€
document.addEventListener('DOMContentLoaded', function() {
    addCalendarSelectionStyles();
});
// ===== ê²€ìƒ‰ ê´€ë ¨ í•¨ìˆ˜ =====
function performSearch() {
  const searchInput = document.getElementById('searchInput');
  const searchType = document.getElementById('searchType');
  const searchResults = document.getElementById('searchResults');
  
  const query = searchInput.value.trim().toLowerCase();
  const type = searchType.value;
  
  if (!query) {
    alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  searchResults.innerHTML = '<p>ê²€ìƒ‰ ì¤‘...</p>';
  
  // ê²€ìƒ‰ ê²°ê³¼ ë°°ì—´
  let results = [];
  
  // ê²€ìƒ‰ ìœ í˜•ì— ë”°ë¼ ë‹¤ë¥¸ ë°ì´í„° ì†ŒìŠ¤ ê²€ìƒ‰
  if (type === 'all' || type === 'diary') {
    results = results.concat(searchDiaries(query));
  }
  
  if (type === 'all' || type === 'memo') {
    results = results.concat(searchMemos(query));
  }
  
  if (type === 'all' || type === 'todo') {
    results = results.concat(searchTodos(query));
  }
  
  if (type === 'all' || type === 'schedule') {
    results = results.concat(searchSchedules(query));
  }
  
  if (type === 'all' || type === 'accountbook') {
    results = results.concat(searchAccountbook(query));
  }
  
  // ìµœì‹  í•­ëª©ìˆœìœ¼ë¡œ ì •ë ¬
  results.sort((a, b) => new Date(b.date) - new Date(a.date));
  
  // ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
  renderSearchResults(results, query);
}

// ì¼ê¸° ê²€ìƒ‰
function searchDiaries(query) {
  const results = [];
  
  diaries.forEach(diary => {
    if (diary.content.toLowerCase().includes(query)) {
      results.push({
        id: diary.id,
        type: 'diary',
        title: `${formatDate(diary.date)} ì¼ê¸°`,
        content: diary.content,
        date: diary.updatedAt || diary.createdAt,
        originalDate: diary.date
      });
    }
  });
  
  return results;
}

// ë©”ëª¨ ê²€ìƒ‰
function searchMemos(query) {
  const results = [];
  
  memos.forEach(memo => {
    if (memo.title.toLowerCase().includes(query) || memo.content.toLowerCase().includes(query)) {
      results.push({
        id: memo.id,
        type: 'memo',
        title: memo.title,
        content: memo.content,
        date: memo.createdAt,
        originalDate: memo.createdAt
      });
    }
  });
  
  return results;
}

// í• ì¼ ê²€ìƒ‰
function searchTodos(query) {
  const results = [];
  
  todos.forEach(todo => {
    if (todo.text.toLowerCase().includes(query)) {
      results.push({
        id: todo.id,
        type: 'todo',
        title: todo.text,
        content: `í• ì¼ ìƒíƒœ: ${todo.completed ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ'}`,
        date: todo.createdAt,
        originalDate: todo.date,
        completed: todo.completed
      });
    }
  });
  
  return results;
}

// ì¼ì • ê²€ìƒ‰
function searchSchedules(query) {
  const results = [];
  
  schedules.forEach(schedule => {
    if (schedule.title.toLowerCase().includes(query) || 
        (schedule.description && schedule.description.toLowerCase().includes(query))) {
      results.push({
        id: schedule.id,
        type: 'schedule',
        title: schedule.title,
        content: schedule.description || '(ìƒì„¸ ë‚´ìš© ì—†ìŒ)',
        date: new Date(schedule.date).toISOString(),
        originalDate: schedule.date,
        time: schedule.time
      });
    }
  });
  
  return results;
}

// ê°€ê³„ë¶€ ê²€ìƒ‰
function searchAccountbook(query) {
  const results = [];
  
  accountData.forEach(item => {
    if ((item.memo && item.memo.toLowerCase().includes(query)) || 
        item.category.toLowerCase().includes(query) ||
        item.method.toLowerCase().includes(query)) {
      results.push({
        id: item.id,
        type: 'accountbook',
        title: `${item.type === 'income' ? 'ìˆ˜ì…' : 'ì§€ì¶œ'}: ${item.amount.toLocaleString()}ì›`,
        content: `ì¹´í…Œê³ ë¦¬: ${item.category}, ê²°ì œë°©ë²•: ${item.method}${item.memo ? ', ë©”ëª¨: ' + item.memo : ''}`,
        date: new Date(item.date).toISOString(),
        originalDate: item.date
      });
    }
  });
  
  return results;
}

// ê²€ìƒ‰ ê²°ê³¼ ë Œë”ë§
function renderSearchResults(results, query) {
  const searchResults = document.getElementById('searchResults');
  
  if (results.length === 0) {
    searchResults.innerHTML = '<p class="no-results">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
    return;
  }
  
  searchResults.innerHTML = `<p>ì´ ${results.length}ê°œì˜ ê²€ìƒ‰ ê²°ê³¼</p>`;
  
  results.forEach(result => {
    const resultItem = document.createElement('div');
    resultItem.className = 'search-result-item';
    
    let typeName = '';
    let typeAction = '';
    
    switch(result.type) {
      case 'diary':
        typeName = 'ì¼ê¸°';
        typeAction = `showTab('diary'); setTimeout(() => { editDiary(${result.id}); }, 100);`;
        break;
      case 'memo':
        typeName = 'ë©”ëª¨';
        typeAction = `showTab('memo'); setTimeout(() => { editMemo(${result.id}); }, 100);`;
        break;
      case 'todo':
        typeName = 'í• ì¼';
        typeAction = `showTab('todo'); setTimeout(() => { editTodo(${result.id}); }, 100);`;
        break;
      case 'schedule':
        typeName = 'ì¼ì •';
        typeAction = `showTab('schedule'); setTimeout(() => { editSchedule(${result.id}); }, 100);`;
        break;
      case 'accountbook':
        typeName = 'ê°€ê³„ë¶€';
        typeAction = `showTab('accountbook');`;
        break;
    }
    
    // ê²€ìƒ‰ì–´ ê°•ì¡° í‘œì‹œ
    const highlightedContent = highlightSearchQuery(result.content, query);
    const highlightedTitle = highlightSearchQuery(result.title, query);
    
    resultItem.innerHTML = `
      <div class="search-result-header">
        <span class="search-result-category">${typeName}</span>
        <span class="search-result-date">${result.originalDate ? formatDate(result.originalDate) : ''}</span>
      </div>
      <div class="search-result-title">${highlightedTitle}</div>
      <div class="search-result-content">${highlightedContent}</div>
      <div class="search-result-controls">
        <button onclick="${typeAction}">ë³´ê¸°</button>
      </div>
    `;
    
    searchResults.appendChild(resultItem);
  });
}

// ê²€ìƒ‰ì–´ ê°•ì¡° í‘œì‹œ
function highlightSearchQuery(text, query) {
  if (!text) return '';
  
  const regex = new RegExp(query, 'gi');
  return text.replace(regex, match => `<span class="search-result-highlight">${match}</span>`);
}

// ===== ëª©í‘œ ê´€ë ¨ í•¨ìˆ˜ =====
let goals = [];
let goalProgress = [];

// ëª©í‘œ ì¶”ê°€
function addGoal() {
  const title = document.getElementById('goalTitle').value.trim();
  const category = document.getElementById('goalCategory').value;
  const startValue = parseFloat(document.getElementById('goalStartValue').value);
  const targetValue = parseFloat(document.getElementById('goalTargetValue').value);
  const unit = document.getElementById('goalUnit').value.trim();
  const startDate = document.getElementById('goalStartDate').value;
  const endDate = document.getElementById('goalEndDate').value;
  const description = document.getElementById('goalDescription').value.trim();
  
  // ê¸°ë³¸ ìœ íš¨ì„± ê²€ì‚¬
  if (!title) {
    alert('ëª©í‘œ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  if (isNaN(startValue) || isNaN(targetValue)) {
    alert('ì‹œì‘ ê°’ê³¼ ëª©í‘œ ê°’ì€ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  if (!startDate || !endDate) {
    alert('ì‹œì‘ì¼ê³¼ ëª©í‘œì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  // ë‚ ì§œ ìœ íš¨ì„± ê²€ì‚¬
  if (new Date(endDate) <= new Date(startDate)) {
    alert('ëª©í‘œì¼ì€ ì‹œì‘ì¼ë³´ë‹¤ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤.');
    return;
  }
  
  // ëª©í‘œ ìƒì„±
  const goal = {
    id: Date.now(),
    title,
    category,
    startValue,
    targetValue,
    currentValue: startValue, // ì´ˆê¸°ê°’ì€ ì‹œì‘ê°’ê³¼ ë™ì¼
    unit,
    startDate,
    endDate,
    description,
    createdAt: new Date().toISOString()
  };
  
  // ëª©í‘œ ì§„í–‰ ê¸°ë¡ ì´ˆê¸° í•­ëª© ì¶”ê°€
  const initialProgress = {
    goalId: goal.id,
    date: startDate,
    value: startValue
  };
  
  // ë°ì´í„° ì €ì¥
  goals.push(goal);
  goalProgress.push(initialProgress);
  
  saveGoals();
  
  // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
  document.getElementById('goalTitle').value = '';
  document.getElementById('goalStartValue').value = '';
  document.getElementById('goalTargetValue').value = '';
  document.getElementById('goalUnit').value = '';
  document.getElementById('goalDescription').value = '';
  
  // ëª©í‘œ ëª©ë¡ ë Œë”ë§
  renderGoals();
  alert('ìƒˆë¡œìš´ ëª©í‘œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
}

// ëª©í‘œ ì €ì¥
function saveGoals() {
  localStorage.setItem('goals', JSON.stringify(goals));
  localStorage.setItem('goalProgress', JSON.stringify(goalProgress));
}

// ëª©í‘œ ë¡œë“œ
function loadGoals() {
  try {
    const savedGoals = localStorage.getItem('goals');
    const savedProgress = localStorage.getItem('goalProgress');
    
    if (savedGoals) goals = JSON.parse(savedGoals);
    if (savedProgress) goalProgress = JSON.parse(savedProgress);
    
    renderGoals();
  } catch (e) {
    console.error('ëª©í‘œ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
    goals = [];
    goalProgress = [];
  }
}

// ëª©í‘œ ë Œë”ë§
function renderGoals() {
  const goalsList = document.getElementById('goalsList');
  
  if (!goalsList) return;
  
  if (goals.length === 0) {
    goalsList.innerHTML = '<p class="no-goals" style="text-align: center; color: #888; padding: 20px;">ì•„ì§ ì„¤ì •ëœ ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ëª©í‘œë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>';
    return;
  }
  
  goalsList.innerHTML = '';
  
  // ëª©í‘œì¼ ê¸°ì¤€ ì •ë ¬ (ê°€ê¹Œìš´ ëª©í‘œ ë¨¼ì €)
  goals.sort((a, b) => new Date(a.endDate) - new Date(b.endDate));
  
  goals.forEach(goal => {
    // í˜„ì¬ ì§„í–‰ ìƒí™© ê³„ì‚°
    const progress = calculateGoalProgress(goal);
    
    // ë‚¨ì€ ì¼ìˆ˜ ê³„ì‚°
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const endDate = new Date(goal.endDate);
    endDate.setHours(0, 0, 0, 0);
    
    const daysRemaining = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
    
    const goalItem = document.createElement('div');
    goalItem.className = 'goal-item';
    
    // ì¦ê°€/ê°ì†Œì— ë”°ë¥¸ ë°©í–¥ ë° í…ìŠ¤íŠ¸ ìƒ‰ìƒ
    const isIncreasing = goal.targetValue > goal.startValue;
    const directionText = isIncreasing ? 'ëŠ˜ë¦¬ê¸°' : 'ì¤„ì´ê¸°';
    const valueColor = isIncreasing ? 
                        (goal.currentValue >= goal.targetValue ? '#4CAF50' : '#333') : 
                        (goal.currentValue <= goal.targetValue ? '#4CAF50' : '#333');
    
    goalItem.innerHTML = `
      <div class="goal-header">
        <div class="goal-title">${goal.title}</div>
        <div class="goal-category">${getCategoryName(goal.category)}</div>
      </div>
      
      <div class="goal-info">
        <div class="goal-info-item">
          <div class="goal-info-label">ì‹œì‘ ê°’</div>
          <div class="goal-info-value">${goal.startValue} ${goal.unit}</div>
        </div>
        <div class="goal-info-item">
          <div class="goal-info-label">í˜„ì¬ ê°’</div>
          <div class="goal-info-value" style="color: ${valueColor}">
            ${goal.currentValue} ${goal.unit}
          </div>
        </div>
        <div class="goal-info-item">
          <div class="goal-info-label">ëª©í‘œ ê°’</div>
          <div class="goal-info-value">${goal.targetValue} ${goal.unit}</div>
        </div>
      </div>
      
      <div class="goal-info">
        <div class="goal-info-item">
          <div class="goal-info-label">ì‹œì‘ì¼</div>
          <div class="goal-info-value">${formatDate(goal.startDate)}</div>
        </div>
        <div class="goal-info-item">
          <div class="goal-info-label">ëª©í‘œì¼</div>
          <div class="goal-info-value">${formatDate(goal.endDate)}</div>
        </div>
        <div class="goal-info-item">
          <div class="goal-info-label">ë‚¨ì€ ê¸°ê°„</div>
          <div class="goal-info-value">
            ${daysRemaining <= 0 ? 'ê¸°ê°„ ì¢…ë£Œ' : `${daysRemaining}ì¼ ë‚¨ìŒ`}
          </div>
        </div>
      </div>
      
      <div class="goal-progress">
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
          <span>ì§„í–‰ ìƒí™©: ${progress}%</span>
          <span>${directionText}</span>
        </div>
        <div class="goal-progress-bar">
          <div class="goal-progress-fill" style="width: ${progress}%;"></div>
        </div>
      </div>
      
      ${goal.description ? `<div style="margin-bottom: 15px; color: #666;">${goal.description}</div>` : ''}
      
      <div class="goal-controls">
        <button onclick="showGoalUpdateForm(${goal.id})">ì—…ë°ì´íŠ¸</button>
        <button onclick="viewGoalHistory(${goal.id})">ê¸°ë¡ ë³´ê¸°</button>
        <button class="delete-btn" onclick="deleteGoal(${goal.id})">ì‚­ì œ</button>
      </div>
    `;
    
    goalsList.appendChild(goalItem);
  });
}

// ëª©í‘œ ì§„í–‰ ìƒí™© ê³„ì‚°
function calculateGoalProgress(goal) {
  // ëª©í‘œê°€ ì¦ê°€ì¸ì§€ ê°ì†Œì¸ì§€ í™•ì¸
  const isIncreasing = goal.targetValue > goal.startValue;
  
  // ëª©í‘œ ê°’ê³¼ ì‹œì‘ ê°’ì˜ ì°¨ì´
  const totalDifference = Math.abs(goal.targetValue - goal.startValue);
  
  // í˜„ì¬ê¹Œì§€ ë‹¬ì„±í•œ ì°¨ì´
  const currentDifference = Math.abs(goal.currentValue - goal.startValue);
  
  // ì§„í–‰ ìƒí™© ê³„ì‚° (í¼ì„¼íŠ¸)
  let progress = (currentDifference / totalDifference) * 100;
  
  // ì´ë¯¸ ëª©í‘œë¥¼ ë‹¬ì„±í–ˆë‹¤ë©´ 100%ë¡œ ê³ ì •
  if (isIncreasing && goal.currentValue >= goal.targetValue) {
    progress = 100;
  } else if (!isIncreasing && goal.currentValue <= goal.targetValue) {
    progress = 100;
  }
  
  // ë²”ìœ„ ì œí•œ (0~100%)
  progress = Math.min(Math.max(progress, 0), 100);
  
  return Math.round(progress);
}

// ëª©í‘œ ì—…ë°ì´íŠ¸ í¼ í‘œì‹œ
function showGoalUpdateForm(goalId) {
  const goal = goals.find(g => g.id === goalId);
  if (!goal) return;
  
  const form = document.getElementById('goalUpdateForm');
  const valueInput = document.getElementById('goalUpdateValue');
  const dateInput = document.getElementById('goalUpdateDate');
  const idInput = document.getElementById('goalUpdateId');
  
  valueInput.value = goal.currentValue;
  dateInput.value = new Date().toISOString().split('T')[0]; // ì˜¤ëŠ˜ ë‚ ì§œ
  idInput.value = goal.id;
  
  form.style.display = 'block';
  form.scrollIntoView({ behavior: 'smooth' });
}

// ëª©í‘œ ì—…ë°ì´íŠ¸ í¼ ë‹«ê¸°
function closeGoalUpdateForm() {
  document.getElementById('goalUpdateForm').style.display = 'none';
}

// ëª©í‘œ ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
function updateGoalProgress() {
  const value = parseFloat(document.getElementById('goalUpdateValue').value);
  const date = document.getElementById('goalUpdateDate').value;
  const goalId = parseInt(document.getElementById('goalUpdateId').value);
  
  if (isNaN(value)) {
    alert('ìœ íš¨í•œ ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  if (!date) {
    alert('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
    return;
  }
  
  // ëª©í‘œ ì°¾ê¸°
  const goalIndex = goals.findIndex(g => g.id === goalId);
  if (goalIndex === -1) return;
  
  // ëª©í‘œ ì§„í–‰ ê¸°ë¡ ì¶”ê°€
  const newProgress = {
    goalId,
    date,
    value
  };
  
  goalProgress.push(newProgress);
  
  // ëª©í‘œì˜ í˜„ì¬ ê°’ ì—…ë°ì´íŠ¸
  goals[goalIndex].currentValue = value;
  
  // ì €ì¥ ë° ì—…ë°ì´íŠ¸
  saveGoals();
  renderGoals();
  closeGoalUpdateForm();
  
  alert('ëª©í‘œ ì§„í–‰ ìƒí™©ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
}

// ëª©í‘œ ê¸°ë¡ ë³´ê¸°
function viewGoalHistory(goalId) {
  const goal = goals.find(g => g.id === goalId);
  if (!goal) return;
  
  // í•´ë‹¹ ëª©í‘œì˜ ì§„í–‰ ê¸°ë¡ ê°€ì ¸ì˜¤ê¸°
  const history = goalProgress.filter(p => p.goalId === goalId);
  
  // ë‚ ì§œìˆœ ì •ë ¬
  history.sort((a, b) => new Date(a.date) - new Date(b.date));
  
  // í…Œì´ë¸” í˜•íƒœë¡œ í‘œì‹œ
  let historyHtml = `
    <h3>${goal.title} ì§„í–‰ ê¸°ë¡</h3>
    <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
      <thead>
        <tr style="background-color: #f0f0f0;">
          <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">ë‚ ì§œ</th>
          <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">ê°’ (${goal.unit})</th>
        </tr>
      </thead>
      <tbody>
  `;
  
  history.forEach(item => {
    historyHtml += `
      <tr>
        <td style="padding: 8px; border: 1px solid #ddd;">${formatDate(item.date)}</td>
        <td style="padding: 8px; border: 1px solid #ddd;">${item.value} ${goal.unit}</td>
      </tr>
    `;
  });
  
  historyHtml += `
      </tbody>
    </table>
  `;
  
  alert(historyHtml);
}

// ëª©í‘œ ì‚­ì œ
function deleteGoal(goalId) {
  if (!confirm('ì´ ëª©í‘œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  
  // ëª©í‘œ ì‚­ì œ
  goals = goals.filter(g => g.id !== goalId);
  
  // ê´€ë ¨ ì§„í–‰ ê¸°ë¡ë„ í•¨ê»˜ ì‚­ì œ
  goalProgress = goalProgress.filter(p => p.goalId !== goalId);
  
  // ì €ì¥ ë° ì—…ë°ì´íŠ¸
  saveGoals();
  renderGoals();
  
  alert('ëª©í‘œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
}

// ì¹´í…Œê³ ë¦¬ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
function getCategoryName(category) {
  const categories = {
    'weight': 'ì²´ì¤‘',
    'finance': 'ì¬ì •',
    'study': 'ê³µë¶€',
    'fitness': 'ìš´ë™',
    'custom': 'ì§ì ‘ ì…ë ¥'
  };
  
  return categories[category] || category;
}

// ===== ìŠµê´€ ê´€ë ¨ í•¨ìˆ˜ =====
let habits = [];
let habitRecords = [];
let currentHabitYear = new Date().getFullYear();
let currentHabitMonth = new Date().getMonth();

// ìŠµê´€ ë¹ˆë„ ë³€ê²½ ì´ë²¤íŠ¸ ì²˜ë¦¬
document.addEventListener('DOMContentLoaded', function() {
  const habitFrequency = document.getElementById('habitFrequency');
  const weekDaysContainer = document.getElementById('habitWeekDaysContainer');
  
  if (habitFrequency && weekDaysContainer) {
    habitFrequency.addEventListener('change', function() {
      if (this.value === 'weekly') {
        weekDaysContainer.style.display = 'block';
      } else {
        weekDaysContainer.style.display = 'none';
      }
    });
  }
  
  // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
  loadGoals();
  loadHabits();
});

// ìŠµê´€ ì¶”ê°€ í•¨ìˆ˜ ìˆ˜ì • - ì£¼5ì¼(ì›”-ê¸ˆ)ê³¼ íŠ¹ì •ì¼ ì„ íƒ ì²˜ë¦¬
function addHabit() {
  const title = document.getElementById('habitTitle').value.trim();
  const category = document.getElementById('habitCategory').value;
  const customCategory = document.getElementById('habitCustomCategory')?.value.trim();
  const frequency = document.getElementById('habitFrequency').value;
  const description = document.getElementById('habitDescription').value.trim();
  
  if (!title) {
    alert('ìŠµê´€ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  // ì‹¤ì œ ì‚¬ìš©í•  ì¹´í…Œê³ ë¦¬ (ì§ì ‘ ì…ë ¥ ì„ íƒ ì‹œ customCategory ì‚¬ìš©)
  const finalCategory = category === 'custom' ? (customCategory || 'ì§ì ‘ ì…ë ¥') : category;
  
  // ì£¼ê°„ ìŠµê´€ì¸ ê²½ìš° ì„ íƒí•œ ìš”ì¼ ë˜ëŠ” ì£¼ 5ì¼(ì›”-ê¸ˆ) ì˜µì…˜ ì²˜ë¦¬
  let weekDays = [];
  if (frequency === 'weekly') {
    const weekdayOption = document.querySelector('input[name="weekdayOption"]:checked')?.value;
    
    if (weekdayOption === 'weekdays' || !weekdayOption) {
      // ì£¼ 5ì¼(ì›”-ê¸ˆ) ì„ íƒ (ë””í´íŠ¸)
      weekDays = [1, 2, 3, 4, 5]; // ì›”í™”ìˆ˜ëª©ê¸ˆ (1-5)
    } else if (weekdayOption === 'custom') {
      // ì§ì ‘ ì„ íƒ
      const checkboxes = document.querySelectorAll('.habitWeekDay:checked');
      weekDays = Array.from(checkboxes).map(cb => parseInt(cb.value));
      
      if (weekDays.length === 0) {
        alert('í•˜ë‚˜ ì´ìƒì˜ ìš”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
    }
  }
  
  const habit = {
    id: Date.now(),
    title,
    category: finalCategory,
    frequency,
    weekDays, // ì£¼ê°„ì¸ ê²½ìš°ë§Œ ì‚¬ìš©ë¨
    description,
    createdAt: new Date().toISOString(),
    streak: 0, // ì´ˆê¸° ì—°ì† ê¸°ë¡ì€ 0
    color: getRandomHabitColor() // ëœë¤ ìƒ‰ìƒ ì§€ì •
  };
  
  habits.push(habit);
  saveHabits();
  
  // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
  document.getElementById('habitTitle').value = '';
  document.getElementById('habitCategory').value = 'health';
  if (document.getElementById('habitCustomCategory')) {
    document.getElementById('habitCustomCategory').value = '';
    document.getElementById('habitCustomCategory').style.display = 'none';
  }
  document.getElementById('habitFrequency').value = 'daily';
  
  // ì£¼ê°„ ì˜µì…˜ ì´ˆê¸°í™”
  const weekdayOptionContainer = document.getElementById('weekdayOptionContainer');
  const customWeekdaysContainer = document.getElementById('customWeekdaysContainer');
  if (weekdayOptionContainer) weekdayOptionContainer.style.display = 'none';
  if (customWeekdaysContainer) customWeekdaysContainer.style.display = 'none';
  
  // ìš”ì¼ ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
  document.querySelectorAll('.habitWeekDay').forEach(cb => cb.checked = false);
  
  // ì£¼ 5ì¼ ì˜µì…˜ì´ ê¸°ë³¸ê°’ì´ ë˜ë„ë¡ ì„¤ì •
  const weekdaysOption = document.getElementById('weekdaysOption');
  if (weekdaysOption) weekdaysOption.checked = true;
  
  document.getElementById('habitDescription').value = '';
  
  // ìŠµê´€ ëª©ë¡ ë° ë‹¬ë ¥ ë Œë”ë§
  renderHabits();
  renderHabitCalendar();
  
  alert('ìƒˆë¡œìš´ ìŠµê´€ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
}
// ëœë¤ ìŠµê´€ ìƒ‰ìƒ ìƒì„±
function getRandomHabitColor() {
  const colors = [
    '#5f7561', '#4CAF50', '#8BC34A', '#2196F3', '#9C27B0',
    '#FF9800', '#9E9E9E', '#607D8B', '#795548', '#FF5722'
  ];
  
  return colors[Math.floor(Math.random() * colors.length)];
}

// ìŠµê´€ ì €ì¥
function saveHabits() {
  localStorage.setItem('habits', JSON.stringify(habits));
  localStorage.setItem('habitRecords', JSON.stringify(habitRecords));
}

// ìŠµê´€ ë¡œë“œ
function loadHabits() {
  try {
    const savedHabits = localStorage.getItem('habits');
    const savedRecords = localStorage.getItem('habitRecords');
    
    if (savedHabits) habits = JSON.parse(savedHabits);
    if (savedRecords) habitRecords = JSON.parse(savedRecords);
    
    renderHabits();
    renderHabitCalendar();
  } catch (e) {
    console.error('ìŠµê´€ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
    habits = [];
    habitRecords = [];
  }
}

// ìŠµê´€ ëª©ë¡ ë Œë”ë§
function renderHabits() {
  const habitsList = document.getElementById('habitsList');
  
  if (!habitsList) return;
  
  if (habits.length === 0) {
    habitsList.innerHTML = '<p class="no-habits" style="text-align: center; color: #888; padding: 20px;">ì•„ì§ ì¶”ê°€ëœ ìŠµê´€ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ìŠµê´€ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>';
    return;
  }
  
  habitsList.innerHTML = '';
  
  // ìƒì„±ì¼ ê¸°ì¤€ ì •ë ¬ (ìµœì‹  ìˆœ)
  habits.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
  
  habits.forEach(habit => {
    const habitItem = document.createElement('div');
    habitItem.className = 'habit-list-item';
    
    // ìŠµê´€ ë¹ˆë„ í…ìŠ¤íŠ¸
    let frequencyText = 'ë§¤ì¼';
    if (habit.frequency === 'weekly') {
      const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
      const selectedDays = habit.weekDays.map(day => days[day]).join(', ');
      frequencyText = `ë§¤ì£¼ ${selectedDays}ìš”ì¼`;
    } else if (habit.frequency === 'monthly') {
      frequencyText = 'ë§¤ì›”';
    }
    
    // ì—°ì† ë‹¬ì„± ì¼ìˆ˜ ê³„ì‚°
    const streak = calculateHabitStreak(habit);
    
    habitItem.innerHTML = `
      <div class="habit-list-header">
        <div class="habit-list-title">${habit.title}</div>
        <div class="habit-list-category">${getHabitCategoryName(habit.category)}</div>
      </div>
      
      <div>${frequencyText}</div>
      ${habit.description ? `<div style="margin-top: 8px; color: #666;">${habit.description}</div>` : ''}
      
      <div class="habit-streak">
        <span class="habit-streak-number">${streak}</span> ì¼ ì—°ì† ë‹¬ì„± ì¤‘
      </div>
      
      <div class="habit-list-controls">
        <button onclick="checkHabitToday(${habit.id})">ì˜¤ëŠ˜ ì²´í¬</button>
        <button onclick="viewHabitHistory(${habit.id})">ê¸°ë¡ ë³´ê¸°</button>
        <button class="delete-btn" onclick="deleteHabit(${habit.id})">ì‚­ì œ</button>
      </div>
    `;
    
    habitsList.appendChild(habitItem);
  });
}

// ìŠµê´€ ë‹¬ë ¥ ë Œë”ë§
function renderHabitCalendar() {
  const habitCalendar = document.getElementById('habitCalendar');
  const habitCalendarHeader = document.getElementById('habitCalendarHeader');
  
  if (!habitCalendar || !habitCalendarHeader) return;
  
  habitCalendarHeader.textContent = `${currentHabitYear}ë…„ ${currentHabitMonth + 1}ì›”`;
  
  // í˜„ì¬ ì›”ì˜ ì²«ë‚ ê³¼ ë§ˆì§€ë§‰ ë‚ 
  const firstDay = new Date(currentHabitYear, currentHabitMonth, 1);
  const lastDay = new Date(currentHabitYear, currentHabitMonth + 1, 0);
  
  // ì²«ì§¸ ë‚ ì˜ ìš”ì¼ (0: ì¼ìš”ì¼, 6: í† ìš”ì¼)
  const firstDayOfWeek = firstDay.getDay();
  
  // ë§ˆì§€ë§‰ ë‚ ì§œ
  const lastDate = lastDay.getDate();
  
  // ì˜¤ëŠ˜ ë‚ ì§œ
  const today = new Date();
  const isCurrentMonth = today.getFullYear() === currentHabitYear && today.getMonth() === currentHabitMonth;
  const todayDate = today.getDate();
  
  // ë‹¬ë ¥ ìƒì„±
  let calendarHTML = '<div class="habit-calendar-header">';
  const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
  
  // ìš”ì¼ í—¤ë”
  for (let i = 0; i < 7; i++) {
    calendarHTML += `<div class="habit-calendar-day-name">${days[i]}</div>`;
  }
  
  calendarHTML += '</div><div class="habit-calendar-body">';
  
  // ì²«ì§¸ ë‚  ì´ì „ì˜ ë¹ˆ ì…€
  for (let i = 0; i < firstDayOfWeek; i++) {
    calendarHTML += '<div class="habit-calendar-day other-month"></div>';
  }
  
  // ë‚ ì§œ ì±„ìš°ê¸°
  for (let day = 1; day <= lastDate; day++) {
    const date = new Date(currentHabitYear, currentHabitMonth, day);
    const dateStr = date.toISOString().split('T')[0];
    const isToday = isCurrentMonth && day === todayDate;
    
    calendarHTML += `
      <div class="habit-calendar-day ${isToday ? 'today' : ''}">
        <div class="habit-day-number">${day}</div>
        <div class="habit-items" data-date="${dateStr}">
    `;
    
    // ì˜¤ëŠ˜ê³¼ ê·¸ ì´ì „ ë‚ ì§œì—ë§Œ ìŠµê´€ ì²´í¬ í•­ëª© í‘œì‹œ
    const isPastOrToday = new Date(dateStr) <= today;
    
    if (isPastOrToday) {
      // í•´ë‹¹ ë‚ ì§œì— ì²´í¬ ê°€ëŠ¥í•œ ìŠµê´€ ëª©ë¡ í‘œì‹œ
      habits.forEach(habit => {
        // í•´ë‹¹ ë‚ ì§œì— ì´ ìŠµê´€ì´ ì²´í¬ ê°€ëŠ¥í•œì§€ í™•ì¸
        if (isHabitScheduledForDate(habit, date)) {
          // ì´ ë‚ ì§œì— ìŠµê´€ì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
          const isCompleted = isHabitCompletedOnDate(habit.id, dateStr);
          
          calendarHTML += `
            <div class="habit-item">
              <span class="habit-circle ${isCompleted ? 'completed' : 'missed'}" 
                    style="background-color: ${isCompleted ? habit.color : '#eee'}; border-color: ${habit.color};"
                    title="${habit.title}"></span>
              <span>${habit.title}</span>
            </div>
          `;
        }
      });
    }
    
    calendarHTML += '</div></div>';
  }
  
  // ë§ˆì§€ë§‰ ì£¼ ì´í›„ì˜ ë¹ˆ ì…€ ì±„ìš°ê¸°
  const lastDayOfWeek = lastDay.getDay();
  const remainingCells = 6 - lastDayOfWeek;
  
  for (let i = 0; i < remainingCells; i++) {
    calendarHTML += '<div class="habit-calendar-day other-month"></div>';
  }
  
  calendarHTML += '</div>';
  habitCalendar.innerHTML = calendarHTML;
}

// ìŠµê´€ì´ íŠ¹ì • ë‚ ì§œì— ì˜ˆì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
function isHabitScheduledForDate(habit, date) {
  const dayOfWeek = date.getDay(); // 0(ì¼) ~ 6(í† )
  
  switch (habit.frequency) {
    case 'daily':
      return true;
    case 'weekly':
      return habit.weekDays.includes(dayOfWeek);
    case 'monthly':
      // ë§¤ì›” ê°™ì€ ë‚ ì§œì— ìŠµê´€ ì²´í¬
      const habitStartDate = new Date(habit.createdAt);
      return date.getDate() === habitStartDate.getDate();
    default:
      return false;
  }
}

// ìŠµê´€ì´ íŠ¹ì • ë‚ ì§œì— ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
function isHabitCompletedOnDate(habitId, dateStr) {
  return habitRecords.some(record => 
    record.habitId === habitId && 
    record.date === dateStr && 
    record.completed
  );
}

// ìŠµê´€ ì¹´í…Œê³ ë¦¬ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
function getHabitCategoryName(category) {
  const categories = {
    'health': 'ê±´ê°•',
    'study': 'ê³µë¶€',
    'selfcare': 'ìê¸°ê´€ë¦¬',
    'work': 'ì—…ë¬´',
    'custom': 'ì§ì ‘ ì…ë ¥'
  };
  
  return categories[category] || category;
}

// ì˜¤ëŠ˜ ìŠµê´€ ì²´í¬
function checkHabitToday(habitId) {
  const habit = habits.find(h => h.id === habitId);
  if (!habit) return;
  
  const today = new Date();
  const dateStr = today.toISOString().split('T')[0];
  
  // í•´ë‹¹ ìŠµê´€ì´ ì˜¤ëŠ˜ ì²´í¬ ê°€ëŠ¥í•œì§€ í™•ì¸
  if (!isHabitScheduledForDate(habit, today)) {
    alert('ì˜¤ëŠ˜ì€ ì´ ìŠµê´€ì˜ ì²´í¬ ë‚ ì§œê°€ ì•„ë‹™ë‹ˆë‹¤.');
    return;
  }
  
  // ì´ë¯¸ ì²´í¬í•œ ê²½ìš°
  const existingRecord = habitRecords.find(r => 
    r.habitId === habitId && r.date === dateStr
  );
  
  if (existingRecord) {
    // í† ê¸€: ì²´í¬ë˜ì–´ ìˆìœ¼ë©´ ì²´í¬ í•´ì œ, ì•„ë‹ˆë©´ ì²´í¬
    existingRecord.completed = !existingRecord.completed;
    
    if (existingRecord.completed) {
      alert('ì˜¤ëŠ˜ì˜ ìŠµê´€ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ğŸ‘');
    } else {
      alert('ìŠµê´€ ì²´í¬ê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
  } else {
    // ìƒˆë¡œìš´ ê¸°ë¡ ì¶”ê°€
    const newRecord = {
      habitId,
      date: dateStr,
      completed: true
    };
    
    habitRecords.push(newRecord);
    alert('ì˜¤ëŠ˜ì˜ ìŠµê´€ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ğŸ‘');
  }
  
  // ì—°ì† ë‹¬ì„± ì¼ìˆ˜ ì—…ë°ì´íŠ¸
  updateHabitStreak(habit);
  
  // ì €ì¥ ë° ì—…ë°ì´íŠ¸
  saveHabits();
  renderHabits();
  renderHabitCalendar();
}

// ìŠµê´€ ì—°ì† ë‹¬ì„± ì¼ìˆ˜ ê³„ì‚°
function calculateHabitStreak(habit) {
  // ì—­ìˆœìœ¼ë¡œ ë‚ ì§œ í™•ì¸ (ì˜¤ëŠ˜ë¶€í„° ê³¼ê±°ë¡œ)
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  
  let streak = 0;
  let date = new Date(today);
  
  // ìµœëŒ€ 365ì¼ê¹Œì§€ë§Œ ì²´í¬ (ë¬´í•œ ë£¨í”„ ë°©ì§€)
  for (let i = 0; i < 365; i++) {
    const dateStr = date.toISOString().split('T')[0];
    
    // í•´ë‹¹ ë‚ ì§œì— ìŠµê´€ ì²´í¬ê°€ ì˜ˆì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
    if (isHabitScheduledForDate(habit, date)) {
      // ìŠµê´€ì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
      const completed = isHabitCompletedOnDate(habit.id, dateStr);
      
      if (completed) {
        streak++;
      } else {
        // ì™„ë£Œë˜ì§€ ì•Šì€ ë‚ ì§œê°€ ìˆìœ¼ë©´ ì¤‘ë‹¨
        break;
      }
    }
    
    // ì´ì „ ë‚ ì§œë¡œ ì´ë™
    date.setDate(date.getDate() - 1);
  }
  
  return streak;
}

// ìŠµê´€ ì—°ì† ë‹¬ì„± ì¼ìˆ˜ ì—…ë°ì´íŠ¸
function updateHabitStreak(habit) {
  const habitIndex = habits.findIndex(h => h.id === habit.id);
  if (habitIndex === -1) return;
  
  const streak = calculateHabitStreak(habit);
  habits[habitIndex].streak = streak;
}

// ìŠµê´€ ê¸°ë¡ ë³´ê¸°
function viewHabitHistory(habitId) {
  const habit = habits.find(h => h.id === habitId);
  if (!habit) return;
  
  // í•´ë‹¹ ìŠµê´€ì˜ ëª¨ë“  ê¸°ë¡ ê°€ì ¸ì˜¤ê¸°
  const records = habitRecords.filter(r => r.habitId === habitId);
  
  // ë‚ ì§œìˆœ ì •ë ¬
  records.sort((a, b) => new Date(b.date) - new Date(a.date));
  
  // í…Œì´ë¸” í˜•íƒœë¡œ í‘œì‹œ
  let historyHtml = `
    <h3>${habit.title} ê¸°ë¡</h3>
    <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
      <thead>
        <tr style="background-color: #f0f0f0;">
          <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">ë‚ ì§œ</th>
          <th style="padding: 8px; border: 1px solid #ddd; text-align: left;">ì™„ë£Œ ì—¬ë¶€</th>
        </tr>
      </thead>
      <tbody>
  `;
  
  if (records.length === 0) {
    historyHtml += `
      <tr>
        <td colspan="2" style="padding: 8px; border: 1px solid #ddd; text-align: center;">
          ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.
        </td>
      </tr>
    `;
  } else {
    records.forEach(record => {
      historyHtml += `
        <tr>
          <td style="padding: 8px; border: 1px solid #ddd;">${formatDate(record.date)}</td>
          <td style="padding: 8px; border: 1px solid #ddd;">
            ${record.completed ? 
              '<span style="color: #4CAF50; font-weight: bold;">âœ“ ì™„ë£Œ</span>' : 
              '<span style="color: #e74c3c;">âœ— ë¯¸ì™„ë£Œ</span>'}
          </td>
        </tr>
      `;
    });
  }
  
  historyHtml += `
      </tbody>
    </table>
  `;
  
  alert(historyHtml);
}

// ìŠµê´€ ì‚­ì œ
function deleteHabit(habitId) {
  if (!confirm('ì´ ìŠµê´€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  
  // ìŠµê´€ ì‚­ì œ
  habits = habits.filter(h => h.id !== habitId);
  
  // ê´€ë ¨ ê¸°ë¡ë„ í•¨ê»˜ ì‚­ì œ
  habitRecords = habitRecords.filter(r => r.habitId !== habitId);
  
  // ì €ì¥ ë° ì—…ë°ì´íŠ¸
  saveHabits();
  renderHabits();
  renderHabitCalendar();
  
  alert('ìŠµê´€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
}

// ìŠµê´€ ë‹¬ë ¥: ì´ì „ë‹¬/ë‹¤ìŒë‹¬ ì´ë™ í•¨ìˆ˜
function prevHabitMonth() {
  currentHabitMonth--;
  if (currentHabitMonth < 0) {
    currentHabitMonth = 11;
    currentHabitYear--;
  }
  renderHabitCalendar();
}

function nextHabitMonth() {
  currentHabitMonth++;
  if (currentHabitMonth > 11) {
    currentHabitMonth = 0;
    currentHabitYear++;
  }
  renderHabitCalendar();
}

// ê¸°ì¡´ loadInitialData í•¨ìˆ˜ ìˆ˜ì • (ìƒˆë¡œìš´ íƒ­ ì´ˆê¸°í™” ë° ë°ì´í„° ë¡œë“œ)
function loadInitialData() {
  // ê¸°ì¡´ ì½”ë“œ ìœ ì§€
  document.getElementById("ab-submit")?.addEventListener("click", addAccountItem);
  document.getElementById("addScheduleBtn")?.addEventListener("click", addSchedule);

  // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¡œë“œ
  loadDataFromLocalStorage();
  
  loadDiaries();
  loadMemos();
  renderTodos();
  renderTodoCalendar();
  renderWeightCalendar();
  renderWeightList();
  loadSchedules();
  renderScheduleCalendar();
  loadAccountData(); // ê°€ê³„ë¶€ ë°ì´í„° ë¡œë“œ
  
  // ìƒˆë¡œìš´ ê¸°ëŠ¥ ë°ì´í„° ë¡œë“œ
  loadGoals();
  loadHabits();
  
  applyCustomHome();
  
  // ê¸°ë³¸ ë‚ ì§œ ì„¤ì • - ëª¨ë“  ë‚ ì§œ ì…ë ¥ í•„ë“œì— ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
  const today = new Date().toISOString().split('T')[0];
  if (document.getElementById('diaryDate')) document.getElementById('diaryDate').value = today;
  if (document.getElementById('weightDate')) document.getElementById('weightDate').value = today;
  if (document.getElementById('eventDate')) document.getElementById('eventDate').value = today;
  if (document.getElementById('ab-date')) document.getElementById('ab-date').value = today;
  if (document.getElementById('todoDate')) document.getElementById('todoDate').value = today;
  if (document.getElementById('goalStartDate')) document.getElementById('goalStartDate').value = today;
  if (document.getElementById('goalEndDate')) {
    // ëª©í‘œì¼ì€ ê¸°ë³¸ì ìœ¼ë¡œ í•œ ë‹¬ ë’¤ë¡œ ì„¤ì •
    const endDate = new Date();
    endDate.setMonth(endDate.getMonth() + 1);
    document.getElementById('goalEndDate').value = endDate.toISOString().split('T')[0];
  }
  if (document.getElementById('goalUpdateDate')) document.getElementById('goalUpdateDate').value = today;
  
  // ìŠµê´€ ë¹ˆë„ ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
  const habitFrequency = document.getElementById('habitFrequency');
  const weekDaysContainer = document.getElementById('habitWeekDaysContainer');
  
  if (habitFrequency && weekDaysContainer) {
    habitFrequency.addEventListener('change', function() {
      if (this.value === 'weekly') {
        weekDaysContainer.style.display = 'block';
      } else {
        weekDaysContainer.style.display = 'none';
      }
    });
  }

  // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
  document.getElementById('save-button')?.addEventListener('click', saveCustomHome);
  document.getElementById('addScheduleBtn')?.addEventListener('click', addSchedule);
  document.getElementById('viewListBtn')?.addEventListener('click', showListView);
  document.getElementById('viewCalendarBtn')?.addEventListener('click', showCalendarView);
  document.getElementById('prevMonthBtn')?.addEventListener('click', prevScheduleMonth);
  document.getElementById('nextMonthBtn')?.addEventListener('click', nextScheduleMonth);
  
  // ê°€ê³„ë¶€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
  if (document.getElementById('ab-submit')) {
    document.getElementById('ab-submit').addEventListener('click', addAccountItem);
  }
  
  // í•„ìš”í•œ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ
  loadRequiredLibraries();
}

// íƒ­ ì „í™˜ í•¨ìˆ˜ ì—…ë°ì´íŠ¸
function showTab(tabId) {
  // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
  document.querySelectorAll('.tab-content').forEach(tab => {
    tab.classList.remove('active');
  });
  document.querySelectorAll('.nav-link').forEach(link => {
    link.classList.remove('active');
  });
  
  // ì„ íƒëœ íƒ­ í™œì„±í™”
  document.getElementById(tabId).classList.add('active');
  document.querySelector(`.nav-link[onclick="showTab('${tabId}')"]`).classList.add('active');
  
  // í•„ìš”í•œ ê²½ìš° íƒ­ ì´ˆê¸°í™”
  if (tabId === 'diary') loadDiaries();
  if (tabId === 'memo') loadMemos();
  if (tabId === 'todo') {
    renderTodos();
    renderTodoCalendar();
  }
  if (tabId === 'weight') {
    renderWeightCalendar();
    renderWeightList();
  }
  if (tabId === 'schedule') {
    loadSchedules();
    renderScheduleCalendar();

    // ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ ìˆ˜ë™ ì¬ë“±ë¡
    const calBtn = document.getElementById('viewCalendarBtn');
    const listBtn = document.getElementById('viewListBtn');
    if (calBtn) {
      calBtn.removeEventListener('click', showCalendarView);
      calBtn.addEventListener('click', showCalendarView);
    }
    if (listBtn) {
      listBtn.removeEventListener('click', showListView);
      listBtn.addEventListener('click', showListView);
    }
  }
  if (tabId === 'accountbook') {
    loadAccountData();
    
    // ë‹¬ë ¥ì´ í‘œì‹œë˜ì§€ ì•ŠëŠ” ë¬¸ì œ í•´ê²°
    setTimeout(function() {
      try {
        const abCalendar = document.getElementById('ab-calendar');
        if (abCalendar) {
          // ë‹¬ë ¥ì´ ì œëŒ€ë¡œ ë Œë”ë§ë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸
          const fcContent = abCalendar.querySelector('.fc');
          if (!fcContent || fcContent.offsetHeight < 10) {
            console.log("ë‹¬ë ¥ ë‹¤ì‹œ ì´ˆê¸°í™” ì¤‘...");
            initializeAccountCalendar();
          }
        }
      } catch (e) {
        console.error("ë‹¬ë ¥ í™•ì¸ ì˜¤ë¥˜:", e);
        initializeAccountCalendar();
      }
    }, 300);
  }
  
  // ìƒˆë¡œìš´ íƒ­ ì²˜ë¦¬
  if (tabId === 'goals') {
    renderGoals();
  }
  if (tabId === 'habits') {
    renderHabits();
    renderHabitCalendar();
  }
}

// ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë¡œë“œ í•¨ìˆ˜ ì—…ë°ì´íŠ¸
function loadDataFromLocalStorage() {
  try {
    diaries = JSON.parse(localStorage.getItem('diaries')) || [];
    memos = JSON.parse(localStorage.getItem('memos')) || [];
    todos = JSON.parse(localStorage.getItem('todos')) || [];
    schedules = JSON.parse(localStorage.getItem('schedules')) || [];
    accountData = JSON.parse(localStorage.getItem('accountData')) || []; // ê°€ê³„ë¶€ ë°ì´í„° ì¶”ê°€
    
    // ìƒˆë¡œìš´ ë°ì´í„° ì¶”ê°€
    goals = JSON.parse(localStorage.getItem('goals')) || [];
    goalProgress = JSON.parse(localStorage.getItem('goalProgress')) || [];
    habits = JSON.parse(localStorage.getItem('habits')) || [];
    habitRecords = JSON.parse(localStorage.getItem('habitRecords')) || [];
  } catch (e) {
    console.error('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
    diaries = [];
    memos = [];
    todos = [];
    schedules = [];
    accountData = [];
    goals = [];
    goalProgress = [];
    habits = [];
    habitRecords = [];
  }
}
// ===== 1. ëª©í‘œ ê´€ë ¨ í•¨ìˆ˜ ì—…ë°ì´íŠ¸ =====
let goalSubTasks = []; // ëª©í‘œ ì„¸ë¶€ í•­ëª©ì„ ì €ì¥í•  ë°°ì—´ ì¶”ê°€

// ëª©í‘œ ì¶”ê°€ í•¨ìˆ˜ ì—…ë°ì´íŠ¸
function addGoal() {
  const title = document.getElementById('goalTitle').value.trim();
  const category = document.getElementById('goalCategory').value;
  const customCategory = document.getElementById('goalCustomCategory')?.value.trim();
  const startValue = parseFloat(document.getElementById('goalStartValue').value);
  const targetValue = parseFloat(document.getElementById('goalTargetValue').value);
  const unit = document.getElementById('goalUnit').value.trim();
  const startDate = document.getElementById('goalStartDate').value;
  const endDate = document.getElementById('goalEndDate').value;
  const description = document.getElementById('goalDescription').value.trim();
  
  // ê¸°ë³¸ ìœ íš¨ì„± ê²€ì‚¬
  if (!title) {
    alert('ëª©í‘œ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  if (isNaN(startValue) || isNaN(targetValue)) {
    alert('ì‹œì‘ ê°’ê³¼ ëª©í‘œ ê°’ì€ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  if (!startDate || !endDate) {
    alert('ì‹œì‘ì¼ê³¼ ëª©í‘œì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  // ë‚ ì§œ ìœ íš¨ì„± ê²€ì‚¬
  if (new Date(endDate) <= new Date(startDate)) {
    alert('ëª©í‘œì¼ì€ ì‹œì‘ì¼ë³´ë‹¤ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤.');
    return;
  }
  
  // ì‹¤ì œ ì‚¬ìš©í•  ì¹´í…Œê³ ë¦¬ (ì§ì ‘ ì…ë ¥ ì„ íƒ ì‹œ customCategory ì‚¬ìš©)
  const finalCategory = category === 'custom' ? customCategory : category;
  
  // ëª©í‘œ ìƒì„±
  const goal = {
    id: Date.now(),
    title,
    category: finalCategory,
    startValue,
    targetValue,
    currentValue: startValue, // ì´ˆê¸°ê°’ì€ ì‹œì‘ê°’ê³¼ ë™ì¼
    unit,
    startDate,
    endDate,
    description,
    createdAt: new Date().toISOString(),
    hasSubTasks: false // ì„¸ë¶€ í•­ëª© ì‚¬ìš© ì—¬ë¶€
  };
  
  // ëª©í‘œ ì§„í–‰ ê¸°ë¡ ì´ˆê¸° í•­ëª© ì¶”ê°€
  const initialProgress = {
    goalId: goal.id,
    date: startDate,
    value: startValue
  };
  
  // ë°ì´í„° ì €ì¥
  goals.push(goal);
  goalProgress.push(initialProgress);
  
  saveGoals();
  
  // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
  document.getElementById('goalTitle').value = '';
  document.getElementById('goalStartValue').value = '';
  document.getElementById('goalTargetValue').value = '';
  document.getElementById('goalUnit').value = '';
  document.getElementById('goalDescription').value = '';
  if (document.getElementById('goalCustomCategory')) {
    document.getElementById('goalCustomCategory').value = '';
  }
  
  // ëª©í‘œ ëª©ë¡ ë Œë”ë§
  renderGoals();
  alert('ìƒˆë¡œìš´ ëª©í‘œê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
}

// ëª©í‘œ ì €ì¥ í•¨ìˆ˜ ì—…ë°ì´íŠ¸
function saveGoals() {
  localStorage.setItem('goals', JSON.stringify(goals));
  localStorage.setItem('goalProgress', JSON.stringify(goalProgress));
  localStorage.setItem('goalSubTasks', JSON.stringify(goalSubTasks));
}

// ëª©í‘œ ë¡œë“œ í•¨ìˆ˜ ì—…ë°ì´íŠ¸
function loadGoals() {
  try {
    const savedGoals = localStorage.getItem('goals');
    const savedProgress = localStorage.getItem('goalProgress');
    const savedSubTasks = localStorage.getItem('goalSubTasks');
    
    if (savedGoals) goals = JSON.parse(savedGoals);
    if (savedProgress) goalProgress = JSON.parse(savedProgress);
    if (savedSubTasks) goalSubTasks = JSON.parse(savedSubTasks);
    
    renderGoals();
  } catch (e) {
    console.error('ëª©í‘œ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
    goals = [];
    goalProgress = [];
    goalSubTasks = [];
  }
}

// ëª©í‘œ ì§„í–‰ ìƒí™© ê³„ì‚° í•¨ìˆ˜ ì—…ë°ì´íŠ¸ (ì„¸ë¶€ í•­ëª© ë°˜ì˜)
function calculateGoalProgress(goal) {
  // ëª©í‘œì— ì„¸ë¶€ í•­ëª©ì´ ìˆëŠ”ì§€ í™•ì¸
  if (goal.hasSubTasks) {
    // ì„¸ë¶€ í•­ëª© ì§„í–‰ë¥ ë¡œ ê³„ì‚°
    const subTasks = goalSubTasks.filter(task => task.goalId === goal.id);
    
    if (subTasks.length === 0) return 0; // ì„¸ë¶€ í•­ëª©ì´ ì—†ìœ¼ë©´ 0% ì§„í–‰
    
    // ì™„ë£Œëœ ì„¸ë¶€ í•­ëª© ë¹„ìœ¨ ê³„ì‚°
    const completedTasks = subTasks.filter(task => task.completed);
    return Math.round((completedTasks.length / subTasks.length) * 100);
  } else {
    // ê¸°ì¡´ ë°©ì‹ (ì‹œì‘ ê°’ê³¼ ëª©í‘œ ê°’ ê¸°ë°˜)
    // ëª©í‘œê°€ ì¦ê°€ì¸ì§€ ê°ì†Œì¸ì§€ í™•ì¸
    const isIncreasing = goal.targetValue > goal.startValue;
    
    // ëª©í‘œ ê°’ê³¼ ì‹œì‘ ê°’ì˜ ì°¨ì´
    const totalDifference = Math.abs(goal.targetValue - goal.startValue);
    
    // í˜„ì¬ê¹Œì§€ ë‹¬ì„±í•œ ì°¨ì´
    const currentDifference = Math.abs(goal.currentValue - goal.startValue);
    
    // ì§„í–‰ ìƒí™© ê³„ì‚° (í¼ì„¼íŠ¸)
    let progress = (currentDifference / totalDifference) * 100;
    
    // ì´ë¯¸ ëª©í‘œë¥¼ ë‹¬ì„±í–ˆë‹¤ë©´ 100%ë¡œ ê³ ì •
    if (isIncreasing && goal.currentValue >= goal.targetValue) {
      progress = 100;
    } else if (!isIncreasing && goal.currentValue <= goal.targetValue) {
      progress = 100;
    }
    
    // ë²”ìœ„ ì œí•œ (0~100%)
    progress = Math.min(Math.max(progress, 0), 100);
    
    return Math.round(progress);
  }
}

// ëª©í‘œ ë Œë”ë§ í•¨ìˆ˜ ì—…ë°ì´íŠ¸ (ì„¸ë¶€ í•­ëª© í‘œì‹œ)
function renderGoals() {
  const goalsList = document.getElementById('goalsList');
  
  if (!goalsList) return;
  
  if (goals.length === 0) {
    goalsList.innerHTML = '<p class="no-goals" style="text-align: center; color: #888; padding: 20px;">ì•„ì§ ì„¤ì •ëœ ëª©í‘œê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ëª©í‘œë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>';
    return;
  }
  
  goalsList.innerHTML = '';
  
  // ëª©í‘œì¼ ê¸°ì¤€ ì •ë ¬ (ê°€ê¹Œìš´ ëª©í‘œ ë¨¼ì €)
  goals.sort((a, b) => new Date(a.endDate) - new Date(b.endDate));
  
  goals.forEach(goal => {
    // í˜„ì¬ ì§„í–‰ ìƒí™© ê³„ì‚°
    const progress = calculateGoalProgress(goal);
    
    // ë‚¨ì€ ì¼ìˆ˜ ê³„ì‚°
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    const endDate = new Date(goal.endDate);
    endDate.setHours(0, 0, 0, 0);
    
    const daysRemaining = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
    
    const goalItem = document.createElement('div');
    goalItem.className = 'goal-item';
    
    // ì¦ê°€/ê°ì†Œì— ë”°ë¥¸ ë°©í–¥ ë° í…ìŠ¤íŠ¸ ìƒ‰ìƒ
    const isIncreasing = goal.targetValue > goal.startValue;
    const directionText = isIncreasing ? 'ëŠ˜ë¦¬ê¸°' : 'ì¤„ì´ê¸°';
    const valueColor = isIncreasing ? 
                        (goal.currentValue >= goal.targetValue ? '#4CAF50' : '#333') : 
                        (goal.currentValue <= goal.targetValue ? '#4CAF50' : '#333');
    
    // ê¸°ë³¸ ëª©í‘œ ì •ë³´ í‘œì‹œ
    let goalHTML = `
      <div class="goal-header">
        <div class="goal-title">${goal.title}</div>
        <div class="goal-category">${goal.category}</div>
      </div>
      
      <div class="goal-info">
        <div class="goal-info-item">
          <div class="goal-info-label">ì‹œì‘ ê°’</div>
          <div class="goal-info-value">${goal.startValue} ${goal.unit}</div>
        </div>
        <div class="goal-info-item">
          <div class="goal-info-label">í˜„ì¬ ê°’</div>
          <div class="goal-info-value" style="color: ${valueColor}">
            ${goal.currentValue} ${goal.unit}
          </div>
        </div>
        <div class="goal-info-item">
          <div class="goal-info-label">ëª©í‘œ ê°’</div>
          <div class="goal-info-value">${goal.targetValue} ${goal.unit}</div>
        </div>
      </div>
      
      <div class="goal-info">
        <div class="goal-info-item">
          <div class="goal-info-label">ì‹œì‘ì¼</div>
          <div class="goal-info-value">${formatDate(goal.startDate)}</div>
        </div>
        <div class="goal-info-item">
          <div class="goal-info-label">ëª©í‘œì¼</div>
          <div class="goal-info-value">${formatDate(goal.endDate)}</div>
        </div>
        <div class="goal-info-item">
          <div class="goal-info-label">ë‚¨ì€ ê¸°ê°„</div>
          <div class="goal-info-value">
            ${daysRemaining <= 0 ? 'ê¸°ê°„ ì¢…ë£Œ' : `${daysRemaining}ì¼ ë‚¨ìŒ`}
          </div>
        </div>
      </div>
      
      <div class="goal-progress">
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
          <span>ì§„í–‰ ìƒí™©: ${progress}%</span>
          ${goal.hasSubTasks ? '<span>ì„¸ë¶€ í•­ëª© ê¸°ë°˜</span>' : `<span>${directionText}</span>`}
        </div>
        <div class="goal-progress-bar">
          <div class="goal-progress-fill" style="width: ${progress}%;"></div>
        </div>
      </div>
      
      ${goal.description ? `<div style="margin-bottom: 15px; color: #666;">${goal.description}</div>` : ''}
    `;
    
    // ì„¸ë¶€ í•­ëª© í‘œì‹œ (ìˆëŠ” ê²½ìš°)
if (goal.hasSubTasks) {
  const subTasks = goalSubTasks.filter(task => task.goalId === goal.id);
  
  goalHTML += `<div class="goal-subtasks" style="margin: 15px 0;">
    <h4 style="margin-bottom: 10px;">ì„¸ë¶€ í•­ëª©</h4>`;
  
  if (subTasks.length > 0) {
    goalHTML += `<ul style="padding-left: 20px;">`;
    
    subTasks.forEach(task => {
      goalHTML += `
        <li style="margin-bottom: 8px;">
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <label style="display: flex; align-items: center; flex-grow: 1;">
              <input type="checkbox" ${task.completed ? 'checked' : ''} 
                     onchange="toggleSubTask(${goal.id}, ${task.id})" 
                     style="margin-right: 8px;">
              <span ${task.completed ? 'style="text-decoration: line-through; color: #888;"' : ''}>
                ${task.title}
              </span>
            </label>
            <div style="margin-left: 10px;">
              <button onclick="editSubTask(${goal.id}, ${task.id})" 
                      style="background-color: #5f7561; font-size: 0.8rem; padding: 3px 8px; margin-right: 5px;">
                ìˆ˜ì •
              </button>
              <button onclick="deleteSubTask(${goal.id}, ${task.id})" 
                      style="background-color: #e74c3c; font-size: 0.8rem; padding: 3px 8px;">
                ì‚­ì œ
              </button>
            </div>
          </div>
        </li>`;
    });
    
    goalHTML += `</ul>`;
  } else {
    goalHTML += `<p style="color: #888; font-style: italic; margin-left: 10px;">í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤. 'í•­ëª© ì¶”ê°€' ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì„¸ë¶€ í•­ëª©ì„ ì¶”ê°€í•˜ì„¸ìš”.</p>`;
  }
  
  goalHTML += `
    <button onclick="showAddSubTaskForm(${goal.id})" 
            style="margin-top: 10px; background-color: #8fa88e; font-size: 0.9rem; padding: 5px 10px;">
      í•­ëª© ì¶”ê°€
    </button>
  </div>`;
}
    
    // ëª©í‘œ ì¡°ì‘ ë²„íŠ¼
    goalHTML += `
      <div class="goal-controls">
        ${!goal.hasSubTasks ? `<button onclick="showGoalUpdateForm(${goal.id})">ì—…ë°ì´íŠ¸</button>` : ''}
        <button onclick="toggleSubTasks(${goal.id})">${goal.hasSubTasks ? 'ì„¸ë¶€í•­ëª© ì‚¬ìš© ì¤‘ì§€' : 'ì„¸ë¶€í•­ëª© ì‚¬ìš©'}</button>
        <button onclick="viewGoalHistory(${goal.id})">ê¸°ë¡ ë³´ê¸°</button>
        <button class="delete-btn" onclick="deleteGoal(${goal.id})">ì‚­ì œ</button>
      </div>
    `;
    
    goalItem.innerHTML = goalHTML;
    goalsList.appendChild(goalItem);
  });
  
// ì„¸ë¶€ í•­ëª© ì¶”ê°€/ìˆ˜ì • í¼ (ë™ì ìœ¼ë¡œ ì¶”ê°€)
const subTaskForm = document.getElementById('subTaskForm');
if (!subTaskForm) {
  const form = document.createElement('div');
  form.id = 'subTaskForm';
  form.style.display = 'none';
  form.style.background = '#d7d5cb';
  form.style.padding = '15px';
  form.style.borderRadius = '8px';
  form.style.margin = '20px 0';
  form.innerHTML = `
    <h3 id="subTaskFormTitle" style="margin-top: 0;">ì„¸ë¶€ í•­ëª© ì¶”ê°€</h3>
    <div style="margin-bottom: 15px;">
      <label for="subTaskTitle">í•­ëª© ì´ë¦„</label>
      <input id="subTaskTitle" type="text" style="width: 100%; margin-top: 5px; padding: 8px; border-radius: 5px; border: 1px solid #ccc;">
    </div>
    <input id="subTaskGoalId" type="hidden">
    <input id="subTaskId" type="hidden">
    <div style="text-align: right;">
      <button id="subTaskFormButton" onclick="addSubTask()">ì¶”ê°€</button>
      <button onclick="closeSubTaskForm()" style="background-color: #95a5a6;">ì·¨ì†Œ</button>
    </div>
  `;    
    const goalsList = document.getElementById('goalsList');
    if (goalsList) {
      goalsList.parentNode.insertBefore(form, goalsList.nextSibling);
    }
  }
}

// ì„¸ë¶€ í•­ëª© ê´€ë ¨ í•¨ìˆ˜ë“¤
function toggleSubTasks(goalId) {
  const goalIndex = goals.findIndex(g => g.id === goalId);
  if (goalIndex === -1) return;
  
  // ì„¸ë¶€ í•­ëª© ì‚¬ìš© ìƒíƒœ í† ê¸€
  goals[goalIndex].hasSubTasks = !goals[goalIndex].hasSubTasks;
  
  // ì²˜ìŒ ì„¸ë¶€ í•­ëª©ì„ í™œì„±í™”í•˜ëŠ” ê²½ìš°, ì˜ˆì œ í•­ëª© ì¶”ê°€
  if (goals[goalIndex].hasSubTasks && !goalSubTasks.some(task => task.goalId === goalId)) {
    // ì˜ˆì œ ì„¸ë¶€ í•­ëª© 3ê°œ ì¶”ê°€
    addDefaultSubTasks(goalId);
  }
  
  saveGoals();
  renderGoals();
}

// ê¸°ë³¸ ì„¸ë¶€ í•­ëª© ì¶”ê°€ í•¨ìˆ˜ ìˆ˜ì • - ê¸°ë³¸ í•­ëª© ì¶”ê°€í•˜ì§€ ì•ŠìŒ
function addDefaultSubTasks(goalId) {
  // ì‚¬ìš©ìê°€ ì§ì ‘ í•­ëª© ì¶”ê°€í•  ìˆ˜ ìˆë„ë¡ ë¹„ì›Œë‘ê¸°
  // ê¸°ë³¸ í•­ëª© ì—†ìŒ
}
// ì„¸ë¶€ í•­ëª© ì¶”ê°€ í¼ í‘œì‹œ
function showAddSubTaskForm(goalId) {
  const form = document.getElementById('subTaskForm');
  if (!form) return;
  
  document.getElementById('subTaskTitle').value = '';
  document.getElementById('subTaskGoalId').value = goalId;
  document.getElementById('subTaskId').value = ''; // ìƒˆ í•­ëª© ì¶”ê°€ ì‹œì—ëŠ” ID ë¹„ì›€
  
  // ì œëª©ê³¼ ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
  document.getElementById('subTaskFormTitle').textContent = 'ì„¸ë¶€ í•­ëª© ì¶”ê°€';
  document.getElementById('subTaskFormButton').textContent = 'ì¶”ê°€';
  
  form.style.display = 'block';
  form.scrollIntoView({ behavior: 'smooth' });
}
// ì„¸ë¶€ í•­ëª© ì¶”ê°€ í¼ ë‹«ê¸°
function closeSubTaskForm() {
  const form = document.getElementById('subTaskForm');
  if (form) form.style.display = 'none';
}

// ì„¸ë¶€ í•­ëª© ì¶”ê°€ í•¨ìˆ˜ ìˆ˜ì • - ì¶”ê°€ì™€ ìˆ˜ì • ëª¨ë‘ ì²˜ë¦¬
function addSubTask() {
  const title = document.getElementById('subTaskTitle').value.trim();
  const goalId = parseInt(document.getElementById('subTaskGoalId').value);
  const taskId = document.getElementById('subTaskId').value; // ìˆ˜ì • ì‹œ ì‚¬ìš©
  
  if (!title) {
    alert('í•­ëª© ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  // ìˆ˜ì • ëª¨ë“œì¸ ê²½ìš°
  if (taskId) {
    const taskIndex = goalSubTasks.findIndex(t => t.id === parseInt(taskId));
    if (taskIndex !== -1) {
      goalSubTasks[taskIndex].title = title;
      
      saveGoals();
      renderGoals();
      closeSubTaskForm();
      return;
    }
  }
  
  // ìƒˆ í•­ëª© ì¶”ê°€
  const subTask = {
    id: Date.now(),
    goalId: goalId,
    title: title,
    completed: false,
    createdAt: new Date().toISOString()
  };
  
  goalSubTasks.push(subTask);
  saveGoals();
  renderGoals();
  closeSubTaskForm();
}
// ì„¸ë¶€ í•­ëª© í† ê¸€ (ì™„ë£Œ/ë¯¸ì™„ë£Œ)
function toggleSubTask(goalId, taskId) {
  const taskIndex = goalSubTasks.findIndex(t => t.id === taskId);
  if (taskIndex === -1) return;
  
  // ìƒíƒœ í† ê¸€
  goalSubTasks[taskIndex].completed = !goalSubTasks[taskIndex].completed;
  
  saveGoals();
  renderGoals();
}

// ===== 2. ìŠµê´€ ê´€ë ¨ í•¨ìˆ˜ ì—…ë°ì´íŠ¸ =====

// ìŠµê´€ ì¶”ê°€ í•¨ìˆ˜ ì—…ë°ì´íŠ¸
function addHabit() {
  const title = document.getElementById('habitTitle').value.trim();
  const category = document.getElementById('habitCategory').value;
  const customCategory = document.getElementById('habitCustomCategory')?.value.trim();
  const frequency = document.getElementById('habitFrequency').value;
  const description = document.getElementById('habitDescription').value.trim();
  
  if (!title) {
    alert('ìŠµê´€ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  // ì‹¤ì œ ì‚¬ìš©í•  ì¹´í…Œê³ ë¦¬ (ì§ì ‘ ì…ë ¥ ì„ íƒ ì‹œ customCategory ì‚¬ìš©)
  const finalCategory = category === 'custom' ? customCategory : category;
  
  // ì£¼ê°„ ìŠµê´€ì¸ ê²½ìš° ì„ íƒí•œ ìš”ì¼ ë˜ëŠ” ì£¼ 5ì¼(ì›”-ê¸ˆ) ì˜µì…˜ ì²˜ë¦¬
  let weekDays = [];
  if (frequency === 'weekly') {
    const weekdayOption = document.querySelector('input[name="weekdayOption"]:checked')?.value;
    
    if (weekdayOption === 'weekdays') {
      // ì£¼ 5ì¼(ì›”-ê¸ˆ) ì„ íƒ
      weekDays = [1, 2, 3, 4, 5]; // ì›”í™”ìˆ˜ëª©ê¸ˆ (1-5)
    } else if (weekdayOption === 'custom') {
      // ì§ì ‘ ì„ íƒ
      const checkboxes = document.querySelectorAll('.habitWeekDay:checked');
      weekDays = Array.from(checkboxes).map(cb => parseInt(cb.value));
      
      if (weekDays.length === 0) {
        alert('í•˜ë‚˜ ì´ìƒì˜ ìš”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
    }
  }
  
  const habit = {
    id: Date.now(),
    title,
    category: finalCategory,
    frequency,
    weekDays, // ì£¼ê°„ì¸ ê²½ìš°ë§Œ ì‚¬ìš©ë¨
    description,
    createdAt: new Date().toISOString(),
    streak: 0, // ì´ˆê¸° ì—°ì† ê¸°ë¡ì€ 0
    color: getRandomHabitColor() // ëœë¤ ìƒ‰ìƒ ì§€ì •
  };
  
  habits.push(habit);
  saveHabits();
  
  // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
  document.getElementById('habitTitle').value = '';
  document.getElementById('habitCategory').value = 'health';
  if (document.getElementById('habitCustomCategory')) {
    document.getElementById('habitCustomCategory').value = '';
    document.getElementById('habitCustomCategory').style.display = 'none';
  }
  document.getElementById('habitFrequency').value = 'daily';
  document.getElementById('habitWeekDaysContainer').style.display = 'none';
  document.querySelectorAll('.habitWeekDay').forEach(cb => cb.checked = false);
  document.getElementById('habitDescription').value = '';
  
  // ìŠµê´€ ëª©ë¡ ë° ë‹¬ë ¥ ë Œë”ë§
  renderHabits();
  renderHabitCalendar();
  
  alert('ìƒˆë¡œìš´ ìŠµê´€ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
}

// ìŠµê´€ì´ íŠ¹ì • ë‚ ì§œì— ì˜ˆì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜ ì—…ë°ì´íŠ¸
function isHabitScheduledForDate(habit, date) {
  const dayOfWeek = date.getDay(); // 0(ì¼) ~ 6(í† )
  
  switch (habit.frequency) {
    case 'daily':
      return true;
    case 'weekly':
      return habit.weekDays.includes(dayOfWeek);
    case 'monthly':
      // ë§¤ì›” ê°™ì€ ë‚ ì§œì— ìŠµê´€ ì²´í¬
      const habitStartDate = new Date(habit.createdAt);
      return date.getDate() === habitStartDate.getDate();
    default:
      return false;
  }
}

// ìŠµê´€ ë Œë”ë§ í•¨ìˆ˜ ì—…ë°ì´íŠ¸ (ì¹´í…Œê³ ë¦¬ ì§ì ‘ ì…ë ¥ í‘œì‹œ)
function renderHabits() {
  const habitsList = document.getElementById('habitsList');
  
  if (!habitsList) return;
  
  if (habits.length === 0) {
    habitsList.innerHTML = '<p class="no-habits" style="text-align: center; color: #888; padding: 20px;">ì•„ì§ ì¶”ê°€ëœ ìŠµê´€ì´ ì—†ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ìŠµê´€ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>';
    return;
  }
  
  habitsList.innerHTML = '';
  
  // ìƒì„±ì¼ ê¸°ì¤€ ì •ë ¬ (ìµœì‹  ìˆœ)
  habits.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
  
  habits.forEach(habit => {
    const habitItem = document.createElement('div');
    habitItem.className = 'habit-list-item';
    
    // ìŠµê´€ ë¹ˆë„ í…ìŠ¤íŠ¸
    let frequencyText = 'ë§¤ì¼';
    if (habit.frequency === 'weekly') {
      const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
      
      // ì£¼ 5ì¼(ì›”-ê¸ˆ) ì—¬ë¶€ í™•ì¸
      if (JSON.stringify(habit.weekDays.sort()) === JSON.stringify([1, 2, 3, 4, 5])) {
        frequencyText = 'ì£¼ 5ì¼ (ì›”-ê¸ˆ)';
      } else {
        const selectedDays = habit.weekDays.map(day => days[day]).join(', ');
        frequencyText = `ë§¤ì£¼ ${selectedDays}ìš”ì¼`;
      }
    } else if (habit.frequency === 'monthly') {
      frequencyText = 'ë§¤ì›”';
    }
    
    // ì—°ì† ë‹¬ì„± ì¼ìˆ˜ ê³„ì‚°
    const streak = calculateHabitStreak(habit);
    
    habitItem.innerHTML = `
      <div class="habit-list-header">
        <div class="habit-list-title">${habit.title}</div>
        <div class="habit-list-category">${habit.category}</div>
      </div>
      
      <div>${frequencyText}</div>
      ${habit.description ? `<div style="margin-top: 8px; color: #666;">${habit.description}</div>` : ''}
      
      <div class="habit-streak">
        <span class="habit-streak-number">${streak}</span> ì¼ ì—°ì† ë‹¬ì„± ì¤‘
      </div>
      
      <div class="habit-list-controls">
        <button onclick="checkHabitToday(${habit.id})">ì˜¤ëŠ˜ ì²´í¬</button>
        <button onclick="viewHabitHistory(${habit.id})">ê¸°ë¡ ë³´ê¸°</button>
        <button class="delete-btn" onclick="deleteHabit(${habit.id})">ì‚­ì œ</button>
      </div>
    `;
    
    habitsList.appendChild(habitItem);
  });
}

// ===== 3. í†µí•© ê²€ìƒ‰ í•¨ìˆ˜ ì—…ë°ì´íŠ¸ =====
function performSearch() {
  const searchInput = document.getElementById('searchInput');
  const searchType = document.getElementById('searchType');
  const searchResults = document.getElementById('searchResults');
  
  const query = searchInput.value.trim().toLowerCase();
  const type = searchType.value;
  
  if (!query) {
    alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  searchResults.innerHTML = '<p>ê²€ìƒ‰ ì¤‘...</p>';
  
  // ê²€ìƒ‰ ê²°ê³¼ ë°°ì—´
  let results = [];
  
  // ê²€ìƒ‰ ìœ í˜•ì— ë”°ë¼ ë‹¤ë¥¸ ë°ì´í„° ì†ŒìŠ¤ ê²€ìƒ‰
  if (type === 'all' || type === 'diary') {
    results = results.concat(searchDiaries(query));
  }
  
  if (type === 'all' || type === 'memo') {
    results = results.concat(searchMemos(query));
  }
  
  if (type === 'all' || type === 'todo') {
    results = results.concat(searchTodos(query));
  }
  
  if (type === 'all' || type === 'schedule') {
    results = results.concat(searchSchedules(query));
  }
  
  if (type === 'all' || type === 'accountbook') {
    results = results.concat(searchAccountbook(query));
  }
  
  // ì¶”ê°€: ëª©í‘œì™€ ìŠµê´€ ê²€ìƒ‰ (ì „ì²´ ê²€ìƒ‰ ì‹œ í¬í•¨)
  if (type === 'all' || type === 'goals') {
    results = results.concat(searchGoals(query));
  }
  
  if (type === 'all' || type === 'habits') {
    results = results.concat(searchHabits(query));
  }
  
  // ìµœì‹  í•­ëª©ìˆœìœ¼ë¡œ ì •ë ¬
  results.sort((a, b) => new Date(b.date) - new Date(a.date));
  
  // ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ
  renderSearchResults(results, query);
}

// ëª©í‘œ ê²€ìƒ‰ í•¨ìˆ˜ ì¶”ê°€
function searchGoals(query) {
  const results = [];
  
  goals.forEach(goal => {
    if (goal.title.toLowerCase().includes(query) || 
        goal.description?.toLowerCase().includes(query) ||
        goal.category.toLowerCase().includes(query)) {
      results.push({
        id: goal.id,
        type: 'goals',
        title: goal.title,
        content: `ëª©í‘œ: ${goal.startValue} ${goal.unit} â†’ ${goal.targetValue} ${goal.unit}, ${goal.description || ''}`,
        date: goal.createdAt,
        originalDate: goal.startDate
      });
    }
    
    // ì„¸ë¶€ í•­ëª© ê²€ìƒ‰
    const subTasks = goalSubTasks.filter(task => task.goalId === goal.id);
    
    subTasks.forEach(task => {
      if (task.title.toLowerCase().includes(query)) {
        results.push({
          id: goal.id,
          type: 'goals',
          title: `${goal.title} (ì„¸ë¶€í•­ëª©: ${task.title})`,
          content: `ì„¸ë¶€í•­ëª©: ${task.title}, ìƒíƒœ: ${task.completed ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ'}`,
          date: task.createdAt,
          originalDate: goal.startDate
        });
      }
    });
  });
  
  return results;
}

// ìŠµê´€ ê²€ìƒ‰ í•¨ìˆ˜ ì¶”ê°€
function searchHabits(query) {
  const results = [];
  
  habits.forEach(habit => {
    if (habit.title.toLowerCase().includes(query) || 
        habit.description?.toLowerCase().includes(query) ||
        habit.category.toLowerCase().includes(query)) {
      
      // ìŠµê´€ ë¹ˆë„ í…ìŠ¤íŠ¸
      let frequencyText = 'ë§¤ì¼';
      if (habit.frequency === 'weekly') {
        const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
        
        // ì£¼ 5ì¼(ì›”-ê¸ˆ) ì—¬ë¶€ í™•ì¸
        if (JSON.stringify(habit.weekDays.sort()) === JSON.stringify([1, 2, 3, 4, 5])) {
          frequencyText = 'ì£¼ 5ì¼ (ì›”-ê¸ˆ)';
        } else {
          const selectedDays = habit.weekDays.map(day => days[day]).join(', ');
          frequencyText = `ë§¤ì£¼ ${selectedDays}ìš”ì¼`;
        }
      } else if (habit.frequency === 'monthly') {
        frequencyText = 'ë§¤ì›”';
      }
      
      results.push({
        id: habit.id,
        type: 'habits',
        title: habit.title,
        content: `ì¹´í…Œê³ ë¦¬: ${habit.category}, ë¹ˆë„: ${frequencyText}, ${habit.description || ''}`,
        date: habit.createdAt,
        originalDate: habit.createdAt
      });
    }
  });
  
  return results;
}

// ì¹´í…Œê³ ë¦¬ ì§ì ‘ ì…ë ¥ ë° ì£¼ 5ì¼ ì˜µì…˜ í† ê¸€ í•¨ìˆ˜
function toggleCategoryInput() {
  const category = document.getElementById('goalCategory');
  const customCategory = document.getElementById('goalCustomCategory');
  
  if (category.value === 'custom') {
    if (customCategory) {
      customCategory.style.display = 'block';
      customCategory.focus();
    }
  } else {
    if (customCategory) customCategory.style.display = 'none';
  }
}

function toggleHabitCategoryInput() {
  const category = document.getElementById('habitCategory');
  const customCategory = document.getElementById('habitCustomCategory');
  
  if (category.value === 'custom') {
    if (customCategory) {
      customCategory.style.display = 'block';
      customCategory.focus();
    }
  } else {
    if (customCategory) customCategory.style.display = 'none';
  }
}

function toggleWeekdayOptions() {
  const frequency = document.getElementById('habitFrequency');
  const weekdayOptionContainer = document.getElementById('weekdayOptionContainer');
  const customWeekdaysContainer = document.getElementById('customWeekdaysContainer');
  
  if (frequency.value === 'weekly') {
    if (weekdayOptionContainer) weekdayOptionContainer.style.display = 'block';
    
    // ê¸°ë³¸ìœ¼ë¡œ ì£¼ 5ì¼(ì›”-ê¸ˆ) ì„ íƒ
    const weekdaysOption = document.getElementById('weekdaysOption');
    if (weekdaysOption) weekdaysOption.checked = true;
    
    // ì»¤ìŠ¤í…€ ìš”ì¼ ìˆ¨ê¸°ê¸°
    if (customWeekdaysContainer) customWeekdaysContainer.style.display = 'none';
  } else {
    if (weekdayOptionContainer) weekdayOptionContainer.style.display = 'none';
    if (customWeekdaysContainer) customWeekdaysContainer.style.display = 'none';
  }
}

function toggleCustomWeekdays() {
  const weekdayOption = document.querySelector('input[name="weekdayOption"]:checked')?.value;
  const customWeekdaysContainer = document.getElementById('customWeekdaysContainer');
  
  if (weekdayOption === 'custom') {
    if (customWeekdaysContainer) customWeekdaysContainer.style.display = 'block';
  } else {
    if (customWeekdaysContainer) customWeekdaysContainer.style.display = 'none';
  }
}

// ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë¡œë“œ í•¨ìˆ˜ ì—…ë°ì´íŠ¸
function loadDataFromLocalStorage() {
  try {
    diaries = JSON.parse(localStorage.getItem('diaries')) || [];
    memos = JSON.parse(localStorage.getItem('memos')) || [];
    todos = JSON.parse(localStorage.getItem('todos')) || [];
    schedules = JSON.parse(localStorage.getItem('schedules')) || [];
    accountData = JSON.parse(localStorage.getItem('accountData')) || [];
    
    // ìƒˆë¡œìš´ ë°ì´í„° ì¶”ê°€
    goals = JSON.parse(localStorage.getItem('goals')) || [];
    goalProgress = JSON.parse(localStorage.getItem('goalProgress')) || [];
    goalSubTasks = JSON.parse(localStorage.getItem('goalSubTasks')) || []; // ëª©í‘œ ì„¸ë¶€ í•­ëª© ë¡œë“œ
    habits = JSON.parse(localStorage.getItem('habits')) || [];
    habitRecords = JSON.parse(localStorage.getItem('habitRecords')) || [];
  } catch (e) {
    console.error('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
    diaries = [];
    memos = [];
    todos = [];
    schedules = [];
    accountData = [];
    goals = [];
    goalProgress = [];
    goalSubTasks = [];
    habits = [];
    habitRecords = [];
  }
}

// ë¬¸ì„œ ë¡œë“œ ì‹œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
document.addEventListener('DOMContentLoaded', function() {
  // ëª©í‘œ ì¹´í…Œê³ ë¦¬ ë³€ê²½ ì´ë²¤íŠ¸
  const goalCategory = document.getElementById('goalCategory');
  if (goalCategory) {
    goalCategory.addEventListener('change', toggleCategoryInput);
  }
  
  // ìŠµê´€ ì¹´í…Œê³ ë¦¬ ë³€ê²½ ì´ë²¤íŠ¸
  const habitCategory = document.getElementById('habitCategory');
  if (habitCategory) {
    habitCategory.addEventListener('change', toggleHabitCategoryInput);
  }
  
  // ìŠµê´€ ë¹ˆë„ ë³€ê²½ ì´ë²¤íŠ¸
  const habitFrequency = document.getElementById('habitFrequency');
  if (habitFrequency) {
    habitFrequency.addEventListener('change', toggleWeekdayOptions);
  }
  
  // ì£¼ê°„ ì˜µì…˜ ë¼ë””ì˜¤ ë²„íŠ¼ ë³€ê²½ ì´ë²¤íŠ¸
  const weekdayOptions = document.querySelectorAll('input[name="weekdayOption"]');
  weekdayOptions.forEach(option => {
    option.addEventListener('change', toggleCustomWeekdays);
  });
  
  // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
  loadGoals();
  loadHabits();
});
// ì„¸ë¶€ í•­ëª© ìˆ˜ì • í•¨ìˆ˜ ì¶”ê°€
function editSubTask(goalId, taskId) {
  const task = goalSubTasks.find(t => t.id === taskId);
  if (!task) return;
  
  const form = document.getElementById('subTaskForm');
  if (!form) return;
  
  document.getElementById('subTaskTitle').value = task.title;
  document.getElementById('subTaskGoalId').value = goalId;
  document.getElementById('subTaskId').value = taskId;
  
  // ì œëª©ê³¼ ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
  document.getElementById('subTaskFormTitle').textContent = 'ì„¸ë¶€ í•­ëª© ìˆ˜ì •';
  document.getElementById('subTaskFormButton').textContent = 'ìˆ˜ì •';
  
  form.style.display = 'block';
  form.scrollIntoView({ behavior: 'smooth' });
}

// ì„¸ë¶€ í•­ëª© ì‚­ì œ í•¨ìˆ˜ ì¶”ê°€
function deleteSubTask(goalId, taskId) {
  if (!confirm('ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  
  goalSubTasks = goalSubTasks.filter(task => task.id !== taskId);
  
  saveGoals();
  renderGoals();
}
// ìŠµê´€ HTML ìˆ˜ì •ì„ ìœ„í•œ ì½”ë“œ
function updateHabitHTML() {
  // ìŠµê´€ ì¶”ê°€ í¼ì˜ HTMLì´ ì œëŒ€ë¡œ ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸
  const habitFrequency = document.getElementById('habitFrequency');
  const weekdayOptionContainer = document.getElementById('weekdayOptionContainer');
  const customWeekdaysContainer = document.getElementById('customWeekdaysContainer');
  const habitCategory = document.getElementById('habitCategory');
  const habitCustomCategory = document.getElementById('habitCustomCategory');
  
  // ìš”ì†Œë“¤ì´ ì—†ìœ¼ë©´ ìƒì„±
  if (!weekdayOptionContainer) {
    const habitForm = document.querySelector('.tab-content#habits .form-group');
    if (habitForm) {
      // ê¸°ì¡´ ìŠµê´€ ì£¼ê¸° í¼ ì°¾ê¸°
      const frequencyField = habitForm.querySelector('div:has(#habitFrequency)');
      
      if (frequencyField) {
        // ì£¼ê°„ ì˜µì…˜ ì»¨í…Œì´ë„ˆ ì¶”ê°€
        const weekdayOptions = document.createElement('div');
        weekdayOptions.id = 'weekdayOptionContainer';
        weekdayOptions.style.display = 'none';
        weekdayOptions.style.flex = '2';
        weekdayOptions.style.minWidth = '300px';
        weekdayOptions.innerHTML = `
          <label>ì£¼ê°„ ì˜µì…˜</label>
          <div style="display: flex; gap: 15px; margin-top: 5px;">
            <label style="display: flex; align-items: center;">
              <input type="radio" name="weekdayOption" id="weekdaysOption" value="weekdays" checked onchange="toggleCustomWeekdays()"> 
              ì£¼ 5ì¼ (ì›”-ê¸ˆ)
            </label>
            <label style="display: flex; align-items: center;">
              <input type="radio" name="weekdayOption" id="customDaysOption" value="custom" onchange="toggleCustomWeekdays()"> 
              ì§ì ‘ ì„ íƒ
            </label>
          </div>
        `;
        
        // ì£¼ê¸° í•„ë“œ ë‹¤ìŒì— ì‚½ì…
        frequencyField.parentNode.insertBefore(weekdayOptions, frequencyField.nextSibling);
      }
      
      // ìš”ì¼ ì§ì ‘ ì„ íƒ ì»¨í…Œì´ë„ˆ ì¶”ê°€
      if (!customWeekdaysContainer) {
        const customWeekdays = document.createElement('div');
        customWeekdays.id = 'customWeekdaysContainer';
        customWeekdays.style.marginTop = '15px';
        customWeekdays.style.display = 'none';
        customWeekdays.innerHTML = `
          <label>ìš”ì¼ ì„ íƒ</label>
          <div style="display: flex; gap: 8px; margin-top: 5px;">
            <label style="display: flex; align-items: center;"><input type="checkbox" value="0" class="habitWeekDay"> ì¼</label>
            <label style="display: flex; align-items: center;"><input type="checkbox" value="1" class="habitWeekDay"> ì›”</label>
            <label style="display: flex; align-items: center;"><input type="checkbox" value="2" class="habitWeekDay"> í™”</label>
            <label style="display: flex; align-items: center;"><input type="checkbox" value="3" class="habitWeekDay"> ìˆ˜</label>
            <label style="display: flex; align-items: center;"><input type="checkbox" value="4" class="habitWeekDay"> ëª©</label>
            <label style="display: flex; align-items: center;"><input type="checkbox" value="5" class="habitWeekDay"> ê¸ˆ</label>
            <label style="display: flex; align-items: center;"><input type="checkbox" value="6" class="habitWeekDay"> í† </label>
          </div>
        `;
        
        // ìµœì†Œí•œ ì£¼ê¸° í•„ë“œê°€ ìˆëŠ” ë¶€ëª¨ ìš”ì†Œì— ì‚½ì…
        if (frequencyField && frequencyField.parentNode) {
          frequencyField.parentNode.insertBefore(customWeekdays, 
            weekdayOptionContainer ? weekdayOptionContainer.nextSibling : frequencyField.nextSibling);
        } else {
          // í¼ ìì²´ì— ì¶”ê°€
          habitForm.appendChild(customWeekdays);
        }
      }
    }
  }
  
  // ì¹´í…Œê³ ë¦¬ ì§ì ‘ ì…ë ¥ í•„ë“œ í™•ì¸
  if (!habitCustomCategory && habitCategory) {
    const categoryContainer = habitCategory.parentElement;
    if (categoryContainer) {
      const customInput = document.createElement('input');
      customInput.id = 'habitCustomCategory';
      customInput.type = 'text';
      customInput.placeholder = 'ì¹´í…Œê³ ë¦¬ ì§ì ‘ ì…ë ¥';
      customInput.style.display = 'none';
      customInput.style.marginTop = '8px';
      customInput.style.width = '100%';
      
      categoryContainer.appendChild(customInput);
    }
  }
  
  // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ì„¤ì •
  if (habitFrequency) {
    habitFrequency.removeEventListener('change', toggleWeekdayOptions);
    habitFrequency.addEventListener('change', toggleWeekdayOptions);
  }
  
  if (habitCategory) {
    habitCategory.removeEventListener('change', toggleHabitCategoryInput);
    habitCategory.addEventListener('change', toggleHabitCategoryInput);
  }
  
  const weekdayOptions = document.querySelectorAll('input[name="weekdayOption"]');
  weekdayOptions.forEach(option => {
    option.removeEventListener('change', toggleCustomWeekdays);
    option.addEventListener('change', toggleCustomWeekdays);
  });
}
// í˜ì´ì§€ ë¡œë“œ ì‹œ í˜¸ì¶œí•  í•¨ìˆ˜
document.addEventListener('DOMContentLoaded', function() {
  // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ìœ ì§€í•˜ë©´ì„œ ì¶”ê°€
  const existingLoad = window.onload;
  window.onload = function() {
    if (existingLoad) existingLoad();
    
    // ìŠµê´€ HTML ì—…ë°ì´íŠ¸
    setTimeout(updateHabitHTML, 500);
  };
});
// ìŠµê´€ ê´€ë ¨ í•¨ìˆ˜ ê°œì„ 
function initializeHabitFunctions() {
  // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ì„¤ì •
  const habitFrequency = document.getElementById('habitFrequency');
  const habitCategory = document.getElementById('habitCategory');
  
  if (habitFrequency) {
    habitFrequency.addEventListener('change', function() {
      toggleWeekdayOptions();
    });
  }
  
  if (habitCategory) {
    habitCategory.addEventListener('change', function() {
      toggleHabitCategoryInput();
    });
  }
  
  // ì£¼ê°„ ì˜µì…˜ ë¼ë””ì˜¤ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
  const weekdayOptions = document.querySelectorAll('input[name="weekdayOption"]');
  weekdayOptions.forEach(option => {
    option.addEventListener('change', function() {
      toggleCustomWeekdays();
    });
  });
}

// ìŠµê´€ ì¶”ê°€ í•¨ìˆ˜ ê°œì„ 
function addHabit() {
  const title = document.getElementById('habitTitle').value.trim();
  const category = document.getElementById('habitCategory').value;
  const customCategory = document.getElementById('habitCustomCategory')?.value.trim();
  const frequency = document.getElementById('habitFrequency').value;
  const description = document.getElementById('habitDescription').value.trim();
  
  if (!title) {
    alert('ìŠµê´€ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  // ì‹¤ì œ ì‚¬ìš©í•  ì¹´í…Œê³ ë¦¬ (ì§ì ‘ ì…ë ¥ ì„ íƒ ì‹œ customCategory ì‚¬ìš©)
  let finalCategory = category;
  if (category === 'custom' && customCategory) {
    finalCategory = customCategory;
  }
  
  // ì£¼ê°„ ìŠµê´€ì¸ ê²½ìš° ì„ íƒí•œ ìš”ì¼ ë˜ëŠ” ì£¼ 5ì¼(ì›”-ê¸ˆ) ì˜µì…˜ ì²˜ë¦¬
  let weekDays = [];
  if (frequency === 'weekly') {
    const weekdayOption = document.querySelector('input[name="weekdayOption"]:checked')?.value;
    
    if (weekdayOption === 'weekdays' || !weekdayOption) {
      // ì£¼ 5ì¼(ì›”-ê¸ˆ) ì„ íƒ (ë””í´íŠ¸)
      weekDays = [1, 2, 3, 4, 5]; // ì›”í™”ìˆ˜ëª©ê¸ˆ (1-5)
      console.log("ì£¼ 5ì¼ ì„ íƒë¨:", weekDays);
    } else if (weekdayOption === 'custom') {
      // ì§ì ‘ ì„ íƒ
      const checkboxes = document.querySelectorAll('.habitWeekDay:checked');
      weekDays = Array.from(checkboxes).map(cb => parseInt(cb.value));
      console.log("ì§ì ‘ ì„ íƒëœ ìš”ì¼:", weekDays);
      
      if (weekDays.length === 0) {
        alert('í•˜ë‚˜ ì´ìƒì˜ ìš”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
    }
  }
  
  const habit = {
    id: Date.now(),
    title,
    category: finalCategory,
    frequency,
    weekDays, // ì£¼ê°„ì¸ ê²½ìš°ë§Œ ì‚¬ìš©ë¨
    description,
    createdAt: new Date().toISOString(),
    streak: 0, // ì´ˆê¸° ì—°ì† ê¸°ë¡ì€ 0
    color: getRandomHabitColor() // ëœë¤ ìƒ‰ìƒ ì§€ì •
  };
  
  console.log("ì¶”ê°€ë  ìŠµê´€:", habit);
  habits.push(habit);
  saveHabits();
  
  // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
  document.getElementById('habitTitle').value = '';
  document.getElementById('habitCategory').value = 'health';
  if (document.getElementById('habitCustomCategory')) {
    document.getElementById('habitCustomCategory').value = '';
    document.getElementById('habitCustomCategory').style.display = 'none';
  }
  document.getElementById('habitFrequency').value = 'daily';
  
  // ì£¼ê°„ ì˜µì…˜ ì´ˆê¸°í™”
  const weekdayOptionContainer = document.getElementById('weekdayOptionContainer');
  const customWeekdaysContainer = document.getElementById('customWeekdaysContainer');
  if (weekdayOptionContainer) weekdayOptionContainer.style.display = 'none';
  if (customWeekdaysContainer) customWeekdaysContainer.style.display = 'none';
  
  // ìš”ì¼ ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
  document.querySelectorAll('.habitWeekDay').forEach(cb => cb.checked = false);
  
  // ì£¼ 5ì¼ ì˜µì…˜ì´ ê¸°ë³¸ê°’ì´ ë˜ë„ë¡ ì„¤ì •
  const weekdaysOption = document.getElementById('weekdaysOption');
  if (weekdaysOption) weekdaysOption.checked = true;
  
  document.getElementById('habitDescription').value = '';
  
  // ìŠµê´€ ëª©ë¡ ë° ë‹¬ë ¥ ë Œë”ë§
  renderHabits();
  renderHabitCalendar();
  
  alert('ìƒˆë¡œìš´ ìŠµê´€ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
}

// í† ê¸€ í•¨ìˆ˜ ê°œì„ 
function toggleHabitCategoryInput() {
  console.log("ì¹´í…Œê³ ë¦¬ í† ê¸€ ì‹¤í–‰");
  const category = document.getElementById('habitCategory');
  const customCategory = document.getElementById('habitCustomCategory');
  
  if (category && customCategory) {
    if (category.value === 'custom') {
      customCategory.style.display = 'block';
      customCategory.focus();
      console.log("ì§ì ‘ ì…ë ¥ í•„ë“œ í‘œì‹œ");
    } else {
      customCategory.style.display = 'none';
      console.log("ì§ì ‘ ì…ë ¥ í•„ë“œ ìˆ¨ê¹€");
    }
  } else {
    console.log("ì¹´í…Œê³ ë¦¬ ìš”ì†Œ ì°¾ì„ ìˆ˜ ì—†ìŒ:", category, customCategory);
  }
}

function toggleWeekdayOptions() {
  console.log("ì£¼ê°„ ì˜µì…˜ í† ê¸€ ì‹¤í–‰");
  const frequency = document.getElementById('habitFrequency');
  const weekdayOptionContainer = document.getElementById('weekdayOptionContainer');
  const customWeekdaysContainer = document.getElementById('customWeekdaysContainer');
  
  if (frequency && weekdayOptionContainer) {
    if (frequency.value === 'weekly') {
      weekdayOptionContainer.style.display = 'block';
      
      // ê¸°ë³¸ìœ¼ë¡œ ì£¼ 5ì¼(ì›”-ê¸ˆ) ì„ íƒ
      const weekdaysOption = document.getElementById('weekdaysOption');
      if (weekdaysOption) {
        weekdaysOption.checked = true;
        console.log("ì£¼ 5ì¼ ì˜µì…˜ ê¸°ë³¸ ì„ íƒë¨");
      }
      
      // ì»¤ìŠ¤í…€ ìš”ì¼ ìˆ¨ê¸°ê¸°
      if (customWeekdaysContainer) customWeekdaysContainer.style.display = 'none';
    } else {
      if (weekdayOptionContainer) weekdayOptionContainer.style.display = 'none';
      if (customWeekdaysContainer) customWeekdaysContainer.style.display = 'none';
    }
  } else {
    console.log("ì£¼ê°„ ì˜µì…˜ ìš”ì†Œ ì°¾ì„ ìˆ˜ ì—†ìŒ");
  }
}

function toggleCustomWeekdays() {
  console.log("ì»¤ìŠ¤í…€ ìš”ì¼ í† ê¸€ ì‹¤í–‰");
  const weekdayOption = document.querySelector('input[name="weekdayOption"]:checked')?.value;
  console.log("ì„ íƒëœ ì˜µì…˜:", weekdayOption);
  const customWeekdaysContainer = document.getElementById('customWeekdaysContainer');
  
  if (customWeekdaysContainer) {
    if (weekdayOption === 'custom') {
      customWeekdaysContainer.style.display = 'block';
      console.log("ì»¤ìŠ¤í…€ ìš”ì¼ ì»¨í…Œì´ë„ˆ í‘œì‹œ");
    } else {
      customWeekdaysContainer.style.display = 'none';
      console.log("ì»¤ìŠ¤í…€ ìš”ì¼ ì»¨í…Œì´ë„ˆ ìˆ¨ê¹€");
    }
  } else {
    console.log("ì»¤ìŠ¤í…€ ìš”ì¼ ì»¨í…Œì´ë„ˆ ì°¾ì„ ìˆ˜ ì—†ìŒ");
  }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ í•¨ìˆ˜ ì‹¤í–‰
document.addEventListener('DOMContentLoaded', function() {
  console.log("DOM ë¡œë“œë¨, ìŠµê´€ ê¸°ëŠ¥ ì´ˆê¸°í™”");
  
  // ì´ˆê¸° ì„¤ì •
  const existingLoad = window.onload;
  window.onload = function() {
    if (existingLoad) existingLoad();
    
    console.log("ìŠµê´€ HTML ì—…ë°ì´íŠ¸ ì‹¤í–‰");
    updateHabitHTML();
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    setTimeout(function() {
      initializeHabitFunctions();
      console.log("ìŠµê´€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ");
    }, 1000);
  };
  
  // íƒ­ ë³€ê²½ ì‹œ ì¬ì´ˆê¸°í™”
  const habitTab = document.querySelector('.nav-link[onclick="showTab(\'habits\')"]');
  if (habitTab) {
    habitTab.addEventListener('click', function() {
      console.log("ìŠµê´€ íƒ­ í´ë¦­ë¨");
      setTimeout(function() {
        updateHabitHTML();
        initializeHabitFunctions();
      }, 500);
    });
  }
});
// ë‚ ì§œ ì„ íƒ ê¸°ëŠ¥ ì¶”ê°€
function addDateSelectionUI() {
  // ê¸°ì¡´ ì£¼ê°„ ì˜µì…˜ ì»¨í…Œì´ë„ˆ ì°¾ê¸°
  const weekdayOptionContainer = document.getElementById('weekdayOptionContainer');
  
  if (weekdayOptionContainer && !document.getElementById('dateSelectionContainer')) {
    // ë‚ ì§œ ì„ íƒ ì»¨í…Œì´ë„ˆ ìƒì„±
    const dateSelectionContainer = document.createElement('div');
    dateSelectionContainer.id = 'dateSelectionContainer';
    dateSelectionContainer.style.marginTop = '15px';
    dateSelectionContainer.style.display = 'none';
    dateSelectionContainer.innerHTML = `
      <label>ë‚ ì§œ ì„ íƒ</label>
      <div id="dateSelectionCalendar" style="margin-top: 10px; background-color: white; border: 1px solid #ddd; border-radius: 5px; padding: 10px;">
        <!-- ë‹¬ë ¥ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        <div style="text-align: center; color: #888; padding: 10px;">
          ë§¤ì›” ì„ íƒ ì‹œ íŠ¹ì • ë‚ ì§œë¥¼ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
      </div>
    `;
    
    // ìŠµê´€ í¼ì— ì¶”ê°€
    const habitForm = document.querySelector('.tab-content#habits .form-group');
    if (habitForm) {
      habitForm.appendChild(dateSelectionContainer);
    }
    
    // ì£¼ê¸° ì„ íƒ ì´ë²¤íŠ¸ ì—…ë°ì´íŠ¸
    const habitFrequency = document.getElementById('habitFrequency');
    if (habitFrequency) {
      habitFrequency.addEventListener('change', function() {
        if (this.value === 'monthly') {
          document.getElementById('dateSelectionContainer').style.display = 'block';
          document.getElementById('weekdayOptionContainer').style.display = 'none';
          document.getElementById('customWeekdaysContainer').style.display = 'none';
          
          // ì—¬ê¸°ì— ë‹¬ë ¥ ë Œë”ë§ ì½”ë“œë¥¼ ì¶”ê°€í•˜ì„¸ìš”
          renderDateSelectionCalendar();
        } else {
          document.getElementById('dateSelectionContainer').style.display = 'none';
        }
      });
    }
  }
}

// ë‚ ì§œ ì„ íƒìš© ë‹¬ë ¥ ë Œë”ë§
function renderDateSelectionCalendar() {
  const calendar = document.getElementById('dateSelectionCalendar');
  if (!calendar) return;
  
  // ê°„ë‹¨í•œ ë‹¬ë ¥ UI ìƒì„±
  const today = new Date();
  const month = today.getMonth();
  const year = today.getFullYear();
  
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  
  let calendarHTML = `
    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
      <button type="button" style="background-color: #5f7561; color: white; border: none; padding: 5px 10px; border-radius: 3px;">â—€</button>
      <div>${year}ë…„ ${month + 1}ì›”</div>
      <button type="button" style="background-color: #5f7561; color: white; border: none; padding: 5px 10px; border-radius: 3px;">â–¶</button>
    </div>
    <div style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px;">
      <div style="text-align: center; font-weight: bold;">ì¼</div>
      <div style="text-align: center; font-weight: bold;">ì›”</div>
      <div style="text-align: center; font-weight: bold;">í™”</div>
      <div style="text-align: center; font-weight: bold;">ìˆ˜</div>
      <div style="text-align: center; font-weight: bold;">ëª©</div>
      <div style="text-align: center; font-weight: bold;">ê¸ˆ</div>
      <div style="text-align: center; font-weight: bold;">í† </div>
  `;
  
  // ì²« ì£¼ ë¹ˆ ì…€
  for (let i = 0; i < firstDay; i++) {
    calendarHTML += `<div></div>`;
  }
  
  // ë‚ ì§œ ì±„ìš°ê¸°
  for (let day = 1; day <= daysInMonth; day++) {
    calendarHTML += `
      <div class="date-selection-day" data-day="${day}" style="text-align: center; padding: 8px; border: 1px solid #ddd; border-radius: 3px; cursor: pointer;">
        ${day}
      </div>
    `;
  }
  
  calendarHTML += `</div>`;
  calendar.innerHTML = calendarHTML;
  
  // ë‚ ì§œ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
  document.querySelectorAll('.date-selection-day').forEach(day => {
    day.addEventListener('click', function() {
      this.classList.toggle('selected');
      if (this.classList.contains('selected')) {
        this.style.backgroundColor = '#e8f4f1';
        this.style.border = '2px solid #5f7561';
      } else {
        this.style.backgroundColor = '';
        this.style.border = '1px solid #ddd';
      }
    });
  });
}

// ë‚ ì§œ ì„ íƒ UI ì¶”ê°€ í•¨ìˆ˜ í˜¸ì¶œ
setTimeout(function() {
  addDateSelectionUI();
}, 1500);
// ëª©í‘œ ì„¸ë¶€ í•­ëª© ê´€ë ¨ ê¸°ëŠ¥ ê°œì„ 
function fixGoalSubtaskFunctions() {
  console.log("ëª©í‘œ ì„¸ë¶€ í•­ëª© ê¸°ëŠ¥ ìˆ˜ì • ì‹œì‘");
  
  // ì„¸ë¶€ í•­ëª© í† ê¸€ í•¨ìˆ˜ ìˆ˜ì •
  window.toggleSubTasks = function(goalId) {
    console.log("ì„¸ë¶€ í•­ëª© í† ê¸€ í˜¸ì¶œ:", goalId);
    const goalIndex = goals.findIndex(g => g.id === goalId);
    if (goalIndex === -1) return;
    
    // ì„¸ë¶€ í•­ëª© ì‚¬ìš© ìƒíƒœ í† ê¸€
    goals[goalIndex].hasSubTasks = !goals[goalIndex].hasSubTasks;
    console.log(`ëª©í‘œ ID ${goalId}ì˜ ì„¸ë¶€ í•­ëª© ìƒíƒœ: ${goals[goalIndex].hasSubTasks}`);
    
    // ì²˜ìŒ ì„¸ë¶€ í•­ëª©ì„ í™œì„±í™”í•˜ëŠ” ê²½ìš° ê¸°ë³¸ í•­ëª© ì¶”ê°€ ì•ˆí•¨
    saveGoals();
    renderGoals();
  };
  
  // ì„¸ë¶€ í•­ëª© ì¶”ê°€ í¼ í‘œì‹œ í•¨ìˆ˜ ìˆ˜ì •
  window.showAddSubTaskForm = function(goalId) {
    console.log("ì„¸ë¶€ í•­ëª© ì¶”ê°€ í¼ í‘œì‹œ:", goalId);
    const form = document.getElementById('subTaskForm');
    if (!form) {
      console.error("ì„¸ë¶€ í•­ëª© í¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ");
      createSubTaskForm();
      return setTimeout(() => showAddSubTaskForm(goalId), 500);
    }
    
    document.getElementById('subTaskTitle').value = '';
    document.getElementById('subTaskGoalId').value = goalId;
    document.getElementById('subTaskId').value = ''; // ìƒˆ í•­ëª© ì¶”ê°€ ì‹œì—ëŠ” ID ë¹„ì›€
    
    // ì œëª©ê³¼ ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
    document.getElementById('subTaskFormTitle').textContent = 'ì„¸ë¶€ í•­ëª© ì¶”ê°€';
    
    // ë²„íŠ¼ onclick ì§ì ‘ ì„¤ì •
    const addButton = document.getElementById('subTaskFormButton');
    if (addButton) {
      addButton.textContent = 'ì¶”ê°€';
      addButton.onclick = function() { addSubTask(); };
    }
    
    form.style.display = 'block';
    form.scrollIntoView({ behavior: 'smooth' });
  };
  
  // ì„¸ë¶€ í•­ëª© ì¶”ê°€ í•¨ìˆ˜ ìˆ˜ì •
  window.addSubTask = function() {
    console.log("ì„¸ë¶€ í•­ëª© ì¶”ê°€ í•¨ìˆ˜ í˜¸ì¶œ");
    const title = document.getElementById('subTaskTitle').value.trim();
    const goalId = parseInt(document.getElementById('subTaskGoalId').value);
    const taskId = document.getElementById('subTaskId').value; // ìˆ˜ì • ì‹œ ì‚¬ìš©
    
    if (!title) {
      alert('í•­ëª© ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    console.log(`ì„¸ë¶€ í•­ëª© ì¶”ê°€/ìˆ˜ì •: ëª©í‘œ ID ${goalId}, í•­ëª© ID ${taskId || 'ì‹ ê·œ'}`);
    
    // ìˆ˜ì • ëª¨ë“œì¸ ê²½ìš°
    if (taskId) {
      const taskIndex = goalSubTasks.findIndex(t => t.id === parseInt(taskId));
      if (taskIndex !== -1) {
        goalSubTasks[taskIndex].title = title;
        
        saveGoals();
        renderGoals();
        closeSubTaskForm();
        console.log("ì„¸ë¶€ í•­ëª© ìˆ˜ì • ì™„ë£Œ");
        return;
      }
    }
    
    // ìƒˆ í•­ëª© ì¶”ê°€
    const subTask = {
      id: Date.now(),
      goalId: goalId,
      title: title,
      completed: false,
      createdAt: new Date().toISOString()
    };
    
    console.log("ìƒˆ ì„¸ë¶€ í•­ëª© ìƒì„±:", subTask);
    goalSubTasks.push(subTask);
    saveGoals();
    renderGoals();
    closeSubTaskForm();
    console.log("ì„¸ë¶€ í•­ëª© ì¶”ê°€ ì™„ë£Œ");
  };
  
  // ì„¸ë¶€ í•­ëª© í¼ ë‹«ê¸° í•¨ìˆ˜ ìˆ˜ì •
  window.closeSubTaskForm = function() {
    console.log("ì„¸ë¶€ í•­ëª© í¼ ë‹«ê¸°");
    const form = document.getElementById('subTaskForm');
    if (form) form.style.display = 'none';
  };
  
  // ì„¸ë¶€ í•­ëª© í† ê¸€ í•¨ìˆ˜ ìˆ˜ì • (ì™„ë£Œ/ë¯¸ì™„ë£Œ)
  window.toggleSubTask = function(goalId, taskId) {
    console.log(`ì„¸ë¶€ í•­ëª© í† ê¸€: ëª©í‘œ ID ${goalId}, í•­ëª© ID ${taskId}`);
    const taskIndex = goalSubTasks.findIndex(t => t.id === taskId);
    if (taskIndex === -1) return;
    
    // ìƒíƒœ í† ê¸€
    goalSubTasks[taskIndex].completed = !goalSubTasks[taskIndex].completed;
    console.log(`ì„¸ë¶€ í•­ëª© ì™„ë£Œ ìƒíƒœ: ${goalSubTasks[taskIndex].completed}`);
    
    saveGoals();
    renderGoals();
  };
  
  // ì„¸ë¶€ í•­ëª© í¼ ìƒì„± (ì—†ì„ ê²½ìš°)
  function createSubTaskForm() {
    console.log("ì„¸ë¶€ í•­ëª© í¼ ìƒì„±");
    const form = document.createElement('div');
    form.id = 'subTaskForm';
    form.style.display = 'none';
    form.style.background = '#d7d5cb';
    form.style.padding = '15px';
    form.style.borderRadius = '8px';
    form.style.margin = '20px 0';
    form.innerHTML = `
      <h3 id="subTaskFormTitle" style="margin-top: 0;">ì„¸ë¶€ í•­ëª© ì¶”ê°€</h3>
      <div style="margin-bottom: 15px;">
        <label for="subTaskTitle">í•­ëª© ì´ë¦„</label>
        <input id="subTaskTitle" type="text" style="width: 100%; margin-top: 5px; padding: 8px; border-radius: 5px; border: 1px solid #ccc;">
      </div>
      <input id="subTaskGoalId" type="hidden">
      <input id="subTaskId" type="hidden">
      <div style="text-align: right;">
        <button id="subTaskFormButton" style="background-color: #5f7561; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">ì¶”ê°€</button>
        <button onclick="closeSubTaskForm()" style="background-color: #95a5a6; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-left: 5px;">ì·¨ì†Œ</button>
      </div>
    `;
    
    const goalsList = document.getElementById('goalsList');
    if (goalsList) {
      goalsList.parentNode.insertBefore(form, goalsList.nextSibling);
      console.log("ì„¸ë¶€ í•­ëª© í¼ ìƒì„± ì™„ë£Œ");
    } else {
      console.error("ëª©í‘œ ëª©ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ ì„¸ë¶€ í•­ëª© í¼ì„ ì¶”ê°€í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
      
      // ëŒ€ì•ˆìœ¼ë¡œ goals íƒ­ì— ì¶”ê°€
      const goalsTab = document.getElementById('goals');
      if (goalsTab) {
        goalsTab.appendChild(form);
        console.log("ì„¸ë¶€ í•­ëª© í¼ì„ goals íƒ­ì— ì§ì ‘ ì¶”ê°€í•¨");
      }
    }
  }
  
  // ëª©í‘œ ìˆ˜ì • ê¸°ëŠ¥ ì¶”ê°€
  window.editGoal = function(goalId) {
    console.log("ëª©í‘œ ìˆ˜ì • ì‹œì‘:", goalId);
    const goal = goals.find(g => g.id === goalId);
    if (!goal) return;
    
    // ëª©í‘œ í¼ í•„ë“œì— ê°’ ì±„ìš°ê¸°
    document.getElementById('goalTitle').value = goal.title;
    document.getElementById('goalCategory').value = goal.category;
    document.getElementById('goalStartValue').value = goal.startValue;
    document.getElementById('goalTargetValue').value = goal.targetValue;
    document.getElementById('goalUnit').value = goal.unit;
    document.getElementById('goalStartDate').value = goal.startDate;
    document.getElementById('goalEndDate').value = goal.endDate;
    document.getElementById('goalDescription').value = goal.description || '';
    
    // ì¹´í…Œê³ ë¦¬ê°€ customì¸ ê²½ìš° ì²˜ë¦¬
    if (!['weight', 'finance', 'study', 'fitness'].includes(goal.category)) {
      document.getElementById('goalCategory').value = 'custom';
      const customCategory = document.getElementById('goalCustomCategory');
      if (customCategory) {
        customCategory.value = goal.category;
        customCategory.style.display = 'block';
      }
    }
    
    // í™”ë©´ ìƒë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
    window.scrollTo(0, 0);
    
    // ì¶”ê°€ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½ ë° ì´ë²¤íŠ¸ ì¬ì„¤ì •
    const addButton = document.querySelector('.tab-content#goals .form-group button');
    if (addButton) {
      addButton.textContent = 'ëª©í‘œ ìˆ˜ì •';
      addButton.dataset.originalOnclick = addButton.getAttribute('onclick');
      addButton.setAttribute('onclick', `updateGoalFromForm(${goalId})`);
    }
    
    console.log("ëª©í‘œ ìˆ˜ì • í¼ ì¤€ë¹„ ì™„ë£Œ");
  };
  
  // ìˆ˜ì •ëœ ëª©í‘œ ì €ì¥
  window.updateGoalFromForm = function(goalId) {
    console.log("ëª©í‘œ í¼ì—ì„œ ì—…ë°ì´íŠ¸:", goalId);
    const goalIndex = goals.findIndex(g => g.id === goalId);
    if (goalIndex === -1) return;
    
    const title = document.getElementById('goalTitle').value.trim();
    const category = document.getElementById('goalCategory').value;
    const customCategory = document.getElementById('goalCustomCategory')?.value.trim();
    const startValue = parseFloat(document.getElementById('goalStartValue').value);
    const targetValue = parseFloat(document.getElementById('goalTargetValue').value);
    const unit = document.getElementById('goalUnit').value.trim();
    const startDate = document.getElementById('goalStartDate').value;
    const endDate = document.getElementById('goalEndDate').value;
    const description = document.getElementById('goalDescription').value.trim();
    
    // ê¸°ë³¸ ìœ íš¨ì„± ê²€ì‚¬
    if (!title) {
      alert('ëª©í‘œ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    if (isNaN(startValue) || isNaN(targetValue)) {
      alert('ì‹œì‘ ê°’ê³¼ ëª©í‘œ ê°’ì€ ìˆ«ìë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    if (!startDate || !endDate) {
      alert('ì‹œì‘ì¼ê³¼ ëª©í‘œì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    // ì‹¤ì œ ì‚¬ìš©í•  ì¹´í…Œê³ ë¦¬
    const finalCategory = category === 'custom' ? customCategory : category;
    
    // ëª©í‘œ ì—…ë°ì´íŠ¸
    goals[goalIndex].title = title;
    goals[goalIndex].category = finalCategory;
    goals[goalIndex].startValue = startValue;
    goals[goalIndex].targetValue = targetValue;
    goals[goalIndex].unit = unit;
    goals[goalIndex].startDate = startDate;
    goals[goalIndex].endDate = endDate;
    goals[goalIndex].description = description;
    
    // ì €ì¥ ë° UI ì—…ë°ì´íŠ¸
    saveGoals();
    resetGoalForm();
    renderGoals();
    
    alert('ëª©í‘œê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
    
    console.log("ëª©í‘œ ì—…ë°ì´íŠ¸ ì™„ë£Œ");
  };
  
  // ëª©í‘œ í¼ ì´ˆê¸°í™”
  function resetGoalForm() {
    document.getElementById('goalTitle').value = '';
    document.getElementById('goalCategory').value = 'weight';
    document.getElementById('goalStartValue').value = '';
    document.getElementById('goalTargetValue').value = '';
    document.getElementById('goalUnit').value = '';
    document.getElementById('goalDescription').value = '';
    
    const customCategory = document.getElementById('goalCustomCategory');
    if (customCategory) {
      customCategory.value = '';
      customCategory.style.display = 'none';
    }
    
    // ë²„íŠ¼ ì›ë˜ëŒ€ë¡œ ë³µì›
    const addButton = document.querySelector('.tab-content#goals .form-group button');
    if (addButton) {
      addButton.textContent = 'ëª©í‘œ ì¶”ê°€';
      if (addButton.dataset.originalOnclick) {
        addButton.setAttribute('onclick', addButton.dataset.originalOnclick);
        delete addButton.dataset.originalOnclick;
      } else {
        addButton.setAttribute('onclick', 'addGoal()');
      }
    }
  }
  
  // ëª©í‘œ ë Œë”ë§ í•¨ìˆ˜ ìˆ˜ì • (ìˆ˜ì • ë²„íŠ¼ ì¶”ê°€)
  const originalRenderGoals = window.renderGoals;
  window.renderGoals = function() {
    console.log("ìˆ˜ì •ëœ ëª©í‘œ ë Œë”ë§ í•¨ìˆ˜ í˜¸ì¶œ");
    
    if (typeof originalRenderGoals === 'function') {
      originalRenderGoals();
      
      // ê° ëª©í‘œ í•­ëª©ì— ìˆ˜ì • ë²„íŠ¼ ì¶”ê°€
      document.querySelectorAll('.goal-controls').forEach(controlsDiv => {
        if (!controlsDiv.querySelector('button[onclick^="editGoal"]')) {
          // goalId ì¶”ì¶œ
          const deleteBtn = controlsDiv.querySelector('button[onclick^="deleteGoal"]');
          if (deleteBtn) {
            const onclickAttr = deleteBtn.getAttribute('onclick');
            const matches = onclickAttr.match(/deleteGoal\((\d+)\)/);
            if (matches && matches[1]) {
              const goalId = matches[1];
              
              // ìˆ˜ì • ë²„íŠ¼ ìƒì„± ë° ì¶”ê°€ (ì²« ë²ˆì§¸ ìì‹ìœ¼ë¡œ)
              const editButton = document.createElement('button');
              editButton.textContent = 'ìˆ˜ì •';
              editButton.setAttribute('onclick', `editGoal(${goalId})`);
              controlsDiv.prepend(editButton);
              
              console.log(`ëª©í‘œ ID ${goalId}ì— ìˆ˜ì • ë²„íŠ¼ ì¶”ê°€`);
            }
          }
        }
      });
    } else {
      console.error("ì›ë³¸ renderGoals í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ");
    }
  };
  
  console.log("ëª©í‘œ ì„¸ë¶€ í•­ëª© ê¸°ëŠ¥ ìˆ˜ì • ì™„ë£Œ");
}

// í•¨ìˆ˜ ì¦‰ì‹œ ì‹¤í–‰ ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
(function() {
  console.log("ëª©í‘œ ê¸°ëŠ¥ ê°œì„  ì´ˆê¸°í™”");
  
  // DOM ë¡œë“œ í›„ ì‹¤í–‰
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      fixGoalSubtaskFunctions();
    });
  } else {
    fixGoalSubtaskFunctions();
  }
  
  // íƒ­ ë³€ê²½ ì‹œì—ë„ ì‹¤í–‰
  const originalShowTab = window.showTab;
  if (typeof originalShowTab === 'function') {
    window.showTab = function(tabId) {
      originalShowTab(tabId);
      
      if (tabId === 'goals') {
        setTimeout(fixGoalSubtaskFunctions, 300);
      }
    };
  }
})();
// ìŠµê´€ ì¶”ì  ê´€ë ¨ ê¸°ëŠ¥ ê°œì„ 
function fixHabitFunctions() {
  console.log("ìŠµê´€ ì¶”ì  ê¸°ëŠ¥ ê°œì„  ì‹œì‘");
  
  // ì£¼ê¸° ì˜µì…˜ì— 'íŠ¹ì •ì¼' ì¶”ê°€
  const habitFrequency = document.getElementById('habitFrequency');
  if (habitFrequency && !Array.from(habitFrequency.options).some(opt => opt.value === 'specific')) {
    const specificOption = document.createElement('option');
    specificOption.value = 'specific';
    specificOption.textContent = 'íŠ¹ì •ì¼';
    habitFrequency.appendChild(specificOption);
    console.log("'íŠ¹ì •ì¼' ì˜µì…˜ ì¶”ê°€ë¨");
  }
  
  // íŠ¹ì •ì¼ ì„ íƒ ì»¨í…Œì´ë„ˆ ì¶”ê°€
  if (!document.getElementById('specificDatesContainer')) {
    const habitForm = document.querySelector('.tab-content#habits .form-group');
    if (habitForm) {
      const container = document.createElement('div');
      container.id = 'specificDatesContainer';
      container.style.display = 'none';
      container.style.marginTop = '15px';
      container.innerHTML = `
        <label>íŠ¹ì • ë‚ ì§œ ì„ íƒ (ë‹¬ë ¥ì—ì„œ ì›í•˜ëŠ” ë‚ ì§œë¥¼ í´ë¦­í•˜ì„¸ìš”)</label>
        <p style="font-size: 0.85rem; color: #666; margin-top: 5px;">
          íŠ¹ì •ì¼ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ ë‚ ì§œì—ë§Œ ìŠµê´€ì´ í‘œì‹œë©ë‹ˆë‹¤.
        </p>
      `;
      
      habitForm.appendChild(container);
      console.log("íŠ¹ì •ì¼ ì„ íƒ ì»¨í…Œì´ë„ˆ ì¶”ê°€ë¨");
    }
  }
  
  // ê¸°ì¡´ í•¨ìˆ˜ ìˆ˜ì •
  
  // ìŠµê´€ ì¶”ê°€ í•¨ìˆ˜ ìˆ˜ì •
  window.addHabit = function() {
    console.log("ìˆ˜ì •ëœ ìŠµê´€ ì¶”ê°€ í•¨ìˆ˜ í˜¸ì¶œ");
    const title = document.getElementById('habitTitle').value.trim();
    const category = document.getElementById('habitCategory').value;
    const customCategory = document.getElementById('habitCustomCategory')?.value.trim();
    const frequency = document.getElementById('habitFrequency').value;
    const description = document.getElementById('habitDescription').value.trim();
    
    if (!title) {
      alert('ìŠµê´€ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    // ì‹¤ì œ ì‚¬ìš©í•  ì¹´í…Œê³ ë¦¬ (ì§ì ‘ ì…ë ¥ ì„ íƒ ì‹œ customCategory ì‚¬ìš©)
    let finalCategory = category;
    if (category === 'custom' && customCategory) {
      finalCategory = customCategory;
    }
    
    // ì£¼ê¸°ì— ë”°ë¥¸ ë‚ ì§œ ì„¤ì •
    let weekDays = [];
    let specificDates = [];
    
    if (frequency === 'weekly') {
      const weekdayOption = document.querySelector('input[name="weekdayOption"]:checked')?.value;
      
      if (weekdayOption === 'weekdays' || !weekdayOption) {
        // ì£¼ 5ì¼(ì›”-ê¸ˆ) ì„ íƒ
        weekDays = [1, 2, 3, 4, 5]; // ì›”í™”ìˆ˜ëª©ê¸ˆ (1-5)
        console.log("ì£¼ 5ì¼ ì„ íƒë¨:", weekDays);
      } else if (weekdayOption === 'custom') {
        // ì§ì ‘ ì„ íƒ
        const checkboxes = document.querySelectorAll('.habitWeekDay:checked');
        weekDays = Array.from(checkboxes).map(cb => parseInt(cb.value));
        console.log("ì§ì ‘ ì„ íƒëœ ìš”ì¼:", weekDays);
        
        if (weekDays.length === 0) {
          alert('í•˜ë‚˜ ì´ìƒì˜ ìš”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
          return;
        }
      }
    } 
    else if (frequency === 'specific') {
      // íŠ¹ì •ì¼ ì²˜ë¦¬
      specificDates = window.selectedSpecificDates || [];
      console.log("ì„ íƒëœ íŠ¹ì •ì¼:", specificDates);
      
      if (specificDates.length === 0) {
        alert('í•˜ë‚˜ ì´ìƒì˜ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }
    }
    
    const habit = {
      id: Date.now(),
      title,
      category: finalCategory,
      frequency,
      weekDays, // ì£¼ê°„ì¸ ê²½ìš°ë§Œ ì‚¬ìš©ë¨
      specificDates, // íŠ¹ì •ì¼ì¸ ê²½ìš°ë§Œ ì‚¬ìš©ë¨
      description,
      createdAt: new Date().toISOString(),
      streak: 0, // ì´ˆê¸° ì—°ì† ê¸°ë¡ì€ 0
      color: getRandomHabitColor() // ëœë¤ ìƒ‰ìƒ ì§€ì •
    };
    
    console.log("ì¶”ê°€ë  ìŠµê´€:", habit);
    habits.push(habit);
    saveHabits();
    
    // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
    document.getElementById('habitTitle').value = '';
    document.getElementById('habitCategory').value = 'health';
    if (document.getElementById('habitCustomCategory')) {
      document.getElementById('habitCustomCategory').value = '';
      document.getElementById('habitCustomCategory').style.display = 'none';
    }
    document.getElementById('habitFrequency').value = 'daily';
    
    // ì£¼ê°„ ì˜µì…˜ ì´ˆê¸°í™”
    const weekdayOptionContainer = document.getElementById('weekdayOptionContainer');
    const customWeekdaysContainer = document.getElementById('customWeekdaysContainer');
    const specificDatesContainer = document.getElementById('specificDatesContainer');
    
    if (weekdayOptionContainer) weekdayOptionContainer.style.display = 'none';
    if (customWeekdaysContainer) customWeekdaysContainer.style.display = 'none';
    if (specificDatesContainer) specificDatesContainer.style.display = 'none';
    
    // ìš”ì¼ ì²´í¬ë°•ìŠ¤ ì´ˆê¸°í™”
    document.querySelectorAll('.habitWeekDay').forEach(cb => cb.checked = false);
    
    // ì£¼ 5ì¼ ì˜µì…˜ì´ ê¸°ë³¸ê°’ì´ ë˜ë„ë¡ ì„¤ì •
    const weekdaysOption = document.getElementById('weekdaysOption');
    if (weekdaysOption) weekdaysOption.checked = true;
    
    // íŠ¹ì •ì¼ ì„ íƒ ì´ˆê¸°í™”
    window.selectedSpecificDates = [];
    document.querySelectorAll('.habit-calendar-day').forEach(day => {
      day.classList.remove('specific-date-selected');
    });
    
    document.getElementById('habitDescription').value = '';
    
    // ìŠµê´€ ëª©ë¡ ë° ë‹¬ë ¥ ë Œë”ë§
    renderHabits();
    renderHabitCalendar();
    
    alert('ìƒˆë¡œìš´ ìŠµê´€ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
  };
  
  // ì£¼ê¸° ë³€ê²½ í•¨ìˆ˜ ìˆ˜ì •
  window.toggleWeekdayOptions = function() {
    console.log("ì£¼ê°„ ì˜µì…˜ í† ê¸€ ì‹¤í–‰");
    const frequency = document.getElementById('habitFrequency');
    const weekdayOptionContainer = document.getElementById('weekdayOptionContainer');
    const customWeekdaysContainer = document.getElementById('customWeekdaysContainer');
    const specificDatesContainer = document.getElementById('specificDatesContainer');
    
    // ëª¨ë“  ì˜µì…˜ ì»¨í…Œì´ë„ˆ ìˆ¨ê¸°ê¸°
    if (weekdayOptionContainer) weekdayOptionContainer.style.display = 'none';
    if (customWeekdaysContainer) customWeekdaysContainer.style.display = 'none';
    if (specificDatesContainer) specificDatesContainer.style.display = 'none';
    
    if (frequency && frequency.value === 'weekly') {
      if (weekdayOptionContainer) {
        weekdayOptionContainer.style.display = 'block';
        
        // ê¸°ë³¸ìœ¼ë¡œ ì£¼ 5ì¼(ì›”-ê¸ˆ) ì„ íƒ
        const weekdaysOption = document.getElementById('weekdaysOption');
        if (weekdaysOption) {
          weekdaysOption.checked = true;
        }
      }
    } 
    else if (frequency && frequency.value === 'specific') {
      if (specificDatesContainer) {
        specificDatesContainer.style.display = 'block';
        
        // íŠ¹ì •ì¼ ì„ íƒ ëª¨ë“œ í™œì„±í™”
        enableSpecificDateSelection();
      }
    }
  };
  
  // íŠ¹ì •ì¼ ì„ íƒ í™œì„±í™”
  function enableSpecificDateSelection() {
    console.log("íŠ¹ì •ì¼ ì„ íƒ ëª¨ë“œ í™œì„±í™”");
    
    // íŠ¹ì •ì¼ ì„ íƒì„ ìœ„í•œ ì „ì—­ ë°°ì—´ ì´ˆê¸°í™”
    window.selectedSpecificDates = window.selectedSpecificDates || [];
    
    // ê¸°ì¡´ì— ì„ íƒëœ ë‚ ì§œ í‘œì‹œ
    setTimeout(() => {
      const calendarDays = document.querySelectorAll('.habit-calendar-day');
      calendarDays.forEach(day => {
        const dateStr = day.querySelector('.habit-items')?.dataset.date;
        if (dateStr && window.selectedSpecificDates.includes(dateStr)) {
          day.classList.add('specific-date-selected');
        }
        
        // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
        day.style.cursor = 'pointer';
        day.addEventListener('click', function(e) {
          if (document.getElementById('habitFrequency')?.value !== 'specific') return;
          
          const dateElement = this.querySelector('.habit-items');
          if (!dateElement) return;
          
          const dateStr = dateElement.dataset.date;
          if (!dateStr) return;
          
          console.log("ë‚ ì§œ í´ë¦­:", dateStr);
          
          // ë‚ ì§œ í† ê¸€
          const dateIndex = window.selectedSpecificDates.indexOf(dateStr);
          if (dateIndex === -1) {
            window.selectedSpecificDates.push(dateStr);
            this.classList.add('specific-date-selected');
          } else {
            window.selectedSpecificDates.splice(dateIndex, 1);
            this.classList.remove('specific-date-selected');
          }
          
          console.log("ì„ íƒëœ íŠ¹ì •ì¼:", window.selectedSpecificDates);
          
          // ì´ë²¤íŠ¸ ë²„ë¸”ë§ ì¤‘ì§€
          e.stopPropagation();
        });
      });
    }, 300);
    
    // íŠ¹ì •ì¼ ì„ íƒ ìŠ¤íƒ€ì¼ ì¶”ê°€
    addSpecificDateStyles();
  }
  
  // íŠ¹ì •ì¼ ì„ íƒ ìŠ¤íƒ€ì¼ ì¶”ê°€
  function addSpecificDateStyles() {
    if (document.getElementById('specific-date-styles')) return;
    
    const styleEl = document.createElement('style');
    styleEl.id = 'specific-date-styles';
    styleEl.textContent = `
      .habit-calendar-day.specific-date-selected {
        background-color: #e8f4f1;
        border: 2px solid #5f7561;
        box-shadow: 0 0 8px rgba(95, 117, 97, 0.3);
      }
      
      .habit-calendar-day.other-month {
        opacity: 0.5;
      }
      
      .habit-calendar-day {
        transition: all 0.2s ease;
      }
      
      .habit-calendar-day:hover {
        transform: scale(1.05);
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
    `;
    
    document.head.appendChild(styleEl);
    console.log("íŠ¹ì •ì¼ ì„ íƒ ìŠ¤íƒ€ì¼ ì¶”ê°€ë¨");
  }
  
  // ìŠµê´€ì´ íŠ¹ì • ë‚ ì§œì— ì˜ˆì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜ ì—…ë°ì´íŠ¸
  window.isHabitScheduledForDate = function(habit, date) {
    const dateStr = date.toISOString().split('T')[0];
    const dayOfWeek = date.getDay(); // 0(ì¼) ~ 6(í† )
    
    switch (habit.frequency) {
      case 'daily':
        return true;
      case 'weekly':
        return habit.weekDays.includes(dayOfWeek);
      case 'monthly':
        const habitStartDate = new Date(habit.createdAt);
        return date.getDate() === habitStartDate.getDate();
      case 'specific':
        return habit.specificDates && habit.specificDates.includes(dateStr);
      default:
        return false;
    }
  };
  
  // ë Œë”ë§ í•¨ìˆ˜ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ì´ë²¤íŠ¸ ì„¤ì •
  const habitTab = document.querySelector('.nav-link[onclick="showTab(\'habits\')"]');
  if (habitTab) {
    habitTab.addEventListener('click', function() {
      console.log("ìŠµê´€ íƒ­ í´ë¦­ë¨");
      setTimeout(function() {
        const habitFrequency = document.getElementById('habitFrequency');
        if (habitFrequency) {
          habitFrequency.removeEventListener('change', toggleWeekdayOptions);
          habitFrequency.addEventListener('change', toggleWeekdayOptions);
          console.log("ìŠµê´€ ì£¼ê¸° ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¬ì„¤ì •");
        }
      }, 500);
    });
  }
  
  // ì´ˆê¸° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
  setTimeout(function() {
    const habitFrequency = document.getElementById('habitFrequency');
    if (habitFrequency) {
      habitFrequency.removeEventListener('change', window.toggleWeekdayOptions);
      habitFrequency.addEventListener('change', window.toggleWeekdayOptions);
      console.log("ìŠµê´€ ì£¼ê¸° ë³€ê²½ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •");
    }
  }, 1000);
  
  console.log("ìŠµê´€ ì¶”ì  ê¸°ëŠ¥ ê°œì„  ì™„ë£Œ");
}

// í•¨ìˆ˜ ì¦‰ì‹œ ì‹¤í–‰ ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
(function() {
  console.log("ìŠµê´€ ê¸°ëŠ¥ ê°œì„  ì´ˆê¸°í™”");
  
  // DOM ë¡œë“œ í›„ ì‹¤í–‰
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      fixHabitFunctions();
    });
  } else {
    fixHabitFunctions();
  }
  
  // íƒ­ ë³€ê²½ ì‹œì—ë„ ì‹¤í–‰
  const originalShowTab = window.showTab;
  if (typeof originalShowTab === 'function') {
    window.showTab = function(tabId) {
      originalShowTab(tabId);
      
      if (tabId === 'habits') {
        setTimeout(fixHabitFunctions, 300);
      }
    };
  }
  
  // ìŠµê´€ ë‹¬ë ¥ ë Œë”ë§ í›„ íŠ¹ì •ì¼ ì´ë²¤íŠ¸ ì„¤ì •
  const originalRenderHabitCalendar = window.renderHabitCalendar;
  if (typeof originalRenderHabitCalendar === 'function') {
    window.renderHabitCalendar = function() {
      originalRenderHabitCalendar();
      
      // íŠ¹ì •ì¼ ì„ íƒ ëª¨ë“œ í™œì„±í™” (ì£¼ê¸°ê°€ íŠ¹ì •ì¼ì¸ ê²½ìš°)
      if (document.getElementById('habitFrequency')?.value === 'specific') {
        setTimeout(() => {
          enableSpecificDateSelection();
        }, 100);
      }
    };
  }
})();
</script>
<script>
// ì„¸ë¶€ í•­ëª© ë™ì‘ ìˆ˜ì • í•¨ìˆ˜
function fixGoalSubTaskFunctions() {
  console.log("ì„¸ë¶€ í•­ëª© ê¸°ëŠ¥ ìˆ˜ì • ì‹œì‘");
  
  // ì„¸ë¶€í•­ëª© í‘œì‹œ í•¨ìˆ˜ ì¬ì •ì˜
  window.showAddSubTaskForm = function(goalId) {
    console.log("ì„¸ë¶€ í•­ëª© ì¶”ê°€ í¼ í‘œì‹œ:", goalId);
    
    // ê¸°ì¡´ í¼ ì œê±°
    let existingForm = document.getElementById('subTaskForm');
    if (existingForm) existingForm.remove();
    
    // ëª©í‘œ í•­ëª© ì°¾ê¸°
    const goalItem = document.querySelector(`.goal-item:has(button[onclick*="deleteGoal(${goalId})"])`);
    if (!goalItem) {
      console.error("ëª©í‘œ í•­ëª©ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ");
      return;
    }
    
    // í¼ ìƒì„±
    const form = document.createElement('div');
    form.id = 'subTaskForm';
    form.style.background = '#f5f5f5';
    form.style.padding = '15px';
    form.style.borderRadius = '8px';
    form.style.marginTop = '10px';
    form.innerHTML = `
      <h3 style="margin-top: 0;">ì„¸ë¶€ í•­ëª© ì¶”ê°€</h3>
      <input id="subTaskTitle" type="text" placeholder="ì„¸ë¶€ í•­ëª© ì´ë¦„" style="width: 100%; padding: 8px; margin-bottom: 10px;">
      <input id="subTaskGoalId" type="hidden" value="${goalId}">
      <div style="text-align: right;">
        <button onclick="addSubTask()">ì¶”ê°€</button>
        <button onclick="closeSubTaskForm()" style="background-color: #ccc;">ì·¨ì†Œ</button>
      </div>`;
    
    // ëª©í‘œ í•­ëª©ì— í¼ ì¶”ê°€
    goalItem.appendChild(form);
    
    // ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
    setTimeout(() => {
      document.getElementById('subTaskTitle').focus();
    }, 100);
  };
  
  // ì„¸ë¶€ í•­ëª© ì¶”ê°€ í•¨ìˆ˜ ì¬ì •ì˜
  window.addSubTask = function() {
    console.log("ì„¸ë¶€ í•­ëª© ì¶”ê°€ í•¨ìˆ˜ í˜¸ì¶œ");
    const title = document.getElementById('subTaskTitle').value.trim();
    const goalId = parseInt(document.getElementById('subTaskGoalId').value);
    
    if (!title) {
      alert('í•­ëª© ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    // ëª©í‘œ ì°¾ê¸°
    const goalIndex = goals.findIndex(g => g.id === goalId);
    if (goalIndex === -1) {
      console.error("ëª©í‘œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:", goalId);
      return;
    }
    
    // ì„¸ë¶€ í•­ëª© ë°ì´í„° êµ¬ì¡° í™•ì¸ ë° ìƒì„±
    if (!goals[goalIndex].hasSubTasks) {
      goals[goalIndex].hasSubTasks = true;
    }
    
    // ìƒˆ í•­ëª© ì¶”ê°€
    const subTask = {
      id: Date.now(),
      goalId: goalId,
      title: title,
      completed: false,
      createdAt: new Date().toISOString()
    };
    
    // goalSubTasks ë°°ì—´ì— ì¶”ê°€
    goalSubTasks.push(subTask);
    
    // ì €ì¥ ë° UI ì—…ë°ì´íŠ¸
    saveGoals();
    renderGoals();
    closeSubTaskForm();
    
    console.log("ì„¸ë¶€ í•­ëª© ì¶”ê°€ ì™„ë£Œ:", subTask);
  };
  
  // ì„¸ë¶€ í•­ëª© í¼ ë‹«ê¸° í•¨ìˆ˜
  window.closeSubTaskForm = function() {
    const form = document.getElementById('subTaskForm');
    if (form) form.remove();
  };
  
  // ì„¸ë¶€ í•­ëª© í† ê¸€ í•¨ìˆ˜
  window.toggleSubTask = function(goalId, taskId) {
    console.log(`ì„¸ë¶€ í•­ëª© í† ê¸€: ëª©í‘œ ID ${goalId}, í•­ëª© ID ${taskId}`);
    const taskIndex = goalSubTasks.findIndex(t => t.id === taskId);
    if (taskIndex === -1) return;
    
    // ìƒíƒœ í† ê¸€
    goalSubTasks[taskIndex].completed = !goalSubTasks[taskIndex].completed;
    
    saveGoals();
    renderGoals();
  };
  
  // ëª©í‘œ ë Œë”ë§ í•¨ìˆ˜ í™•ì¸ ë° ìˆ˜ì •
  if (typeof window.renderGoals === 'function') {
    const originalRenderGoals = window.renderGoals;
    window.renderGoals = function() {
      // ì›ë˜ í•¨ìˆ˜ í˜¸ì¶œ
      originalRenderGoals();
      
      // ì„¸ë¶€ í•­ëª© ì„¹ì…˜ì´ ì œëŒ€ë¡œ ë Œë”ë§ë˜ì—ˆëŠ”ì§€ í™•ì¸
      setTimeout(() => {
        document.querySelectorAll('.goal-subtasks').forEach(subtasksDiv => {
          const goalControls = subtasksDiv.parentElement.querySelector('.goal-controls');
          if (goalControls) {
            const addTaskBtn = goalControls.querySelector('button[onclick^="showAddSubTaskForm"]');
            if (!addTaskBtn) {
              const goalId = goalControls.querySelector('button[onclick^="deleteGoal"]')?.
                getAttribute('onclick')?.match(/deleteGoal\((\d+)\)/)?.[1];
              
              if (goalId) {
                // í•­ëª© ì¶”ê°€ ë²„íŠ¼ì´ ì—†ìœ¼ë©´ ì¶”ê°€
                const addBtn = document.createElement('button');
                addBtn.textContent = 'í•­ëª© ì¶”ê°€';
                addBtn.setAttribute('onclick', `showAddSubTaskForm(${goalId})`);
                goalControls.appendChild(addBtn);
              }
            }
          }
        });
      }, 100);
    };
  }
  
  console.log("ì„¸ë¶€ í•­ëª© ê¸°ëŠ¥ ìˆ˜ì • ì™„ë£Œ");
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ í•¨ìˆ˜ ì‹¤í–‰
document.addEventListener('DOMContentLoaded', function() {
  setTimeout(fixGoalSubTaskFunctions, 1000);
});

// ëª©í‘œ íƒ­ í´ë¦­ì‹œì—ë„ í•¨ìˆ˜ ì‹¤í–‰
const originalShowTab = window.showTab;
if (typeof originalShowTab === 'function') {
  window.showTab = function(tabId) {
    originalShowTab(tabId);
    
    if (tabId === 'goals') {
      setTimeout(fixGoalSubTaskFunctions, 500);
    }
  };
}

function fixHabitCalendar() {
  const containers = document.querySelectorAll(".habit-calendar");
  if (containers.length > 1) {
    for (let i = 1; i < containers.length; i++) containers[i].remove();
  }

  document.querySelectorAll(".habitWeekDay").forEach(cb => {
    cb.addEventListener("click", () => cb.classList.toggle("selected"));
  });
}
window.addEventListener("load", fixHabitCalendar);
</script>
<script>
  function checkPassword() {
    const input = document.getElementById('password-input').value;
    const correct = '1234';  // ì›í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¡œ ë³€ê²½ ê°€ëŠ¥
    if (input === correct) {
      document.getElementById('password-screen').style.display = 'none';
      document.getElementById('main-content').style.display = 'block';
      console.log("ë¹„ë°€ë²ˆí˜¸ ì¸ì¦ ì„±ê³µ");
    } else {
      document.getElementById('error-msg').innerText = "ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.";
    }
  }
</script>

</body>
</html>
