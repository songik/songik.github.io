
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>í”ë“¤ê°ˆëŒ€</title>
<!-- ìŠ¤íƒ€ì¼ ìƒëµ -->
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<style>
  /* ê°„ë‹¨í•œ ë¡œë”© ìŠ¤íƒ€ì¼ */
  #loading { display: none; text-align: center; margin-top: 20px; font-size: 18px; }
</style>
</head>
<body>
<div id="password-screen">
  <form id="password-form" onsubmit="return checkPassword(event)">
    <h2>ğŸ” ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</h2>
    <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" required>
    <button type="submit">ì…ì¥</button>
    <p id="error-msg"></p>
  </form>
</div>
<div id="main-content" style="display: none;">
  <header>
    <img src="logo.png" style="height:60px;">
    <p>í—›ë˜ì´ ë³´ë‚¸ ì˜¤ëŠ˜ì€, ì£½ì€ì´ê°€ ê·¸í† ë¡ ë°”ë¼ë˜ ë‚´ì¼ì´ì—ˆë‹¤</p>
    <audio id="bgm" src="bgm.mp3" autoplay loop hidden></audio>
  </header>
  <nav>
    <!-- ë„¤ë¹„ê²Œì´ì…˜ ë§í¬ -->
  </nav>
  <div id="tabs">
    <!-- íƒ­ ì»¨í…ì¸  -->
  </div>
</div>
<div id="loading">ë¡œë”© ì¤‘...</div>
<script>
// Firebase ì´ˆê¸°í™” ë° ë¡œê·¸ì¸ ê´€ë ¨
let firebaseInitialized = false;
let userId = null;

function initializeFirebase() {
  if (!firebaseInitialized && typeof firebase !== 'undefined' && firebase.apps.length === 0) {
    const firebaseConfig = {
      apiKey: "AIzaSyAc1vHqkpkK76kYtZazxq2bVso2cPFA1Qw",
      authDomain: "song-homepage.firebaseapp.com",
      projectId: "song-homepage",
      storageBucket: "song-homepage.appspot.com",
      messagingSenderId: "59678249334",
      appId: "1:59678249334:web:83018cd88e5c244ac2cf1a",
      measurementId: "G-3YSWN7XH2W"
    };
    firebase.initializeApp(firebaseConfig);
    firebaseInitialized = true;
    userId = localStorage.getItem("uid") || Date.now().toString();
    localStorage.setItem("uid", userId);
    console.log('Firebase ì´ˆê¸°í™” ì™„ë£Œ, ì‚¬ìš©ì ID:', userId);
  }
  return firebaseInitialized;
}

function checkPassword(event) {
  event.preventDefault();
  const input = document.getElementById('password').value;
  const errorMsg = document.getElementById('error-msg');

  if (input === 'sik282') {
    localStorage.setItem('loggedIn', 'true');
    document.getElementById('password-screen').style.display = 'none';
    document.getElementById('main-content').style.display = 'block';
    if (initializeFirebase()) {
      loadInitialData();
    }
  } else {
    errorMsg.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤';
  }
}

document.addEventListener('DOMContentLoaded', function() {
  if (localStorage.getItem('loggedIn') === 'true') {
    document.getElementById('password-screen').style.display = 'none';
    document.getElementById('main-content').style.display = 'block';
    if (initializeFirebase()) {
      loadInitialData();
    }
  }
});

// ë¡œë”© ì¤‘ í‘œì‹œ
function showLoading() {
  document.getElementById('loading').style.display = 'block';
}
function hideLoading() {
  document.getElementById('loading').style.display = 'none';
}

// Firebase ë°ì´í„° ì €ì¥ í•¨ìˆ˜
function saveToFirebase(key, data) {
  if (!firebaseInitialized) return;
  const db = firebase.database();
  db.ref(`${userId}/${key}`).set(data)
    .then(() => console.log(`${key} ì €ì¥ ì™„ë£Œ`))
    .catch(err => console.error(`${key} ì €ì¥ ì‹¤íŒ¨`, err));
}

// Firebase ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
function loadDataFromFirebase(key, callback) {
  if (!firebaseInitialized) return;
  const db = firebase.database();
  db.ref(`${userId}/${key}`).once('value')
    .then(snapshot => {
      const data = snapshot.val();
      callback(data);
    })
    .catch(err => {
      console.error(`${key} ë¡œë“œ ì‹¤íŒ¨`, err);
      callback(null);
    });
}

// ì´ˆê¸° ë°ì´í„° ë¡œë“œ
function loadInitialData() {
  showLoading();
  const keys = ['diaries', 'memos', 'todos', 'schedules', 'weights', 'accounts', 'goals', 'habits'];
  let loaded = 0;

  keys.forEach(key => {
    loadDataFromFirebase(key, (data) => {
      if (data) {
        window[key] = data;
        localStorage.setItem(key, JSON.stringify(data));
      } else {
        const localData = localStorage.getItem(key);
        window[key] = localData ? JSON.parse(localData) : [];
      }
      loaded++;
      if (loaded === keys.length) {
        hideLoading();
        console.log('ëª¨ë“  ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
      }
    });
  });
}
</script>
</body>
</html>
